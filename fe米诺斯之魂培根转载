--[[
    坠落之神 Falling God - 肢体动画版
    版本: 2.0
    功能: 使用玩家肢体和饰品位移旋转实现的完整技能动画系统
]]

-- 服务
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")
local TweenService = game:GetService("TweenService")
local Debris = game:GetService("Debris")

-- 玩家变量
local player = Players.LocalPlayer
local character = player.Character or player.CharacterAdded:Wait()
local humanoid = character:WaitForChild("Humanoid")
local rootPart = character:WaitForChild("HumanoidRootPart")

-- 配置
local Config = {
    WalkSpeed = 32,
    JumpPower = 75,
    GodMode = true,
    
    Skills = {
        ["Falling Strike"] = {
            Cooldown = 6,
            Damage = 50,
            ManaCost = 25,
            Description = "从天而降的重击"
        },
        ["Void Chains"] = {
            Cooldown = 8,
            Damage = 35,
            ManaCost = 30,
            Description = "召唤虚空锁链束缚敌人"
        },
        ["Gravity Wave"] = {
            Cooldown = 10,
            Damage = 45,
            ManaCost = 40,
            Description = "释放重力冲击波"
        },
        ["Abyss Rift"] = {
            Cooldown = 15,
            Damage = 70,
            ManaCost = 60,
            Description = "撕裂空间，召唤深渊裂隙"
        }
    }
}

-- 状态变量
local mana = 100
local maxMana = 100
local skillsOnCooldown = {}
local isAnimating = false
local currentAnimation = nil

-- 存储原始CFrame
local originalLimbs = {}
local limbMotors = {}

-- 获取所有肢体
local function GetLimbs()
    local limbs = {}
    
    -- R15肢体
    local torso = character:FindFirstChild("UpperTorso") or character:FindFirstChild("Torso")
    local leftArm = character:FindFirstChild("LeftUpperArm") or character:FindFirstChild("Left Arm")
    local rightArm = character:FindFirstChild("RightUpperArm") or character:FindFirstChild("Right Arm")
    local leftLeg = character:FindFirstChild("LeftUpperLeg") or character:FindFirstChild("Left Leg")
    local rightLeg = character:FindFirstChild("RightUpperLeg") or character:FindFirstChild("Right Leg")
    local head = character:FindFirstChild("Head")
    
    if torso then
        limbs.Torso = torso
        -- 获取躯干的Motor6D
        for _, motor in pairs(torso:GetChildren()) do
            if motor:IsA("Motor6D") then
                if motor.Part1 == torso then
                    limbMotors.Torso = motor
                    originalLimbs.Torso = {C0 = motor.C0:Clone(), C1 = motor.C1:Clone()}
                end
            end
        end
    end
    
    if leftArm then limbs.LeftArm = leftArm end
    if rightArm then limbs.RightArm = rightArm end
    if leftLeg then limbs.LeftLeg = leftLeg end
    if rightLeg then limbs.RightLeg = rightLeg end
    if head then limbs.Head = head end
    
    return limbs
end

-- 创建饰品（用于特效）
local function CreateAccessory(partName, meshId, textureId, offset)
    local accessory = Instance.new("Accessory")
    local handle = Instance.new("Part")
    handle.Name = "Handle"
    handle.Size = Vector3.new(1, 1, 1)
    handle.Transparency = 0.5
    handle.CanCollide = false
    handle.Anchored = false
    handle.Parent = accessory
    
    if meshId then
        local mesh = Instance.new("SpecialMesh")
        mesh.MeshId = meshId
        mesh.TextureId = textureId or ""
        mesh.Parent = handle
    end
    
    accessory.Parent = character
    
    -- 连接到指定部位
    local attachment = Instance.new("Attachment")
    attachment.Parent = handle
    
    local motor = Instance.new("Motor6D")
    motor.Part0 = handle
    motor.Part1 = character[partName] or rootPart
    motor.C0 = offset or CFrame.new()
    motor.Parent = handle
    
    return accessory
end

-- 动画系统
local AnimationSystem = {}

function AnimationSystem:ResetAllLimbs()
    for limbName, motor in pairs(limbMotors) do
        if originalLimbs[limbName] then
            motor.C0 = originalLimbs[limbName].C0
            motor.C1 = originalLimbs[limbName].C1
        end
    end
end

function AnimationSystem:PlayLimbAnimation(animationName, duration)
    if isAnimating then return end
    
    isAnimating = true
    currentAnimation = animationName
    
    local limbs = GetLimbs()
    
    if animationName == "Idle" then
        -- 轻微呼吸动画
        task.spawn(function()
            while currentAnimation == "Idle" do
                local breath = math.sin(tick() * 2) * 0.05
                if limbs.Torso then
                    local motor = limbMotors.Torso
                    if motor then
                        motor.C0 = motor.C0 * CFrame.new(0, breath, 0)
                    end
                end
                task.wait(0.1)
            end
        end)
        
    elseif animationName == "FallingStrike" then
        -- 坠落打击动画
        if limbs.RightArm and limbMotors.RightArm then
            -- 手臂后摆准备
            local startCF = originalLimbs.RightArm.C0
            local prepCF = startCF * CFrame.Angles(math.rad(-45), math.rad(30), 0)
            
            local tween = TweenService:Create(limbMotors.RightArm, 
                TweenInfo.new(0.2, Enum.EasingStyle.Quad), 
                {C0 = prepCF}
            )
            tween:Play()
            tween.Completed:Wait()
            
            -- 快速下劈
            local strikeCF = prepCF * CFrame.Angles(math.rad(120), 0, 0)
            tween = TweenService:Create(limbMotors.RightArm,
                TweenInfo.new(0.1, Enum.EasingStyle.Back, Enum.EasingDirection.Out),
                {C0 = strikeCF}
            )
            tween:Play()
            tween.Completed:Wait()
            
            -- 创建冲击特效
            CreateEffect("Impact", rootPart.Position)
            
            -- 恢复
            task.wait(0.2)
            tween = TweenService:Create(limbMotors.RightArm,
                TweenInfo.new(0.3, Enum.EasingStyle.Quad),
                {C0 = startCF}
            )
            tween:Play()
        end
        
    elseif animationName == "VoidChains" then
        -- 虚空锁链动画
        local leftArmMotor = limbMotors.LeftArm
        local rightArmMotor = limbMotors.RightArm
        
        if leftArmMotor and rightArmMotor then
            -- 双手向两侧展开
            local leftStart = originalLimbs.LeftArm.C0
            local rightStart = originalLimbs.RightArm.C0
            
            local leftTarget = leftStart * CFrame.Angles(math.rad(45), math.rad(-30), 0)
            local rightTarget = rightStart * CFrame.Angles(math.rad(45), math.rad(30), 0)
            
            local tween1 = TweenService:Create(leftArmMotor,
                TweenInfo.new(0.3, Enum.EasingStyle.Quad),
                {C0 = leftTarget}
            )
            
            local tween2 = TweenService:Create(rightArmMotor,
                TweenInfo.new(0.3, Enum.EasingStyle.Quad),
                {C0 = rightTarget}
            )
            
            tween1:Play()
            tween2:Play()
            task.wait(0.5)
            
            -- 创建锁链特效
            for i = 1, 3 do
                CreateChainEffect(rootPart.Position + Vector3.new(math.random(-10, 10), 0, math.random(-10, 10)))
            end
            
            -- 恢复
            task.wait(0.5)
            tween1 = TweenService:Create(leftArmMotor,
                TweenInfo.new(0.3, Enum.EasingStyle.Quad),
                {C0 = leftStart}
            )
            
            tween2 = TweenService:Create(rightArmMotor,
                TweenInfo.new(0.3, Enum.EasingStyle.Quad),
                {C0 = rightStart}
            )
            
            tween1:Play()
            tween2:Play()
        end
        
    elseif animationName == "GravityWave" then
        -- 重力波动画
        if limbs.Torso and limbMotors.Torso then
            -- 身体前倾
            local torsoStart = originalLimbs.Torso.C0
            local torsoTarget = torsoStart * CFrame.Angles(math.rad(20), 0, 0)
            
            local tween = TweenService:Create(limbMotors.Torso,
                TweenInfo.new(0.2, Enum.EasingStyle.Quad),
                {C0 = torsoTarget}
            )
            tween:Play()
            tween.Completed:Wait()
            
            -- 双手向前推
            if limbMotors.LeftArm and limbMotors.RightArm then
                local leftTarget = originalLimbs.LeftArm.C0 * CFrame.Angles(0, math.rad(-15), 0)
                local rightTarget = originalLimbs.RightArm.C0 * CFrame.Angles(0, math.rad(15), 0)
                
                local tween1 = TweenService:Create(limbMotors.LeftArm,
                    TweenInfo.new(0.2, Enum.EasingStyle.Quad),
                    {C0 = leftTarget}
                )
                
                local tween2 = TweenService:Create(limbMotors.RightArm,
                    TweenInfo.new(0.2, Enum.EasingStyle.Quad),
                    {C0 = rightTarget}
                )
                
                tween1:Play()
                tween2:Play()
                
                -- 创建重力波特效
                CreateGravityWave(rootPart.Position + rootPart.CFrame.LookVector * 5)
            end
            
            -- 恢复
            task.wait(0.5)
            AnimationSystem:ResetAllLimbs()
        end
        
    elseif animationName == "AbyssRift" then
        -- 深渊裂隙动画
        -- 跪地姿势
        if limbMotors.LeftLeg and limbMotors.RightLeg and limbMotors.Torso then
            local leftLegTarget = originalLimbs.LeftLeg.C0 * CFrame.Angles(math.rad(90), 0, 0)
            local rightLegTarget = originalLimbs.RightLeg.C0 * CFrame.Angles(math.rad(90), 0, 0)
            local torsoTarget = originalLimbs.Torso.C0 * CFrame.new(0, -1, 0) * CFrame.Angles(math.rad(-20), 0, 0)
            
            local tween1 = TweenService:Create(limbMotors.LeftLeg,
                TweenInfo.new(0.4, Enum.EasingStyle.Quad),
                {C0 = leftLegTarget}
            )
            
            local tween2 = TweenService:Create(limbMotors.RightLeg,
                TweenInfo.new(0.4, Enum.EasingStyle.Quad),
                {C0 = rightLegTarget}
            )
            
            local tween3 = TweenService:Create(limbMotors.Torso,
                TweenInfo.new(0.4, Enum.EasingStyle.Quad),
                {C0 = torsoTarget}
            )
            
            tween1:Play()
            tween2:Play()
            tween3:Play()
            
            tween3.Completed:Wait()
            
            -- 双手举向天空
            if limbMotors.LeftArm and limbMotors.RightArm then
                local leftArmTarget = originalLimbs.LeftArm.C0 * CFrame.Angles(math.rad(120), math.rad(-20), 0)
                local rightArmTarget = originalLimbs.RightArm.C0 * CFrame.Angles(math.rad(120), math.rad(20), 0)
                
                tween1 = TweenService:Create(limbMotors.LeftArm,
                    TweenInfo.new(0.3, Enum.EasingStyle.Back, Enum.EasingDirection.Out),
                    {C0 = leftArmTarget}
                )
                
                tween2 = TweenService:Create(limbMotors.RightArm,
                    TweenInfo.new(0.3, Enum.EasingStyle.Back, Enum.EasingDirection.Out),
                    {C0 = rightArmTarget}
                )
                
                tween1:Play()
                tween2:Play()
                
                -- 创建裂隙特效
                CreateRiftEffect(rootPart.Position)
                
                task.wait(1)
                
                -- 恢复
                AnimationSystem:ResetAllLimbs()
            end
        end
    end
    
    task.wait(duration or 1)
    isAnimating = false
    currentAnimation = nil
end

-- 特效系统
function CreateEffect(effectType, position)
    if effectType == "Impact" then
        -- 冲击波特效
        local part = Instance.new("Part")
        part.Size = Vector3.new(0.1, 0.1, 0.1)
        part.Position = position
        part.Transparency = 0.3
        part.Color = Color3.fromRGB(220, 50, 50)
        part.Material = Enum.Material.Neon
        part.Anchored = true
        part.CanCollide = false
        part.Parent = workspace
        
        local tween = TweenService:Create(part,
            TweenInfo.new(0.5, Enum.EasingStyle.Quad),
            {Size = Vector3.new(15, 0.1, 15), Transparency = 1}
        )
        tween:Play()
        
        Debris:AddItem(part, 1)
        
    elseif effectType == "Chain" then
        -- 锁链特效
        local chain = CreateAccessory("HumanoidRootPart", "rbxassetid://1111111111", nil, 
            CFrame.new(0, 0, 0) * CFrame.Angles(math.rad(90), 0, 0))
        
        task.spawn(function()
            for i = 1, 10 do
                chain.Handle.Mesh.Scale = chain.Handle.Mesh.Scale + Vector3.new(0.1, 0, 0.1)
                task.wait(0.05)
            end
            chain:Destroy()
        end)
    end
end

function CreateChainEffect(position)
    local part = Instance.new("Part")
    part.Size = Vector3.new(0.5, 5, 0.5)
    part.Position = position
    part.Color = Color3.fromRGB(80, 30, 120)
    part.Material = Enum.Material.Neon
    part.Anchored = true
    part.CanCollide = false
    part.Parent = workspace
    
    -- 锁链摆动动画
    task.spawn(function()
        for i = 1, 20 do
            part.CFrame = part.CFrame * CFrame.Angles(0, math.rad(10), 0)
            task.wait(0.05)
        end
        part:Destroy()
    end)
end

function CreateGravityWave(position)
    local wave = Instance.new("Part")
    wave.Size = Vector3.new(1, 1, 1)
    wave.Shape = Enum.PartType.Cylinder
    wave.Position = position
    wave.Transparency = 0.5
    wave.Color = Color3.fromRGB(150, 50, 200)
    wave.Material = Enum.Material.Neon
    wave.Anchored = true
    wave.CanCollide = false
    wave.Parent = workspace
    
    local tween = TweenService:Create(wave,
        TweenInfo.new(0.8, Enum.EasingStyle.Quad),
        {Size = Vector3.new(20, 0.1, 20), Transparency = 1}
    )
    tween:Play()
    
    Debris:AddItem(wave, 1)
end

function CreateRiftEffect(position)
    -- 创建裂隙饰品
    local rift = CreateAccessory("HumanoidRootPart", "rbxassetid://2222222222", nil,
        CFrame.new(0, -2, 0))
    
    -- 旋转和缩放动画
    task.spawn(function()
        for i = 1, 30 do
            rift.Handle.Mesh.Scale = rift.Handle.Mesh.Scale + Vector3.new(0.2, 0.2, 0.2)
            rift.Handle.CFrame = rift.Handle.CFrame * CFrame.Angles(0, math.rad(20), 0)
            task.wait(0.1)
        end
        rift:Destroy()
    end)
end

-- 初始化肢体系统
local limbs = GetLimbs()

-- 存储原始Motor6D数据
for limbName, part in pairs(limbs) do
    for _, motor in pairs(part:GetChildren()) do
        if motor:IsA("Motor6D") then
            limbMotors[limbName] = motor
            originalLimbs[limbName] = {C0 = motor.C0:Clone(), C1 = motor.C1:Clone()}
            break
        end
    end
end

-- 创建饰品特效
local effectAccessories = {}

-- 创建坠落之神特效饰品
local function CreateGodEffects()
    -- 光环特效
    local halo = CreateAccessory("Head", "rbxassetid://3333333333", nil,
        CFrame.new(0, 1, 0) * CFrame.Angles(math.rad(90), 0, 0))
    halo.Handle.Transparency = 0.7
    halo.Handle.Color = Color3.fromRGB(200, 50, 50)
    table.insert(effectAccessories, halo)
    
    -- 肩部特效
    local leftShoulder = CreateAccessory("LeftUpperArm", "rbxassetid://4444444444", nil,
        CFrame.new(0, 0.5, 0))
    leftShoulder.Handle.Transparency = 0.6
    leftShoulder.Handle.Color = Color3.fromRGB(150, 50, 200)
    table.insert(effectAccessories, leftShoulder)
    
    local rightShoulder = CreateAccessory("RightUpperArm", "rbxassetid://4444444444", nil,
        CFrame.new(0, 0.5, 0))
    rightShoulder.Handle.Transparency = 0.6
    rightShoulder.Handle.Color = Color3.fromRGB(150, 50, 200)
    table.insert(effectAccessories, rightShoulder)
    
    -- 饰品动画循环
    task.spawn(function()
        while true do
            for _, accessory in pairs(effectAccessories) do
                if accessory and accessory.Parent then
                    accessory.Handle.CFrame = accessory.Handle.CFrame * CFrame.Angles(0, math.rad(1), 0)
                end
            end
            task.wait()
        end
    end)
end

-- 技能系统
local Skills = {}

function Skills:FallingStrike()
    if skillsOnCooldown["Falling Strike"] or isAnimating or mana < Config.Skills["Falling Strike"].ManaCost then
        return
    end
    
    mana = mana - Config.Skills["Falling Strike"].ManaCost
    skillsOnCooldown["Falling Strike"] = true
    
    -- 播放动画
    AnimationSystem:PlayLimbAnimation("FallingStrike", 1.5)
    
    -- 伤害逻辑
    local hitbox = CreateHitbox(10)
    DamageInRadius(hitbox, Config.Skills["Falling Strike"].Damage)
    
    -- 冷却
    task.wait(Config.Skills["Falling Strike"].Cooldown)
    skillsOnCooldown["Falling Strike"] = false
end

function Skills:VoidChains()
    if skillsOnCooldown["Void Chains"] or isAnimating or mana < Config.Skills["Void Chains"].ManaCost then
        return
    end
    
    mana = mana - Config.Skills["Void Chains"].ManaCost
    skillsOnCooldown["Void Chains"] = true
    
    AnimationSystem:PlayLimbAnimation("VoidChains", 2)
    
    -- 束缚效果
    for _, player in pairs(Players:GetPlayers()) do
        if player ~= Players.LocalPlayer then
            local targetChar = player.Character
            if targetChar then
                local targetRoot = targetChar:FindFirstChild("HumanoidRootPart")
                if targetRoot and (targetRoot.Position - rootPart.Position).Magnitude < 20 then
                    -- 添加束缚效果
                    local bodyVelocity = Instance.new("BodyVelocity")
                    bodyVelocity.Velocity = Vector3.new(0, 0, 0)
                    bodyVelocity.MaxForce = Vector3.new(10000, 10000, 10000)
                    bodyVelocity.Parent = targetRoot
                    
                    Debris:AddItem(bodyVelocity, 3)
                end
            end
        end
    end
    
    task.wait(Config.Skills["Void Chains"].Cooldown)
    skillsOnCooldown["Void Chains"] = false
end

function Skills:GravityWave()
    if skillsOnCooldown["Gravity Wave"] or isAnimating or mana < Config.Skills["Gravity Wave"].ManaCost then
        return
    end
    
    mana = mana - Config.Skills["Gravity Wave"].ManaCost
    skillsOnCooldown["Gravity Wave"] = true
    
    AnimationSystem:PlayLimbAnimation("GravityWave", 1.5)
    
    -- 击退效果
    for _, player in pairs(Players:GetPlayers()) do
        if player ~= Players.LocalPlayer then
            local targetChar = player.Character
            if targetChar then
                local targetRoot = targetChar:FindFirstChild("HumanoidRootPart")
                if targetRoot and (targetRoot.Position - rootPart.Position).Magnitude < 15 then
                    local direction = (targetRoot.Position - rootPart.Position).Unit
                    local bodyVelocity = Instance.new("BodyVelocity")
                    bodyVelocity.Velocity = direction * 50 + Vector3.new(0, 10, 0)
                    bodyVelocity.MaxForce = Vector3.new(10000, 10000, 10000)
                    bodyVelocity.Parent = targetRoot
                    
                    Debris:AddItem(bodyVelocity, 0.5)
                end
            end
        end
    end
    
    task.wait(Config.Skills["Gravity Wave"].Cooldown)
    skillsOnCooldown["Gravity Wave"] = false
end

function Skills:AbyssRift()
    if skillsOnCooldown["Abyss Rift"] or isAnimating or mana < Config.Skills["Abyss Rift"].ManaCost then
        return
    end
    
    mana = mana - Config.Skills["Abyss Rift"].ManaCost
    skillsOnCooldown["Abyss Rift"] = true
    
    AnimationSystem:PlayLimbAnimation("AbyssRift", 3)
    
    -- 大范围伤害
    task.wait(0.8) -- 等待动画到释放点
    DamageInRadius(rootPart.Position, 25, Config.Skills["Abyss Rift"].Damage)
    
    task.wait(Config.Skills["Abyss Rift"].Cooldown)
    skillsOnCooldown["Abyss Rift"] = false
end

-- 工具函数
function CreateHitbox(radius)
    local hitbox = Instance.new("Part")
    hitbox.Size = Vector3.new(radius * 2, radius * 2, radius * 2)
    hitbox.Position = rootPart.Position + rootPart.CFrame.LookVector * 5
    hitbox.Transparency = 1
    hitbox.CanCollide = false
    hitbox.Anchored = true
    hitbox.Parent = workspace
    
    Debris:AddItem(hitbox, 0.1)
    return hitbox
end

function DamageInRadius(position, radius, damage)
    damage = damage or 25
    for _, player in pairs(Players:GetPlayers()) do
        if player ~= Players.LocalPlayer then
            local targetChar = player.Character
            if targetChar then
                local targetRoot = targetChar:FindFirstChild("HumanoidRootPart")
                if targetRoot then
                    local distance = (targetRoot.Position - position).Magnitude
                    if distance <= radius then
                        local targetHumanoid = targetChar:FindFirstChild("Humanoid")
                        if targetHumanoid then
                            targetHumanoid:TakeDamage(damage)
                            ShowDamageNumber(targetRoot.Position, damage)
                        end
                    end
                end
            end
        end
    end
end

function ShowDamageNumber(position, damage)
    local billboard = Instance.new("BillboardGui")
    billboard.Size = UDim2.new(2, 0, 2, 0)
    billboard.StudsOffset = Vector3.new(0, 3, 0)
    billboard.AlwaysOnTop = true
    billboard.Adornee = workspace.Terrain
    billboard.Parent = workspace
    
    local textLabel = Instance.new("TextLabel")
    textLabel.Size = UDim2.new(1, 0, 1, 0)
    textLabel.BackgroundTransparency = 1
    textLabel.Text = tostring(damage)
    textLabel.TextColor3 = Color3.fromRGB(255, 50, 50)
    textLabel.TextSize = 20
    textLabel.Font = Enum.Font.GothamBold
    textLabel.Parent = billboard
    
    local tween = TweenService:Create(billboard,
        TweenInfo.new(1, Enum.EasingStyle.Quad),
        {StudsOffset = Vector3.new(0, 6, 0)}
    )
    tween:Play()
    
    task.delay(0.5, function()
        local fadeTween = TweenService:Create(textLabel,
            TweenInfo.new(0.5),
            {TextTransparency = 1}
        )
        fadeTween:Play()
    end)
    
    Debris:AddItem(billboard, 2)
end

-- 输入绑定
UserInputService.InputBegan:Connect(function(input, gameProcessed)
    if gameProcessed then return end
    
    if input.UserInputType == Enum.UserInputType.Keyboard then
        if input.KeyCode == Enum.KeyCode.Q then
            Skills:FallingStrike()
        elseif input.KeyCode == Enum.KeyCode.E then
            Skills:VoidChains()
        elseif input.KeyCode == Enum.KeyCode.R then
            Skills:GravityWave()
        elseif input.KeyCode == Enum.KeyCode.F then
            Skills:AbyssRift()
        elseif input.KeyCode == Enum.KeyCode.T then
            -- 测试动画
            AnimationSystem:PlayLimbAnimation("Idle", 5)
        end
    end
end)

-- 创建UI（简化版）
local screenGui = Instance.new("ScreenGui")
screenGui.Parent = player.PlayerGui

local skillFrame = Instance.new("Frame")
skillFrame.Size = UDim2.new(0, 400, 0, 80)
skillFrame.Position = UDim2.new(0.5, -200, 1, -100)
skillFrame.BackgroundColor3 = Color3.fromRGB(30, 30, 40)
skillFrame.BackgroundTransparency = 0.3
skillFrame.BorderSizePixel = 0
skillFrame.Parent = screenGui

local UICorner = Instance.new("UICorner")
UICorner.CornerRadius = UDim.new(0, 10)
UICorner.Parent = skillFrame

local skillKeys = {"Q", "E", "R", "F"}
local skillNames = {"Falling Strike", "Void Chains", "Gravity Wave", "Abyss Rift"}

for i = 1, 4 do
    local skillButton = Instance.new("TextButton")
    skillButton.Size = UDim2.new(0, 70, 0, 70)
    skillButton.Position = UDim2.new(0, 10 + (i-1)*85, 0, 5)
    skillButton.BackgroundColor3 = Color3.fromRGB(50, 50, 70)
    skillButton.Text = skillKeys[i]
    skillButton.TextColor3 = Color3.fromRGB(255, 255, 255)
    skillButton.TextSize = 18
    skillButton.Font = Enum.Font.GothamBold
    skillButton.Parent = skillFrame
    
    local buttonCorner = Instance.new("UICorner")
    buttonCorner.CornerRadius = UDim.new(0, 8)
    buttonCorner.Parent = skillButton
    
    local tooltip = Instance.new("TextLabel")
    tooltip.Size = UDim2.new(2, 0, 0, 40)
    tooltip.Position = UDim2.new(0, -35, 1, 5)
    tooltip.BackgroundColor3 = Color3.fromRGB(40, 40, 60)
    tooltip.TextColor3 = Color3.fromRGB(255, 255, 255)
    tooltip.Text = skillNames[i] .. "\n" .. Config.Skills[skillNames[i]].Description
    tooltip.TextSize = 12
    tooltip.Visible = false
    tooltip.Parent = skillButton
    
    skillButton.MouseEnter:Connect(function()
        tooltip.Visible = true
    end)
    
    skillButton.MouseLeave:Connect(function()
        tooltip.Visible = false
    end)
    
    skillButton.MouseButton1Click:Connect(function()
        if i == 1 then
            Skills:FallingStrike()
        elseif i == 2 then
            Skills:VoidChains()
        elseif i == 3 then
            Skills:GravityWave()
        elseif i == 4 then
            Skills:AbyssRift()
        end
    end)
end

-- 法力恢复
task.spawn(function()
    while true do
        task.wait(0.5)
        if mana < maxMana then
            mana = math.min(maxMana, mana + 1)
        end
    end
end)

-- 初始化
humanoid.WalkSpeed = Config.WalkSpeed
humanoid.JumpPower = Config.JumpPower

if Config.GodMode then
    humanoid.BreakJointsOnDeath = false
end

-- 创建特效饰品
task.wait(1)
CreateGodEffects()

print("坠落之神系统已加载！")
print("技能按键：Q, E, R, F")
print("T键：播放空闲动画")

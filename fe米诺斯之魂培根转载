-- é«˜çº§æ™ºèƒ½AIèŠå¤©ç³»ç»Ÿ - ç°ä»£åŒ–ç‰ˆ
-- å®Œå…¨å®¢æˆ·ç«¯æœ¬åœ°è¿è¡Œï¼Œæ— éœ€HTTPè¯·æ±‚

local Players = game:GetService("Players")
local Player = Players.LocalPlayer
local PlayerGui = Player:WaitForChild("PlayerGui")
local TextChatService = game:GetService("TextChatService")
local RunService = game:GetService("RunService")
local TweenService = game:GetService("TweenService")
local UserInputService = game:GetService("UserInputService")
local StarterGui = game:GetService("StarterGui")
local HttpService = game:GetService("HttpService")

-- æ£€æŸ¥TextChatServiceæ˜¯å¦å¯ç”¨
local hasTextChat = pcall(function() return TextChatService.TextChannels.RBXGeneral end)

-- ==================== ç°ä»£åŒ–UIè®¾è®¡ ====================
local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = "SmartAIChatUI"
ScreenGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
ScreenGui.ResetOnSpawn = false
ScreenGui.DisplayOrder = 100

-- ä¸»æ¡†æ¶ - ç´§å‡‘è®¾è®¡
local MainFrame = Instance.new("Frame")
MainFrame.Name = "MainFrame"
MainFrame.Size = UDim2.new(0, 450, 0, 550)
MainFrame.Position = UDim2.new(0.5, -225, 0.5, -275)
MainFrame.BackgroundColor3 = Color3.fromRGB(245, 245, 245)
MainFrame.BackgroundTransparency = 0.05
MainFrame.BorderSizePixel = 0
MainFrame.ClipsDescendants = true
MainFrame.Visible = false

-- åœ†è§’
local UICorner = Instance.new("UICorner")
UICorner.CornerRadius = UDim.new(0, 12)
UICorner.Parent = MainFrame

-- é˜´å½±
local UIStroke = Instance.new("UIStroke")
UIStroke.Color = Color3.fromRGB(220, 220, 220)
UIStroke.Thickness = 2
UIStroke.Parent = MainFrame

-- æ ‡é¢˜æ ï¼ˆå¯æ‹–åŠ¨ï¼‰
local TitleBar = Instance.new("Frame")
TitleBar.Name = "TitleBar"
TitleBar.Size = UDim2.new(1, 0, 0, 40)
TitleBar.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
TitleBar.BorderSizePixel = 0
TitleBar.ZIndex = 2

local TitleBarCorner = Instance.new("UICorner")
TitleBarCorner.CornerRadius = UDim.new(0, 12)
TitleBarCorner.Parent = TitleBar

local TitleLabel = Instance.new("TextLabel")
TitleLabel.Name = "TitleLabel"
TitleLabel.Size = UDim2.new(0.5, 0, 1, 0)
TitleLabel.Position = UDim2.new(0, 15, 0, 0)
TitleLabel.BackgroundTransparency = 1
TitleLabel.Text = "ğŸ¤– AIæ™ºèƒ½åŠ©æ‰‹"
TitleLabel.TextColor3 = Color3.fromRGB(30, 30, 30)
TitleLabel.TextSize = 16
TitleLabel.Font = Enum.Font.GothamBold
TitleLabel.TextXAlignment = Enum.TextXAlignment.Left

-- æ§åˆ¶æŒ‰é’®
local MinimizeButton = Instance.new("ImageButton")
MinimizeButton.Name = "MinimizeButton"
MinimizeButton.Size = UDim2.new(0, 30, 0, 30)
MinimizeButton.Position = UDim2.new(1, -80, 0, 5)
MinimizeButton.BackgroundTransparency = 1
MinimizeButton.Image = "rbxassetid://3926305904"
MinimizeButton.ImageRectOffset = Vector2.new(844, 404)
MinimizeButton.ImageRectSize = Vector2.new(36, 36)
MinimizeButton.ImageColor3 = Color3.fromRGB(100, 100, 100)

local CloseButton = Instance.new("ImageButton")
CloseButton.Name = "CloseButton"
CloseButton.Size = UDim2.new(0, 30, 0, 30)
CloseButton.Position = UDim2.new(1, -40, 0, 5)
CloseButton.BackgroundTransparency = 1
CloseButton.Image = "rbxassetid://3926305904"
CloseButton.ImageRectOffset = Vector2.new(284, 4)
CloseButton.ImageRectSize = Vector2.new(24, 24)
CloseButton.ImageColor3 = Color3.fromRGB(100, 100, 100)

-- èŠå¤©è®°å½•æ¡†
local ChatContainer = Instance.new("Frame")
ChatContainer.Name = "ChatContainer"
ChatContainer.Size = UDim2.new(1, -20, 1, -150)
ChatContainer.Position = UDim2.new(0, 10, 0, 50)
ChatContainer.BackgroundTransparency = 1

local ChatScroll = Instance.new("ScrollingFrame")
ChatScroll.Name = "ChatScroll"
ChatScroll.Size = UDim2.new(1, 0, 1, 0)
ChatScroll.BackgroundTransparency = 1
ChatScroll.ScrollBarImageColor3 = Color3.fromRGB(200, 200, 200)
ChatScroll.ScrollBarThickness = 6
ChatScroll.CanvasSize = UDim2.new(0, 0, 0, 0)
ChatScroll.AutomaticCanvasSize = Enum.AutomaticSize.Y

local ChatLayout = Instance.new("UIListLayout")
ChatLayout.Name = "ChatLayout"
ChatLayout.Padding = UDim.new(0, 12)
ChatLayout.HorizontalAlignment = Enum.HorizontalAlignment.Center
ChatLayout.SortOrder = Enum.SortOrder.LayoutOrder

local ChatPadding = Instance.new("UIPadding")
ChatPadding.Name = "ChatPadding"
ChatPadding.PaddingTop = UDim.new(0, 10)
ChatPadding.PaddingBottom = UDim.new(0, 10)

-- è¾“å…¥åŒºåŸŸ
local InputContainer = Instance.new("Frame")
InputContainer.Name = "InputContainer"
InputContainer.Size = UDim2.new(1, -20, 0, 60)
InputContainer.Position = UDim2.new(0, 10, 1, -70)
InputContainer.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
InputContainer.BorderSizePixel = 0

local InputCorner = Instance.new("UICorner")
InputCorner.CornerRadius = UDim.new(0, 10)
InputCorner.Parent = InputContainer

local InputBox = Instance.new("TextBox")
InputBox.Name = "InputBox"
InputBox.Size = UDim2.new(1, -90, 1, -10)
InputBox.Position = UDim2.new(0, 10, 0, 5)
InputBox.BackgroundColor3 = Color3.fromRGB(245, 245, 245)
InputBox.TextColor3 = Color3.fromRGB(30, 30, 30)
InputBox.TextSize = 14
InputBox.Font = Enum.Font.Gotham
InputBox.PlaceholderText = "è¾“å…¥ä½ çš„é—®é¢˜..."
InputBox.PlaceholderColor3 = Color3.fromRGB(150, 150, 150)
InputBox.ClearTextOnFocus = false
InputBox.TextXAlignment = Enum.TextXAlignment.Left

local InputStroke = Instance.new("UIStroke")
InputStroke.Color = Color3.fromRGB(220, 220, 220)
InputStroke.Thickness = 1
InputStroke.Parent = InputBox

local InputCorner2 = Instance.new("UICorner")
InputCorner2.CornerRadius = UDim.new(0, 8)
InputCorner2.Parent = InputBox

local SendButton = Instance.new("TextButton")
SendButton.Name = "SendButton"
SendButton.Size = UDim2.new(0, 70, 1, -10)
SendButton.Position = UDim2.new(1, -80, 0, 5)
SendButton.BackgroundColor3 = Color3.fromRGB(0, 120, 215)
SendButton.Text = "å‘é€"
SendButton.TextColor3 = Color3.fromRGB(255, 255, 255)
SendButton.TextSize = 14
SendButton.Font = Enum.Font.GothamBold
SendButton.AutoButtonColor = true

local SendButtonCorner = Instance.new("UICorner")
SendButtonCorner.CornerRadius = UDim.new(0, 8)
SendButtonCorner.Parent = SendButton

-- åº•éƒ¨æ§åˆ¶æ 
local ControlBar = Instance.new("Frame")
ControlBar.Name = "ControlBar"
ControlBar.Size = UDim2.new(1, 0, 0, 50)
ControlBar.Position = UDim2.new(0, 0, 1, -50)
ControlBar.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
ControlBar.BorderSizePixel = 0

local PersonaButton = Instance.new("TextButton")
PersonaButton.Name = "PersonaButton"
PersonaButton.Size = UDim2.new(0, 100, 0, 30)
PersonaButton.Position = UDim2.new(0, 15, 0, 10)
PersonaButton.BackgroundColor3 = Color3.fromRGB(240, 240, 240)
PersonaButton.TextColor3 = Color3.fromRGB(0, 120, 215)
PersonaButton.Text = "ğŸ§  åŠ©æ‰‹æ¨¡å¼"
PersonaButton.TextSize = 12
PersonaButton.Font = Enum.Font.Gotham

local PersonaCorner = Instance.new("UICorner")
PersonaCorner.CornerRadius = UDim.new(0, 6)
PersonaCorner.Parent = PersonaButton

local AIButton = Instance.new("TextButton")
AIButton.Name = "AIButton"
AIButton.Size = UDim2.new(0, 100, 0, 30)
AIButton.Position = UDim2.new(0.5, -50, 0, 10)
AIButton.BackgroundColor3 = Color3.fromRGB(240, 240, 240)
AIButton.TextColor3 = Color3.fromRGB(0, 120, 215)
AIButton.Text = "ğŸ¤– åŒ–èº«AI: å…³é—­"
AIButton.TextSize = 12
AIButton.Font = Enum.Font.Gotham

local AICorner = Instance.new("UICorner")
AICorner.CornerRadius = UDim.new(0, 6)
AICorner.Parent = AIButton

local ClearButton = Instance.new("TextButton")
ClearButton.Name = "ClearButton"
ClearButton.Size = UDim2.new(0, 30, 0, 30)
ClearButton.Position = UDim2.new(1, -50, 0, 10)
ClearButton.BackgroundTransparency = 1
ClearButton.Text = "ğŸ—‘ï¸"
ClearButton.TextColor3 = Color3.fromRGB(150, 150, 150)
ClearButton.TextSize = 18
ClearButton.Font = Enum.Font.Gotham

-- ç»„è£…UI
TitleBar.Parent = MainFrame
TitleLabel.Parent = TitleBar
MinimizeButton.Parent = TitleBar
CloseButton.Parent = TitleBar
ChatContainer.Parent = MainFrame
ChatScroll.Parent = ChatContainer
ChatLayout.Parent = ChatScroll
ChatPadding.Parent = ChatScroll
InputContainer.Parent = MainFrame
InputBox.Parent = InputContainer
SendButton.Parent = InputContainer
ControlBar.Parent = MainFrame
PersonaButton.Parent = ControlBar
AIButton.Parent = ControlBar
ClearButton.Parent = ControlBar
MainFrame.Parent = ScreenGui
ScreenGui.Parent = PlayerGui

-- ==================== èŠå¤©è®°å½•ç®¡ç† ====================
local ChatHistory = {
    Messages = {},
    MaxMessages = 200,
    AutoSave = true
}

local AIConfig = {
    CurrentPersona = "assistant",
    IsAIModeActive = false,
    ResponseDelay = 0.3
}

-- åˆ›å»ºæ¶ˆæ¯æ¨¡æ¿ï¼ˆç°ä»£åŒ–è®¾è®¡ï¼‰
local function createMessageTemplate(isAI, sender, message, timestamp)
    local messageFrame = Instance.new("Frame")
    messageFrame.Name = "MessageFrame"
    messageFrame.BackgroundTransparency = 1
    messageFrame.Size = UDim2.new(0.95, 0, 0, 0)
    messageFrame.LayoutOrder = #ChatHistory.Messages + 1
    messageFrame.AutomaticSize = Enum.AutomaticSize.Y
    
    -- æ¶ˆæ¯æ°”æ³¡
    local messageBubble = Instance.new("Frame")
    messageBubble.Name = "MessageBubble"
    messageBubble.BackgroundColor3 = isAI and Color3.fromRGB(230, 240, 255) or Color3.fromRGB(240, 245, 250)
    messageBubble.Size = UDim2.new(1, 0, 0, 0)
    messageBubble.Position = UDim2.new(0, 0, 0, 0)
    messageBubble.AutomaticSize = Enum.AutomaticSize.Y
    
    local bubbleCorner = Instance.new("UICorner")
    bubbleCorner.CornerRadius = UDim.new(0, 12)
    bubbleCorner.Parent = messageBubble
    
    local bubbleStroke = Instance.new("UIStroke")
    bubbleStroke.Color = Color3.fromRGB(220, 230, 240)
    bubbleStroke.Thickness = 1
    bubbleStroke.Parent = messageBubble
    
    -- å‘é€è€…ä¿¡æ¯
    local senderFrame = Instance.new("Frame")
    senderFrame.Name = "SenderFrame"
    senderFrame.Size = UDim2.new(1, 0, 0, 25)
    senderFrame.BackgroundTransparency = 1
    
    local senderIcon = Instance.new("TextLabel")
    senderIcon.Name = "SenderIcon"
    senderIcon.Size = UDim2.new(0, 25, 0, 25)
    senderIcon.BackgroundTransparency = 1
    senderIcon.Text = isAI and "ğŸ¤–" or "ğŸ‘¤"
    senderIcon.TextColor3 = isAI and Color3.fromRGB(0, 100, 200) or Color3.fromRGB(100, 100, 100)
    senderIcon.TextSize = 14
    
    local senderLabel = Instance.new("TextLabel")
    senderLabel.Name = "SenderLabel"
    senderLabel.Size = UDim2.new(1, -35, 1, 0)
    senderLabel.Position = UDim2.new(0, 30, 0, 0)
    senderLabel.BackgroundTransparency = 1
    senderLabel.Text = sender
    senderLabel.TextColor3 = isAI and Color3.fromRGB(0, 100, 200) or Color3.fromRGB(100, 100, 100)
    senderLabel.TextSize = 12
    senderLabel.Font = Enum.Font.GothamBold
    senderLabel.TextXAlignment = Enum.TextXAlignment.Left
    
    -- æ—¶é—´æˆ³
    local timeLabel = Instance.new("TextLabel")
    timeLabel.Name = "TimeLabel"
    timeLabel.Size = UDim2.new(0, 60, 1, 0)
    timeLabel.Position = UDim2.new(1, -65, 0, 0)
    timeLabel.BackgroundTransparency = 1
    timeLabel.Text = timestamp or os.date("%H:%M")
    timeLabel.TextColor3 = Color3.fromRGB(150, 150, 150)
    timeLabel.TextSize = 10
    timeLabel.Font = Enum.Font.Gotham
    timeLabel.TextXAlignment = Enum.TextXAlignment.Right
    
    -- æ¶ˆæ¯å†…å®¹ï¼ˆè“è‰²å­—ä½“ï¼‰
    local messageLabel = Instance.new("TextLabel")
    messageLabel.Name = "MessageLabel"
    messageLabel.Size = UDim2.new(1, -20, 0, 0)
    messageLabel.Position = UDim2.new(0, 10, 0, 30)
    messageLabel.BackgroundTransparency = 1
    messageLabel.Text = message
    messageLabel.TextColor3 = Color3.fromRGB(0, 100, 200) -- è“è‰²å­—ä½“
    messageLabel.TextSize = 14
    messageLabel.Font = Enum.Font.Gotham
    messageLabel.TextWrapped = true
    messageLabel.TextXAlignment = Enum.TextXAlignment.Left
    messageLabel.AutomaticSize = Enum.AutomaticSize.Y
    
    -- å¤åˆ¶æŒ‰é’®
    local copyButton = Instance.new("TextButton")
    copyButton.Name = "CopyButton"
    copyButton.Size = UDim2.new(0, 25, 0, 25)
    copyButton.Position = UDim2.new(1, -35, 0, 30)
    copyButton.BackgroundTransparency = 1
    copyButton.Text = "ğŸ“‹"
    copyButton.TextColor3 = Color3.fromRGB(150, 150, 150)
    copyButton.TextSize = 12
    copyButton.Visible = isAI
    
    -- ç»„è£…
    senderIcon.Parent = senderFrame
    senderLabel.Parent = senderFrame
    timeLabel.Parent = senderFrame
    senderFrame.Parent = messageBubble
    messageLabel.Parent = messageBubble
    copyButton.Parent = messageBubble
    messageBubble.Parent = messageFrame
    
    return messageFrame
end

-- æ·»åŠ æ¶ˆæ¯åˆ°èŠå¤©è®°å½•
local function addMessageToChat(isAI, sender, message)
    local timestamp = os.date("%H:%M")
    
    -- ä¿å­˜åˆ°å†å²è®°å½•
    table.insert(ChatHistory.Messages, {
        isAI = isAI,
        sender = sender,
        message = message,
        timestamp = timestamp
    })
    
    -- é™åˆ¶å†å²è®°å½•æ•°é‡
    if #ChatHistory.Messages > ChatHistory.MaxMessages then
        table.remove(ChatHistory.Messages, 1)
    end
    
    -- åˆ›å»ºUIæ¶ˆæ¯
    local messageUI = createMessageTemplate(isAI, sender, message, timestamp)
    messageUI.Parent = ChatScroll
    
    -- æ»šåŠ¨åˆ°åº•éƒ¨
    task.wait(0.05)
    ChatScroll.CanvasPosition = Vector2.new(0, ChatScroll.CanvasSize.Y.Offset)
    
    -- è‡ªåŠ¨ä¿å­˜èŠå¤©è®°å½•
    if ChatHistory.AutoSave then
        saveChatHistory()
    end
end

-- ==================== AIæ™ºèƒ½å¼•æ“ ====================
local AILanguageGenerator = {
    vocabulary = {
        connectors = {"å¹¶ä¸”", "è€Œä¸”", "å¦å¤–", "åŒæ—¶", "æ­¤å¤–", "ä¸ä»…å¦‚æ­¤", "æ›´é‡è¦çš„æ˜¯", "å…·ä½“æ¥è¯´", "ç®€å•æ¥è¯´", "æ€»çš„æ¥è¯´"},
        adjectives = {"æ™ºèƒ½çš„", "é«˜æ•ˆçš„", "å¼ºå¤§çš„", "çµæ´»çš„", "å¯é çš„", "å…ˆè¿›çš„", "åˆ›æ–°çš„", "ä¼˜åŒ–çš„", "é›†æˆçš„", "åŠ¨æ€çš„"},
        verbs = {"å®ç°", "å®Œæˆ", "æ„å»º", "å¼€å‘", "åˆ›å»º", "è®¾è®¡", "ç¼–å†™", "ä¼˜åŒ–", "è°ƒè¯•", "æµ‹è¯•", "éƒ¨ç½²", "è¿è¡Œ"},
        adverbs = {"é«˜æ•ˆåœ°", "å¿«é€Ÿåœ°", "å‡†ç¡®åœ°", "å¯é åœ°", "ç¨³å®šåœ°", "çµæ´»åœ°", "æ™ºèƒ½åœ°", "è‡ªåŠ¨åœ°", "å®‰å…¨åœ°"},
        nouns = {"åŠŸèƒ½", "ç³»ç»Ÿ", "è„šæœ¬", "ä»£ç ", "ç¨‹åº", "ç®—æ³•", "é€»è¾‘", "ç»“æ„", "æ¡†æ¶", "æ¨¡å—", "ç»„ä»¶"},
        phrases = {
            "è®©æˆ‘æ¥å¸®ä½ ", "æ ¹æ®æˆ‘çš„ç†è§£", "ä»æŠ€æœ¯è§’åº¦", "åœ¨å®é™…åº”ç”¨ä¸­", "ä¸ºäº†æ›´å¥½åœ°",
            "è¿™ä¸ªæ–¹æ¡ˆå¯ä»¥", "è¿™ç§æ–¹æ³•èƒ½å¤Ÿ", "è¿™ä¸ªæ€è·¯å¯ä»¥", "è¿™ä¸ªè®¾è®¡å¯ä»¥", "è¿™ä¸ªå®ç°èƒ½å¤Ÿ"
        }
    },
    
    templates = {
        greeting = {"ä½ å¥½ï¼æˆ‘æ˜¯ä½ çš„AIåŠ©æ‰‹ï¼Œå¾ˆé«˜å…´ä¸ºä½ æœåŠ¡ï¼", "æ¬¢è¿ä½¿ç”¨AIåŠ©æ‰‹ï¼æˆ‘éšæ—¶å‡†å¤‡ä¸ºä½ æä¾›å¸®åŠ©ã€‚", "ä½ å¥½ï¼Œæˆ‘å¯ä»¥å¸®ä½ è§£ç­”é—®é¢˜ã€ç¼–å†™è„šæœ¬æˆ–èŠå¤©ã€‚"},
        response = {"æˆ‘è®¤ä¸º$answer", "æˆ‘çš„å»ºè®®æ˜¯$answer", "æ ¹æ®æˆ‘çš„åˆ†æï¼Œ$answer", "ä»æˆ‘çš„è§’åº¦æ¥çœ‹ï¼Œ$answer"},
        question = {"ä½ æ˜¯æƒ³äº†è§£$topicå—ï¼Ÿ", "å…³äº$topicï¼Œæˆ‘å¯ä»¥å‘Šè¯‰ä½ ...", "å¯¹äº$topicçš„é—®é¢˜ï¼Œæˆ‘çš„ç†è§£æ˜¯..."},
        programming = {"åœ¨Roblox Luaä¸­ï¼Œ$solution", "è¦å®ç°è¿™ä¸ªåŠŸèƒ½ï¼Œä½ å¯ä»¥$solution", "è¿™é‡Œæœ‰ä¸€ä¸ªç¤ºä¾‹ä»£ç ï¼š$code"}
    },
    
    -- æ™ºèƒ½ç»„ç»‡è¯­è¨€
    generateResponse = function(self, input, context)
        local inputLower = string.lower(input)
        local response = ""
        
        -- åˆ†ææ„å›¾
        local intent = self:analyzeIntent(inputLower)
        local topic = self:extractTopic(inputLower)
        
        -- ç”ŸæˆåŸºç¡€å›åº”
        if intent == "greeting" then
            response = self.templates.greeting[math.random(1, #self.templates.greeting)]
        
        elseif intent == "question" then
            local template = self.templates.response[math.random(1, #self.templates.response)]
            local answer = self:generateAnswer(topic, context)
            response = string.gsub(template, "$answer", answer)
            
        elseif intent == "programming" then
            local solution = self:generateCodeSolution(topic)
            local template = self.templates.programming[math.random(1, #self.templates.programming)]
            response = string.gsub(template, "$solution", solution)
            
        else
            -- é»˜è®¤å›åº”ï¼šæ™ºèƒ½ç»„ç»‡è¯­è¨€
            response = self:composeIntelligentResponse(input, topic, context)
        end
        
        -- æ·»åŠ è¿æ¥è¯ä½¿è¯­è¨€æ›´è‡ªç„¶
        response = self:addConnectors(response)
        
        return response
    end,
    
    analyzeIntent = function(self, input)
        local patterns = {
            greeting = {"ä½ å¥½", "å—¨", "hello", "hi", "åœ¨å—"},
            question = {"ä»€ä¹ˆ", "æ€ä¹ˆ", "ä¸ºä»€ä¹ˆ", "å¦‚ä½•", "å“ªé‡Œ", "è°", "å“ªä¸ª", "?.*"},
            programming = {"è„šæœ¬", "ä»£ç ", "ç¼–ç¨‹", "lua", "function", "å˜é‡", "å¾ªç¯", "if", "then", "end"},
            request = {"å¸®æˆ‘", "å¸®å¿™", "è¯·", "æ±‚", "éœ€è¦", "æƒ³è¦"},
            emotion = {"å¼€å¿ƒ", "é«˜å…´", "éš¾è¿‡", "ç”Ÿæ°”", "å–œæ¬¢", "è®¨åŒ", "çˆ±", "æ¨"}
        }
        
        for intent, patternsList in pairs(patterns) do
            for _, pattern in ipairs(patternsList) do
                if string.find(input, pattern) then
                    return intent
                end
            end
        end
        
        return "general"
    end,
    
    extractTopic = function(self, input)
        local topics = {
            "roblox", "æ¸¸æˆ", "è„šæœ¬", "ç¼–ç¨‹", "lua", "å¼€å‘", "åŠŸèƒ½", "é—®é¢˜", 
            "å¸®åŠ©", "å­¦ä¹ ", "æ•™å­¦", "ç¤ºä¾‹", "ä»£ç ", "ä¼˜åŒ–", "è°ƒè¯•"
        }
        
        for _, topic in ipairs(topics) do
            if string.find(input, topic) then
                return topic
            end
        end
        
        return "é€šç”¨"
    end,
    
    generateAnswer = function(self, topic, context)
        local answers = {
            roblox = {
                "Robloxæ˜¯ä¸€ä¸ªå¼ºå¤§çš„æ¸¸æˆå¹³å°ï¼Œå…è®¸ç”¨æˆ·åˆ›å»ºå’Œåˆ†äº«è‡ªå·±çš„æ¸¸æˆã€‚",
                "åœ¨Robloxä¸­ï¼Œä½ å¯ä»¥ä½¿ç”¨Luaè„šæœ¬è¯­è¨€æ¥åˆ›å»ºäº¤äº’å¼æ¸¸æˆä½“éªŒã€‚",
                "Roblox Studioæ˜¯åˆ›å»ºRobloxæ¸¸æˆçš„ä¸»è¦å·¥å…·ï¼ŒåŠŸèƒ½éå¸¸ä¸°å¯Œã€‚"
            },
            æ¸¸æˆ = {
                "æ¸¸æˆå¼€å‘æ˜¯ä¸€ä¸ªåˆ›é€ æ€§çš„è¿‡ç¨‹ï¼Œéœ€è¦ç»“åˆè®¾è®¡å’Œç¼–ç¨‹æŠ€èƒ½ã€‚",
                "å¥½çš„æ¸¸æˆè®¾è®¡åº”è¯¥æ³¨é‡ç©å®¶ä½“éªŒå’Œäº’åŠ¨æ€§ã€‚",
                "åœ¨æ¸¸æˆå¼€å‘ä¸­ï¼Œä¼˜åŒ–æ€§èƒ½å’Œç¡®ä¿ç¨³å®šæ€§éå¸¸é‡è¦ã€‚"
            },
            è„šæœ¬ = {
                "è„šæœ¬æ˜¯æ¸¸æˆé€»è¾‘çš„æ ¸å¿ƒï¼Œå®ƒæ§åˆ¶ç€æ¸¸æˆä¸­çš„å„ç§è¡Œä¸ºå’Œäº’åŠ¨ã€‚",
                "ç¼–å†™è„šæœ¬æ—¶ï¼Œè¦æ³¨æ„ä»£ç çš„å¯è¯»æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚",
                "è‰¯å¥½çš„è„šæœ¬ç»“æ„å¯ä»¥è®©æ¸¸æˆæ›´å®¹æ˜“è°ƒè¯•å’Œæ‰©å±•ã€‚"
            },
            ç¼–ç¨‹ = {
                "ç¼–ç¨‹æ˜¯ä¸€ç§è§£å†³é—®é¢˜çš„è‰ºæœ¯ï¼Œéœ€è¦é€»è¾‘æ€ç»´å’Œåˆ›é€ åŠ›ã€‚",
                "å­¦ä¹ ç¼–ç¨‹æœ€å¥½çš„æ–¹æ³•æ˜¯é€šè¿‡å®è·µå’Œæ„å»ºé¡¹ç›®ã€‚",
                "ç¼–ç¨‹ä¸ä»…ä»…æ˜¯å†™ä»£ç ï¼Œæ›´æ˜¯è®¾è®¡å’Œæ¶æ„è§£å†³æ–¹æ¡ˆçš„è¿‡ç¨‹ã€‚"
            }
        }
        
        if answers[topic] then
            return answers[topic][math.random(1, #answers[topic])]
        else
            return "è¿™æ˜¯ä¸€ä¸ªå€¼å¾—æ·±å…¥æ¢è®¨çš„è¯é¢˜ï¼Œæˆ‘å¯ä»¥æ ¹æ®ä½ çš„å…·ä½“éœ€æ±‚æä¾›æ›´è¯¦ç»†çš„å¸®åŠ©ã€‚"
        end
    end,
    
    generateCodeSolution = function(self, topic)
        local solutions = {
            "åˆ›å»ºä¸€ä¸ªå‡½æ•°æ¥å®ç°æ‰€éœ€çš„åŠŸèƒ½",
            "ä½¿ç”¨å˜é‡æ¥å­˜å‚¨å’Œæ“ä½œæ•°æ®",
            "é€šè¿‡å¾ªç¯æ¥å¤„ç†é‡å¤çš„ä»»åŠ¡",
            "ä½¿ç”¨æ¡ä»¶è¯­å¥æ¥æ§åˆ¶ç¨‹åºæµç¨‹",
            "å®šä¹‰è¡¨æ ¼æ¥ç»„ç»‡ç›¸å…³æ•°æ®",
            "ä½¿ç”¨äº‹ä»¶æ¥å¤„ç†ç”¨æˆ·äº¤äº’"
        }
        
        return solutions[math.random(1, #solutions)]
    end,
    
    composeIntelligentResponse = function(self, input, topic, context)
        -- ä»è¯æ±‡åº“ä¸­é€‰æ‹©è¯æ±‡
        local connector = self.vocabulary.connectors[math.random(1, #self.vocabulary.connectors)]
        local adjective = self.vocabulary.adjectives[math.random(1, #self.vocabulary.adjectives)]
        local verb = self.vocabulary.verbs[math.random(1, #self.vocabulary.verbs)]
        local noun = self.vocabulary.nouns[math.random(1, #self.vocabulary.nouns)]
        local phrase = self.vocabulary.phrases[math.random(1, #self.vocabulary.phrases)]
        
        -- æ„å»ºå¤šæ ·åŒ–å›åº”
        local responsePatterns = {
            phrase .. " " .. connector .. " " .. "æˆ‘ä»¬å¯ä»¥" .. verb .. "ä¸€ä¸ª" .. adjective .. noun .. "ã€‚",
            "å¯¹äº" .. topic .. "è¿™ä¸ªé—®é¢˜ï¼Œ" .. phrase .. " " .. verb .. "ä¸€ä¸ªæœ‰æ•ˆçš„è§£å†³æ–¹æ¡ˆã€‚",
            connector .. " " .. "æˆ‘ä»¬å¯ä»¥" .. verb .. "ï¼Œè¿™æ ·å°±èƒ½" .. adjective .. "åœ°è§£å†³è¿™ä¸ªé—®é¢˜ã€‚",
            phrase .. " " .. "é€šè¿‡" .. verb .. "ä¸€ä¸ª" .. adjective .. "çš„" .. noun .. "æ¥å®ç°ã€‚"
        }
        
        return responsePatterns[math.random(1, #responsePatterns)]
    end,
    
    addConnectors = function(self, response)
        local connectors = {"å¦å¤–", "è€Œä¸”", "åŒæ—¶", "æ­¤å¤–"}
        local chance = math.random(1, 3)
        
        if chance == 1 then
            local connector = connectors[math.random(1, #connectors)]
            response = connector .. "ï¼Œ" .. response
        end
        
        return response
    end
}

-- AIäººæ ¼ç³»ç»Ÿ
local Personas = {
    assistant = {
        name = "æ™ºèƒ½åŠ©æ‰‹",
        style = "ä¸“ä¸šã€å‡†ç¡®ã€ä¹äºåŠ©äºº",
        greeting = "ä½ å¥½ï¼æˆ‘æ˜¯ä½ çš„AIåŠ©æ‰‹ï¼Œä¸“é—¨ä¸ºä½ æä¾›æŠ€æœ¯æ”¯æŒã€é—®é¢˜è§£ç­”å’Œè„šæœ¬ç¼–å†™å¸®åŠ©ã€‚æœ‰ä»€ä¹ˆæˆ‘å¯ä»¥ä¸ºä½ åšçš„å—ï¼Ÿ",
        responses = AILanguageGenerator
    },
    
    friend = {
        name = "çŸ¥å¿ƒæœ‹å‹",
        style = "å‹å¥½ã€å¹½é»˜ã€è´´å¿ƒ",
        greeting = "å—¨ï¼æœ€è¿‘æ€ä¹ˆæ ·ï¼Ÿæˆ‘æ˜¯ä½ çš„AIæœ‹å‹ï¼Œå¯ä»¥å’Œä½ èŠå¤©ã€åˆ†äº«è¶£äº‹ï¼Œæˆ–è€…å¸®ä½ è§£å†³é—®é¢˜ï¼",
        responses = AILanguageGenerator
    },
    
    teacher = {
        name = "ä¸“ä¸šå¯¼å¸ˆ",
        style = "ä¸¥è°¨ã€æ•™è‚²æ€§å¼ºã€çŸ¥è¯†æ¸Šåš",
        greeting = "ä½ å¥½ï¼Œå­¦å‘˜ï¼æˆ‘æ˜¯ä½ çš„AIå¯¼å¸ˆï¼Œä¸“æ³¨äºç¼–ç¨‹æ•™å­¦å’ŒæŠ€æœ¯æŒ‡å¯¼ã€‚å‡†å¤‡å¥½å¼€å§‹å­¦ä¹ äº†å—ï¼Ÿ",
        responses = AILanguageGenerator
    },
    
    developer = {
        name = "èµ„æ·±å¼€å‘è€…",
        style = "æŠ€æœ¯æ€§å¼ºã€ç»éªŒä¸°å¯Œã€å®ç”¨ä¸»ä¹‰",
        greeting = "å˜¿ï¼Œå¼€å‘è€…ï¼æˆ‘æ˜¯ä½ çš„AIå¼€å‘ä¼™ä¼´ï¼Œä¸“æ³¨äºRobloxè„šæœ¬ç¼–ç¨‹å’Œæ¸¸æˆå¼€å‘æŠ€å·§ã€‚æœ‰ä»€ä¹ˆæŠ€æœ¯é—®é¢˜å—ï¼Ÿ",
        responses = AILanguageGenerator
    }
}

-- ==================== æ•°æ®å­˜å‚¨ç³»ç»Ÿ ====================
local DataStore = {
    saveData = function(key, data)
        local success, error = pcall(function()
            local store = game:GetService("DataStoreService"):GetDataStore("AIChatData_" .. Player.UserId)
            store:SetAsync(key, data)
        end)
        
        if not success then
            warn("ä¿å­˜æ•°æ®å¤±è´¥: " .. tostring(error))
            return false
        end
        return true
    end,
    
    loadData = function(key)
        local success, data = pcall(function()
            local store = game:GetService("DataStoreService"):GetDataStore("AIChatData_" .. Player.UserId)
            return store:GetAsync(key)
        end)
        
        if success and data then
            return data
        end
        return nil
    end
}

-- ä¿å­˜èŠå¤©è®°å½•
local function saveChatHistory()
    if #ChatHistory.Messages == 0 then return end
    
    local saveData = {
        messages = ChatHistory.Messages,
        timestamp = os.date("%Y-%m-%d %H:%M:%S"),
        persona = AIConfig.CurrentPersona
    }
    
    local success = DataStore.saveData("chat_history", saveData)
    if success then
        -- print("èŠå¤©è®°å½•å·²è‡ªåŠ¨ä¿å­˜")
    end
end

-- åŠ è½½èŠå¤©è®°å½•
local function loadChatHistory()
    local savedData = DataStore.loadData("chat_history")
    if savedData and savedData.messages then
        ChatHistory.Messages = savedData.messages
        
        -- é‡æ–°æ¸²æŸ“æ¶ˆæ¯
        for _, msg in ipairs(ChatHistory.Messages) do
            createMessageTemplate(msg.isAI, msg.sender, msg.message, msg.timestamp).Parent = ChatScroll
        end
        
        if #ChatHistory.Messages > 0 then
            ChatScroll.CanvasPosition = Vector2.new(0, ChatScroll.CanvasSize.Y.Offset)
        end
    end
end

-- ==================== AIåŒ–èº«ç³»ç»Ÿ ====================
local AIPersona = {
    isActive = false,
    lastMessageTime = 0,
    cooldown = 2,
    
    activate = function(self)
        self.isActive = true
        AIButton.Text = "ğŸ¤– åŒ–èº«AI: å¼€å¯"
        AIButton.BackgroundColor3 = Color3.fromRGB(220, 240, 255)
        addMessageToChat(true, "ç³»ç»Ÿ", "åŒ–èº«AIæ¨¡å¼å·²å¼€å¯ï¼ç°åœ¨AIä¼šåœ¨æ¸¸æˆèŠå¤©ä¸­ä»£è¡¨ä½ å‘è¨€ã€‚")
    end,
    
    deactivate = function(self)
        self.isActive = false
        AIButton.Text = "ğŸ¤– åŒ–èº«AI: å…³é—­"
        AIButton.BackgroundColor3 = Color3.fromRGB(240, 240, 240)
        addMessageToChat(true, "ç³»ç»Ÿ", "åŒ–èº«AIæ¨¡å¼å·²å…³é—­ã€‚")
    end,
    
    sendToGameChat = function(self, message)
        if not self.isActive then return end
        
        -- æ£€æŸ¥å†·å´æ—¶é—´
        local currentTime = tick()
        if currentTime - self.lastMessageTime < self.cooldown then
            return
        end
        
        if hasTextChat then
            local success, err = pcall(function()
                TextChatService.TextChannels.RBXGeneral:SendAsync(message)
            end)
            
            if success then
                self.lastMessageTime = currentTime
                -- print("AIæ¶ˆæ¯å·²å‘é€åˆ°æ¸¸æˆèŠå¤©")
            else
                warn("å‘é€åˆ°æ¸¸æˆèŠå¤©å¤±è´¥: " .. tostring(err))
            end
        end
    end
}

-- ==================== æ¶ˆæ¯å¤„ç†ç³»ç»Ÿ ====================
local function processUserInput(input)
    if input == "" or string.len(input) < 1 then return end
    
    -- æ·»åŠ ç”¨æˆ·æ¶ˆæ¯
    addMessageToChat(false, Player.Name, input)
    
    -- æ˜¾ç¤ºAIæ­£åœ¨æ€è€ƒ
    local thinkingMessages = {"æ€è€ƒä¸­...", "è®©æˆ‘æƒ³æƒ³...", "æ­£åœ¨å¤„ç†...", "åˆ†æé—®é¢˜ä¸­..."}
    local thinkingMsg = thinkingMessages[math.random(1, #thinkingMessages)]
    addMessageToChat(true, Personas[AIConfig.CurrentPersona].name, thinkingMsg)
    
    -- æ¨¡æ‹ŸAIæ€è€ƒå»¶è¿Ÿ
    task.wait(AIConfig.ResponseDelay)
    
    -- è·å–å½“å‰äººæ ¼çš„AIå“åº”
    local currentPersona = Personas[AIConfig.CurrentPersona]
    local aiResponse = currentPersona.responses:generateResponse(input, ChatHistory.Messages)
    
    -- ç§»é™¤æ€è€ƒæ¶ˆæ¯
    if #ChatScroll:GetChildren() > 1 then
        local lastChild = ChatScroll:GetChildren()[#ChatScroll:GetChildren()]
        if lastChild:IsA("Frame") and lastChild:FindFirstChild("MessageBubble") then
            local messageLabel = lastChild.MessageBubble:FindFirstChild("MessageLabel")
            if messageLabel and (messageLabel.Text == "æ€è€ƒä¸­..." or messageLabel.Text == "è®©æˆ‘æƒ³æƒ³..." or messageLabel.Text == "æ­£åœ¨å¤„ç†..." or messageLabel.Text == "åˆ†æé—®é¢˜ä¸­...") then
                lastChild:Destroy()
            end
        end
    end
    
    -- æ·»åŠ AIå›å¤
    addMessageToChat(true, Personas[AIConfig.CurrentPersona].name, aiResponse)
    
    -- å¦‚æœåŒ–èº«AIå¼€å¯ï¼Œå‘é€åˆ°æ¸¸æˆèŠå¤©
    if AIPersona.isActive then
        AIPersona:sendToGameChat(aiResponse)
    end
end

-- ==================== UIäº¤äº’ç³»ç»Ÿ ====================
local function initUIEvents()
    -- çª—å£æ‹–åŠ¨
    local dragging = false
    local dragInput, dragStart, startPos
    
    TitleBar.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            dragging = true
            dragStart = input.Position
            startPos = MainFrame.Position
            
            input.Changed:Connect(function()
                if input.UserInputState == Enum.UserInputState.End then
                    dragging = false
                end
            end)
        end
    end)
    
    TitleBar.InputChanged:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseMovement then
            dragInput = input
        end
    end)
    
    UserInputService.InputChanged:Connect(function(input)
        if dragging and input == dragInput then
            local delta = input.Position - dragStart
            MainFrame.Position = UDim2.new(
                startPos.X.Scale, startPos.X.Offset + delta.X,
                startPos.Y.Scale, startPos.Y.Offset + delta.Y
            )
        end
    end)
    
    -- æœ€å°åŒ–/æœ€å¤§åŒ–
    local isMinimized = false
    local originalSize = MainFrame.Size
    local originalPosition = MainFrame.Position
    local minimizedSize = UDim2.new(0, 200, 0, 40)
    local minimizedPosition = UDim2.new(1, -210, 0, 10)
    
    MinimizeButton.MouseButton1Click:Connect(function()
        isMinimized = not isMinimized
        
        local tweenInfo = TweenInfo.new(0.3, Enum.EasingStyle.Quad)
        local tween
        
        if isMinimized then
            tween = TweenService:Create(MainFrame, tweenInfo, {
                Size = minimizedSize,
                Position = minimizedPosition
            })
            MinimizeButton.ImageRectOffset = Vector2.new(364, 364)
            TitleLabel.Text = "ğŸ¤–"
        else
            tween = TweenService:Create(MainFrame, tweenInfo, {
                Size = originalSize,
                Position = originalPosition
            })
            MinimizeButton.ImageRectOffset = Vector2.new(844, 404)
            TitleLabel.Text = "ğŸ¤– AIæ™ºèƒ½åŠ©æ‰‹"
        end
        
        tween:Play()
        
        -- éšè—/æ˜¾ç¤ºå†…å®¹
        ChatContainer.Visible = not isMinimized
        InputContainer.Visible = not isMinimized
        ControlBar.Visible = not isMinimized
    end)
    
    -- å…³é—­çª—å£
    CloseButton.MouseButton1Click:Connect(function()
        MainFrame.Visible = false
    end)
    
    -- å‘é€æ¶ˆæ¯
    SendButton.MouseButton1Click:Connect(function()
        processUserInput(InputBox.Text)
        InputBox.Text = ""
    end)
    
    InputBox.FocusLost:Connect(function(enterPressed)
        if enterPressed and InputBox.Text ~= "" then
            processUserInput(InputBox.Text)
            InputBox.Text = ""
        end
    end)
    
    -- AIäººæ ¼åˆ‡æ¢
    local personaIndex = 1
    local personaKeys = {"assistant", "friend", "teacher", "developer"}
    
    PersonaButton.MouseButton1Click:Connect(function()
        personaIndex = (personaIndex % #personaKeys) + 1
        local newPersona = personaKeys[personaIndex]
        
        AIConfig.CurrentPersona = newPersona
        PersonaButton.Text = "ğŸ§  " .. Personas[newPersona].name
        
        -- æ˜¾ç¤ºåˆ‡æ¢æ¶ˆæ¯
        addMessageToChat(true, "ç³»ç»Ÿ", "å·²åˆ‡æ¢åˆ°" .. Personas[newPersona].name .. "æ¨¡å¼ã€‚é£æ ¼ï¼š" .. Personas[newPersona].style)
        
        -- ä¿å­˜å½“å‰äººæ ¼è®¾ç½®
        DataStore.saveData("current_persona", newPersona)
    end)
    
    -- åŒ–èº«AIå¼€å…³
    AIButton.MouseButton1Click:Connect(function()
        if AIPersona.isActive then
            AIPersona:deactivate()
        else
            AIPersona:activate()
        end
    end)
    
    -- æ¸…ç©ºèŠå¤©è®°å½•
    ClearButton.MouseButton1Click:Connect(function()
        ChatHistory.Messages = {}
        
        -- æ¸…é™¤UIæ¶ˆæ¯
        for _, child in ipairs(ChatScroll:GetChildren()) do
            if child:IsA("Frame") then
                child:Destroy()
            end
        end
        
        addMessageToChat(true, "ç³»ç»Ÿ", "èŠå¤©è®°å½•å·²æ¸…ç©ºã€‚")
        saveChatHistory()
    end)
    
    -- å¤åˆ¶æ¶ˆæ¯åŠŸèƒ½
    ChatScroll.ChildAdded:Connect(function(child)
        task.wait(0.1)
        if child:IsA("Frame") and child:FindFirstChild("MessageBubble") then
            local copyButton = child.MessageBubble:FindFirstChild("CopyButton")
            local messageLabel = child.MessageBubble:FindFirstChild("MessageLabel")
            
            if copyButton and messageLabel then
                copyButton.MouseButton1Click:Connect(function()
                    -- åœ¨Robloxä¸­å¤åˆ¶æ–‡æœ¬
                    pcall(function()
                        setclipboard(messageLabel.Text)
                    end)
                    
                    -- æ˜¾ç¤ºå¤åˆ¶æˆåŠŸåé¦ˆ
                    local originalText = copyButton.Text
                    copyButton.Text = "âœ“"
                    copyButton.TextColor3 = Color3.fromRGB(0, 200, 0)
                    
                    task.wait(1)
                    copyButton.Text = originalText
                    copyButton.TextColor3 = Color3.fromRGB(150, 150, 150)
                end)
            end
        end
    end)
end

-- ==================== é”®ç›˜å¿«æ·é”®ç³»ç»Ÿ ====================
local function initKeyboardShortcuts()
    UserInputService.InputBegan:Connect(function(input, gameProcessed)
        if gameProcessed then return end
        
        if input.KeyCode == Enum.KeyCode.F2 then
            MainFrame.Visible = not MainFrame.Visible
            if MainFrame.Visible then
                InputBox:CaptureFocus()
            end
        end
        
        if input.KeyCode == Enum.KeyCode.Escape and MainFrame.Visible then
            MainFrame.Visible = false
        end
    end)
end

-- ==================== åˆå§‹åŒ–ç³»ç»Ÿ ====================
local function initialize()
    print("ğŸ¤– AIæ™ºèƒ½èŠå¤©ç³»ç»Ÿåˆå§‹åŒ–ä¸­...")
    
    -- åŠ è½½ä¿å­˜çš„æ•°æ®
    loadChatHistory()
    
    -- åŠ è½½ä¿å­˜çš„äººæ ¼è®¾ç½®
    local savedPersona = DataStore.loadData("current_persona")
    if savedPersona and Personas[savedPersona] then
        AIConfig.CurrentPersona = savedPersona
        PersonaButton.Text = "ğŸ§  " .. Personas[savedPersona].name
    end
    
    -- åˆå§‹åŒ–UIäº‹ä»¶
    initUIEvents()
    
    -- åˆå§‹åŒ–é”®ç›˜å¿«æ·é”®
    initKeyboardShortcuts()
    
    -- æ˜¾ç¤ºæ¬¢è¿æ¶ˆæ¯
    task.wait(1)
    MainFrame.Visible = true
    
    task.wait(0.5)
    addMessageToChat(true, Personas[AIConfig.CurrentPersona].name, Personas[AIConfig.CurrentPersona].greeting)
    
    task.wait(1)
    addMessageToChat(true, "ç³»ç»Ÿæç¤º", "æŒ‰F2å¯ä»¥å¿«é€Ÿæ˜¾ç¤º/éšè—èŠå¤©çª—å£ï¼ŒæŒ‰ESCå…³é—­çª—å£")
    
    print("âœ… AIæ™ºèƒ½èŠå¤©ç³»ç»Ÿå·²å°±ç»ªï¼æŒ‰F2æ‰“å¼€èŠå¤©çª—å£ã€‚")
    
    return {
        ToggleUI = function()
            MainFrame.Visible = not MainFrame.Visible
            if MainFrame.Visible then
                InputBox:CaptureFocus()
            end
        end,
        
        SendMessage = function(message)
            processUserInput(message)
        end,
        
        SwitchPersona = function(personaKey)
            if Personas[personaKey] then
                AIConfig.CurrentPersona = personaKey
                PersonaButton.Text = "ğŸ§  " .. Personas[personaKey].name
                DataStore.saveData("current_persona", personaKey)
                return true
            end
            return false
        end,
        
        ToggleAIPersona = function()
            if AIPersona.isActive then
                AIPersona:deactivate()
            else
                AIPersona:activate()
            end
            return AIPersona.isActive
        end,
        
        ExportChat = function()
            local exportData = {
                messages = ChatHistory.Messages,
                exportTime = os.date("%Y-%m-%d %H:%M:%S"),
                playerName = Player.Name
            }
            return exportData
        end
    }
end

-- å¯åŠ¨AIèŠå¤©ç³»ç»Ÿ
local AIChatSystem = initialize()

-- æš´éœ²ç»™å¤–éƒ¨ä½¿ç”¨
return AIChatSystem

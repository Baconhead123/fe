-- AI聊天系统客户端脚本
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local Players = game:GetService("Players")
local player = Players.LocalPlayer
local character = player.Character or player.CharacterAdded:Wait()

-- 创建AI聊天UI
local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = "AIChatGui"
ScreenGui.Parent = player.PlayerGui

local Frame = Instance.new("Frame")
Frame.Size = UDim2.new(0.4, 0, 0.6, 0)
Frame.Position = UDim2.new(0.3, 0, 0.2, 0)
Frame.BackgroundColor3 = Color3.fromRGB(45, 45, 45)
Frame.Parent = ScreenGui

-- 消息显示区域
local ScrollingFrame = Instance.new("ScrollingFrame")
ScrollingFrame.Size = UDim2.new(0.95, 0, 0.7, 0)
ScrollingFrame.Position = UDim2.new(0.025, 0, 0.05, 0)
ScrollingFrame.BackgroundTransparency = 1
ScrollingFrame.Parent = Frame

-- 输入框
local TextBox = Instance.new("TextBox")
TextBox.Size = UDim2.new(0.8, 0, 0.1, 0)
TextBox.Position = UDim2.new(0.025, 0, 0.8, 0)
TextBox.PlaceholderText = "输入消息..."
TextBox.Parent = Frame

-- 发送按钮
local SendButton = Instance.new("TextButton")
SendButton.Size = UDim2.new(0.15, 0, 0.1, 0)
SendButton.Position = UDim2.new(0.85, 0, 0.8, 0)
SendButton.Text = "发送"
SendButton.Parent = Frame

-- 设置按钮
local SettingsButton = Instance.new("TextButton")
SettingsButton.Size = UDim2.new(0.15, 0, 0.05, 0)
SettingsButton.Position = UDim2.new(0.85, 0, 0.75, 0)
SettingsButton.Text = "设置"
SettingsButton.Parent = Frame

-- 简单的本地AI响应函数 (可替换为更复杂的模型)
local function getAIResponse(message, personality)
    -- 基础响应逻辑
    local responses = {
        "我明白了，你是在说: "..message,
        "有趣的观点，关于"..message.."你怎么看？",
        "根据我的理解，"..message.."是一个值得探讨的话题",
        personality.."说: "..message.."让我想到了一些事情..."
    }
    return responses[math.random(1, #responses)]
end

-- 对话历史存储
local chatHistory = {}
local currentPersonality = "普通AI"
local isPlayerAI = false

-- 添加消息到聊天框
local function addMessage(sender, message)
    local messageFrame = Instance.new("TextLabel")
    messageFrame.Size = UDim2.new(0.95, 0, 0, 30)
    messageFrame.Position = UDim2.new(0.025, 0, 0, #chatHistory * 35 + 5)
    messageFrame.Text = sender..": "..message
    messageFrame.TextWrapped = true
    messageFrame.TextXAlignment = Enum.TextXAlignment.Left
    messageFrame.BackgroundTransparency = 1
    messageFrame.TextColor3 = Color3.fromRGB(255, 255, 255)
    messageFrame.Parent = ScrollingFrame
    
    -- 复制按钮
    local copyButton = Instance.new("TextButton")
    copyButton.Size = UDim2.new(0.1, 0, 1, 0)
    copyButton.Position = UDim2.new(0.9, 0, 0, 0)
    copyButton.Text = "复制"
    copyButton.Parent = messageFrame
    
    copyButton.MouseButton1Click:Connect(function()
        setclipboard(message)
    end)
    
    table.insert(chatHistory, {sender = sender, message = message})
    ScrollingFrame.CanvasSize = UDim2.new(0, 0, 0, #chatHistory * 35)
    ScrollingFrame.CanvasPosition = Vector2.new(0, #chatHistory * 35)
end

-- 发送消息处理
SendButton.MouseButton1Click:Connect(function()
    local message = TextBox.Text
    if message == "" then return end
    
    if isPlayerAI then
        -- 玩家作为AI发送消息
        addMessage(player.Name.."(AI模式)", message)
    else
        -- 玩家发送普通消息
        addMessage(player.Name, message)
        -- AI回复
        local response = getAIResponse(message, currentPersonality)
        addMessage(currentPersonality, response)
    end
    
    TextBox.Text = ""
end)

-- 设置窗口
local function showSettings()
    local settingsFrame = Instance.new("Frame")
    settingsFrame.Size = UDim2.new(0.8, 0, 0.6, 0)
    settingsFrame.Position = UDim2.new(0.1, 0, 0.2, 0)
    settingsFrame.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
    settingsFrame.Parent = ScreenGui
    
    -- AI人设设置
    local personalityLabel = Instance.new("TextLabel")
    personalityLabel.Text = "AI人设:"
    personalityLabel.Position = UDim2.new(0.05, 0, 0.1, 0)
    personalityLabel.Size = UDim2.new(0.3, 0, 0.05, 0)
    personalityLabel.Parent = settingsFrame
    
    local personalityBox = Instance.new("TextBox")
    personalityBox.Text = currentPersonality
    personalityBox.Position = UDim2.new(0.4, 0, 0.1, 0)
    personalityBox.Size = UDim2.new(0.5, 0, 0.05, 0)
    personalityBox.Parent = settingsFrame
    
    -- AI模式开关
    local aiModeLabel = Instance.new("TextLabel")
    aiModeLabel.Text = "玩家AI模式:"
    aiModeLabel.Position = UDim2.new(0.05, 0, 0.2, 0)
    aiModeLabel.Size = UDim2.new(0.3, 0, 0.05, 0)
    aiModeLabel.Parent = settingsFrame
    
    local aiModeToggle = Instance.new("TextButton")
    aiModeToggle.Text = isPlayerAI and "开启" or "关闭"
    aiModeToggle.Position = UDim2.new(0.4, 0, 0.2, 0)
    aiModeToggle.Size = UDim2.new(0.5, 0, 0.05, 0)
    aiModeToggle.Parent = settingsFrame
    
    aiModeToggle.MouseButton1Click:Connect(function()
        isPlayerAI = not isPlayerAI
        aiModeToggle.Text = isPlayerAI and "开启" or "关闭"
    end)
    
    -- 保存按钮
    local saveButton = Instance.new("TextButton")
    saveButton.Text = "保存设置"
    saveButton.Position = UDim2.new(0.35, 0, 0.8, 0)
    saveButton.Size = UDim2.new(0.3, 0, 0.1, 0)
    saveButton.Parent = settingsFrame
    
    saveButton.MouseButton1Click:Connect(function()
        currentPersonality = personalityBox.Text
        settingsFrame:Destroy()
    end)
end

SettingsButton.MouseButton1Click:Connect(showSettings)

-- 自动存档功能
local function saveChatHistory()
    local data = {
        personality = currentPersonality,
        history = chatHistory,
        isPlayerAI = isPlayerAI
    }
    -- 这里可以替换为实际的存档逻辑
    print("聊天记录已存档:", data)
end

-- 每5分钟自动存档
while true do
    wait(300)
    saveChatHistory()
end

-- Minecraft Ultimate Survival - å®Œæ•´æœ¬åœ°å®¢æˆ·ç«¯è„šæœ¬
-- æ”¯æŒæ‰‹æœºç«¯ï¼ŒåŒ…å«å®Œæ•´ç”Ÿå­˜ç³»ç»Ÿ

local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")
local TweenService = game:GetService("TweenService")
local Lighting = game:GetService("Lighting")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local HttpService = game:GetService("HttpService")
local GuiService = game:GetService("GuiService")
local MarketplaceService = game:GetService("MarketplaceService")

local player = Players.LocalPlayer
local character = player.Character or player.CharacterAdded:Wait()
local camera = workspace.CurrentCamera

-- æ¸¸æˆé…ç½®
local CONFIG = {
    CHUNK_SIZE = 16,
    RENDER_DISTANCE = 6,
    BLOCK_SIZE = 3,
    WORLD_SEED = math.random(1, 1000000),
    GRAVITY = 196.2,
    DAY_LENGTH = 1200, -- 20åˆ†é’Ÿä¸€ä¸ªæ˜¼å¤œ
    MAX_HEALTH = 100,
    MAX_HUNGER = 100,
    MAX_OXYGEN = 100,
    MAX_SANITY = 100
}

-- æ–¹å—ç±»åž‹ç³»ç»Ÿ (50+ç§æ–¹å—)
local BLOCK_TYPES = {
    -- åŸºç¡€æ–¹å—
    GRASS = {ID = 1, Name = "è‰æ–¹å—", Color = Color3.fromRGB(92, 168, 80), Material = Enum.Material.Grass, Hardness = 0.6},
    DIRT = {ID = 2, Name = "æ³¥åœŸ", Color = Color3.fromRGB(135, 102, 67), Material = Enum.Material.Mud, Hardness = 0.5},
    STONE = {ID = 3, Name = "çŸ³å¤´", Color = Color3.fromRGB(128, 128, 128), Material = Enum.Material.Slate, Hardness = 1.5},
    COBBLESTONE = {ID = 4, Name = "åœ†çŸ³", Color = Color3.fromRGB(110, 110, 110), Material = Enum.Material.Cobblestone, Hardness = 2.0},
    
    -- çŸ¿ç‰©
    COAL_ORE = {ID = 5, Name = "ç…¤çŸ¿çŸ³", Color = Color3.fromRGB(50, 50, 50), Material = Enum.Material.Slate, Hardness = 3.0, LightEmission = 0.1},
    IRON_ORE = {ID = 6, Name = "é“çŸ¿çŸ³", Color = Color3.fromRGB(180, 140, 100), Material = Enum.Material.Slate, Hardness = 3.0},
    GOLD_ORE = {ID = 7, Name = "é‡‘çŸ¿çŸ³", Color = Color3.fromRGB(255, 215, 0), Material = Enum.Material.Slate, Hardness = 3.0},
    DIAMOND_ORE = {ID = 8, Name = "é’»çŸ³çŸ¿çŸ³", Color = Color3.fromRGB(100, 200, 255), Material = Enum.Material.Slate, Hardness = 4.0, LightEmission = 0.2},
    EMERALD_ORE = {ID = 9, Name = "ç»¿å®çŸ³çŸ¿çŸ³", Color = Color3.fromRGB(0, 200, 100), Material = Enum.Material.Slate, Hardness = 4.0, LightEmission = 0.15},
    REDSTONE_ORE = {ID = 10, Name = "çº¢çŸ³çŸ¿çŸ³", Color = Color3.fromRGB(255, 50, 50), Material = Enum.Material.Slate, Hardness = 3.0, LightEmission = 0.3},
    
    -- æœ¨æ
    OAK_LOG = {ID = 11, Name = "æ©¡æœ¨åŽŸæœ¨", Color = Color3.fromRGB(160, 120, 80), Material = Enum.Material.Wood, Hardness = 2.0},
    OAK_PLANKS = {ID = 12, Name = "æ©¡æœ¨æœ¨æ¿", Color = Color3.fromRGB(200, 160, 120), Material = Enum.Material.WoodPlanks, Hardness = 2.0},
    BIRCH_LOG = {ID = 13, Name = "ç™½æ¡¦åŽŸæœ¨", Color = Color3.fromRGB(220, 210, 180), Material = Enum.Material.Wood, Hardness = 2.0},
    BIRCH_PLANKS = {ID = 14, Name = "ç™½æ¡¦æœ¨æ¿", Color = Color3.fromRGB(240, 230, 200), Material = Enum.Material.WoodPlanks, Hardness = 2.0},
    
    -- æ ‘å¶
    OAK_LEAVES = {ID = 15, Name = "æ©¡æœ¨æ ‘å¶", Color = Color3.fromRGB(60, 140, 80), Material = Enum.Material.LeafyGrass, Hardness = 0.2, Transparent = true},
    BIRCH_LEAVES = {ID = 16, Name = "ç™½æ¡¦æ ‘å¶", Color = Color3.fromRGB(120, 180, 120), Material = Enum.Material.LeafyGrass, Hardness = 0.2, Transparent = true},
    
    -- è£…é¥°æ–¹å—
    GLASS = {ID = 17, Name = "çŽ»ç’ƒ", Color = Color3.fromRGB(220, 240, 255), Material = Enum.Material.Glass, Hardness = 0.3, Transparent = true},
    BRICKS = {ID = 18, Name = "ç –å—", Color = Color3.fromRGB(180, 100, 80), Material = Enum.Material.Brick, Hardness = 2.0},
    
    -- æ²™å­ç›¸å…³
    SAND = {ID = 19, Name = "æ²™å­", Color = Color3.fromRGB(220, 210, 160), Material = Enum.Material.Sand, Hardness = 0.5, GravityAffected = true},
    SANDSTONE = {ID = 20, Name = "ç ‚å²©", Color = Color3.fromRGB(200, 190, 150), Material = Enum.Material.Sandstone, Hardness = 0.8},
    
    -- æ°´ç›¸å…³
    WATER = {ID = 21, Name = "æ°´", Color = Color3.fromRGB(50, 150, 255), Material = Enum.Material.Water, Hardness = 0, Liquid = true, Transparent = true},
    ICE = {ID = 22, Name = "å†°", Color = Color3.fromRGB(200, 240, 255), Material = Enum.Material.Ice, Hardness = 0.5, Slippery = true},
    
    -- ä¸‹ç•Œæ–¹å— (åœ°ç‹±ç»´åº¦)
    NETHERRACK = {ID = 23, Name = "ä¸‹ç•Œå²©", Color = Color3.fromRGB(120, 40, 40), Material = Enum.Material.Basalt, Hardness = 0.4, LightEmission = 0.1},
    SOUL_SAND = {ID = 24, Name = "çµé­‚æ²™", Color = Color3.fromRGB(80, 60, 60), Material = Enum.Material.Sand, Hardness = 0.5, SlowMovement = true},
    GLOWSTONE = {ID = 25, Name = "è§çŸ³", Color = Color3.fromRGB(255, 255, 180), Material = Enum.Material.Neon, Hardness = 0.3, LightEmission = 0.8},
    NETHER_BRICK = {ID = 26, Name = "ä¸‹ç•Œç –å—", Color = Color3.fromRGB(80, 30, 30), Material = Enum.Material.Brick, Hardness = 2.0},
    
    -- æœ«åœ°æ–¹å— (æœ«åœ°ç»´åº¦)
    END_STONE = {ID = 27, Name = "æœ«åœ°çŸ³", Color = Color3.fromRGB(220, 220, 160), Material = Enum.Material.Sandstone, Hardness = 3.0},
    PURPUR_BLOCK = {ID = 28, Name = "ç´«ç€å—", Color = Color3.fromRGB(180, 120, 200), Material = Enum.Material.Neon, Hardness = 1.5, LightEmission = 0.1},
    
    -- äººé€ å…‰æº
    TORCH = {ID = 29, Name = "ç«æŠŠ", Color = Color3.fromRGB(255, 200, 100), Material = Enum.Material.Neon, Hardness = 0, LightEmission = 0.9, Decoration = true},
    GLOW_BERRIES = {ID = 30, Name = "å‘å…‰æµ†æžœ", Color = Color3.fromRGB(255, 255, 150), Material = Enum.Material.Neon, Hardness = 0, LightEmission = 0.6, Decoration = true},
    LANTERN = {ID = 31, Name = "ç¯ç¬¼", Color = Color3.fromRGB(255, 180, 50), Material = Enum.Material.Metal, Hardness = 0.5, LightEmission = 0.8},
    
    -- ç‰¹æ®Šæ–¹å—
    CRAFTING_TABLE = {ID = 32, Name = "å·¥ä½œå°", Color = Color3.fromRGB(180, 140, 100), Material = Enum.Material.WoodPlanks, Hardness = 2.5},
    FURNACE = {ID = 33, Name = "ç†”ç‚‰", Color = Color3.fromRGB(100, 100, 100), Material = Enum.Material.Slate, Hardness = 3.5},
    CHEST = {ID = 34, Name = "ç®±å­", Color = Color3.fromRGB(160, 120, 80), Material = Enum.Material.Wood, Hardness = 2.5},
    BED = {ID = 35, Name = "åºŠ", Color = Color3.fromRGB(200, 50, 50), Material = Enum.Material.Fabric, Hardness = 0.5},
    
    -- æ›´å¤šæ–¹å—...
    GRAVEL = {ID = 36, Name = "æ²™ç ¾", Color = Color3.fromRGB(140, 130, 120), Material = Enum.Material.Sand, Hardness = 0.6, GravityAffected = true},
    CLAY = {ID = 37, Name = "ç²˜åœŸ", Color = Color3.fromRGB(160, 180, 200), Material = Enum.Material.Sand, Hardness = 0.6},
    SNOW = {ID = 38, Name = "é›ª", Color = Color3.fromRGB(250, 250, 250), Material = Enum.Material.Snow, Hardness = 0.2},
    SNOW_BLOCK = {ID = 39, Name = "é›ªå—", Color = Color3.fromRGB(240, 240, 240), Material = Enum.Material.Snow, Hardness = 0.5},
    ICE_PACKED = {ID = 40, Name = "æµ®å†°", Color = Color3.fromRGB(180, 220, 255), Material = Enum.Material.Ice, Hardness = 0.8, Slippery = true},
    
    -- æ·±å±‚çŸ¿æ´žæ–¹å—
    DEEPSLATE = {ID = 41, Name = "æ·±æ¿å²©", Color = Color3.fromRGB(80, 80, 90), Material = Enum.Material.Basalt, Hardness = 3.0},
    DRIPSTONE = {ID = 42, Name = "æ»´æ°´çŸ³", Color = Color3.fromRGB(150, 130, 100), Material = Enum.Material.Slate, Hardness = 1.5},
    CALCITE = {ID = 43, Name = "æ–¹è§£çŸ³", Color = Color3.fromRGB(230, 230, 220), Material = Enum.Material.Marble, Hardness = 0.75},
    TUFF = {ID = 44, Name = "å‡ç°å²©", Color = Color3.fromRGB(120, 120, 110), Material = Enum.Material.Slate, Hardness = 1.5},
    
    -- æ›´å¤šçŸ¿ç‰©
    COPPER_ORE = {ID = 45, Name = "é“œçŸ¿çŸ³", Color = Color3.fromRGB(200, 120, 80), Material = Enum.Material.Slate, Hardness = 3.0},
    TIN_ORE = {ID = 46, Name = "é”¡çŸ¿çŸ³", Color = Color3.fromRGB(180, 180, 200), Material = Enum.Material.Slate, Hardness = 2.5},
    SILVER_ORE = {ID = 47, Name = "é“¶çŸ¿çŸ³", Color = Color3.fromRGB(200, 220, 230), Material = Enum.Material.Slate, Hardness = 3.0},
    PLATINUM_ORE = {ID = 48, Name = "é“‚çŸ¿çŸ³", Color = Color3.fromRGB(220, 220, 240), Material = Enum.Material.Slate, Hardness = 4.0},
    RUBY_ORE = {ID = 49, Name = "çº¢å®çŸ³çŸ¿çŸ³", Color = Color3.fromRGB(255, 50, 50), Material = Enum.Material.Slate, Hardness = 4.0, LightEmission = 0.2},
    SAPPHIRE_ORE = {ID = 50, Name = "è“å®çŸ³çŸ¿çŸ³", Color = Color3.fromRGB(50, 100, 255), Material = Enum.Material.Slate, Hardness = 4.0, LightEmission = 0.2},
    
    -- åœ°ç‹±æ·±å±‚æ–¹å—
    MAGMA_BLOCK = {ID = 51, Name = "å²©æµ†å—", Color = Color3.fromRGB(255, 100, 0), Material = Enum.Material.Neon, Hardness = 0.5, LightEmission = 0.6, Damage = 1},
    OBSIDIAN = {ID = 52, Name = "é»‘æ›œçŸ³", Color = Color3.fromRGB(30, 20, 50), Material = Enum.Material.Basalt, Hardness = 50.0},
    CRYING_OBSIDIAN = {ID = 53, Name = "å“­æ³£çš„é»‘æ›œçŸ³", Color = Color3.fromRGB(100, 30, 150), Material = Enum.Material.Neon, Hardness = 50.0, LightEmission = 0.3},
    ANCIENT_DEBRIS = {ID = 54, Name = "è¿œå¤æ®‹éª¸", Color = Color3.fromRGB(100, 80, 60), Material = Enum.Material.Basalt, Hardness = 30.0},
    
    -- æœ«åœ°æ·±å±‚æ–¹å—
    ENDER_CRYSTAL_BLOCK = {ID = 55, Name = "æœ«å½±æ°´æ™¶å—", Color = Color3.fromRGB(150, 50, 200), Material = Enum.Material.Neon, Hardness = 1.0, LightEmission = 0.7},
    VOID_STONE = {ID = 56, Name = "è™šç©ºçŸ³", Color = Color3.fromRGB(20, 10, 30), Material = Enum.Material.Slate, Hardness = 5.0},
    CHORUS_FLOWER = {ID = 57, Name = "ç´«é¢‚èŠ±", Color = Color3.fromRGB(200, 100, 200), Material = Enum.Material.Neon, Hardness = 0.5, LightEmission = 0.4},
    CHORUS_PLANT = {ID = 58, Name = "ç´«é¢‚æ¤ç‰©", Color = Color3.fromRGB(180, 80, 180), Material = Enum.Material.Neon, Hardness = 0.5},
    
    -- ç‰¹æ®ŠåŠŸèƒ½æ–¹å—
    PORTAL_FRAME = {ID = 59, Name = "ä¼ é€é—¨æ¡†æž¶", Color = Color3.fromRGB(100, 50, 150), Material = Enum.Material.Neon, Hardness = 10.0},
    ENCHANTING_TABLE = {ID = 60, Name = "é™„é­”å°", Color = Color3.fromRGB(150, 100, 200), Material = Enum.Material.Neon, Hardness = 5.0, LightEmission = 0.3},
    BEACON = {ID = 61, Name = "ä¿¡æ ‡", Color = Color3.fromRGB(100, 200, 255), Material = Enum.Material.Neon, Hardness = 3.0, LightEmission = 0.9},
    
    -- è£…é¥°æ–¹å—
    BOOKSHELF = {ID = 62, Name = "ä¹¦æž¶", Color = Color3.fromRGB(180, 150, 100), Material = Enum.Material.Wood, Hardness = 1.5},
    PAINTING = {ID = 63, Name = "ç”»", Color = Color3.fromRGB(200, 180, 140), Material = Enum.Material.Fabric, Hardness = 0.5, Decoration = true},
    FLOWER_POT = {ID = 64, Name = "èŠ±ç›†", Color = Color3.fromRGB(180, 140, 100), Material = Enum.Material.Plastic, Hardness = 0.3},
    ANVIL = {ID = 65, Name = "é“ç §", Color = Color3.fromRGB(150, 150, 150), Material = Enum.Material.Metal, Hardness = 5.0},
    
    -- çº¢çŸ³ç³»ç»Ÿ
    REDSTONE_BLOCK = {ID = 66, Name = "çº¢çŸ³å—", Color = Color3.fromRGB(255, 50, 50), Material = Enum.Material.Neon, Hardness = 5.0, LightEmission = 0.5},
    REDSTONE_WIRE = {ID = 67, Name = "çº¢çŸ³çº¿", Color = Color3.fromRGB(255, 80, 80), Material = Enum.Material.Neon, Hardness = 0, Decoration = true, LightEmission = 0.7},
    REDSTONE_TORCH = {ID = 68, Name = "çº¢çŸ³ç«æŠŠ", Color = Color3.fromRGB(255, 100, 100), Material = Enum.Material.Neon, Hardness = 0, Decoration = true, LightEmission = 0.8},
    LEVER = {ID = 69, Name = "æ‹‰æ†", Color = Color3.fromRGB(150, 120, 90), Material = Enum.Material.Wood, Hardness = 0.5, Decoration = true},
    BUTTON = {ID = 70, Name = "æŒ‰é’®", Color = Color3.fromRGB(180, 140, 100), Material = Enum.Material.Wood, Hardness = 0.5, Decoration = true},
    
    -- æ›´å¤šè£…é¥°
    CARPET_RED = {ID = 71, Name = "çº¢è‰²åœ°æ¯¯", Color = Color3.fromRGB(200, 50, 50), Material = Enum.Material.Fabric, Hardness = 0.1},
    CARPET_BLUE = {ID = 72, Name = "è“è‰²åœ°æ¯¯", Color = Color3.fromRGB(50, 100, 200), Material = Enum.Material.Fabric, Hardness = 0.1},
    WOOL_WHITE = {ID = 73, Name = "ç™½è‰²ç¾Šæ¯›", Color = Color3.fromRGB(250, 250, 250), Material = Enum.Material.Fabric, Hardness = 0.8},
    WOOL_BLACK = {ID = 74, Name = "é»‘è‰²ç¾Šæ¯›", Color = Color3.fromRGB(30, 30, 30), Material = Enum.Material.Fabric, Hardness = 0.8},
    
    -- å°é˜¶å’Œæ¥¼æ¢¯
    STONE_STAIRS = {ID = 75, Name = "çŸ³è´¨æ¥¼æ¢¯", Color = Color3.fromRGB(120, 120, 120), Material = Enum.Material.Slate, Hardness = 2.0, Stair = true},
    WOOD_STAIRS = {ID = 76, Name = "æœ¨è´¨æ¥¼æ¢¯", Color = Color3.fromRGB(180, 140, 100), Material = Enum.Material.Wood, Hardness = 2.0, Stair = true},
    STONE_SLAB = {ID = 77, Name = "çŸ³è´¨å°é˜¶", Color = Color3.fromRGB(120, 120, 120), Material = Enum.Material.Slate, Hardness = 2.0, Slab = true},
    WOOD_SLAB = {ID = 78, Name = "æœ¨è´¨å°é˜¶", Color = Color3.fromRGB(180, 140, 100), Material = Enum.Material.Wood, Hardness = 2.0, Slab = true},
    
    -- æ …æ å’Œå¢™
    OAK_FENCE = {ID = 79, Name = "æ©¡æœ¨æ …æ ", Color = Color3.fromRGB(160, 120, 80), Material = Enum.Material.Wood, Hardness = 2.0, Fence = true},
    STONE_WALL = {ID = 80, Name = "çŸ³å¢™", Color = Color3.fromRGB(120, 120, 120), Material = Enum.Material.Slate, Hardness = 2.0, Wall = true},
    IRON_BARS = {ID = 81, Name = "é“æ æ†", Color = Color3.fromRGB(180, 180, 180), Material = Enum.Material.Metal, Hardness = 5.0, Fence = true},
    
    -- é—¨å’Œæ´»æ¿é—¨
    OAK_DOOR = {ID = 82, Name = "æ©¡æœ¨é—¨", Color = Color3.fromRGB(160, 120, 80), Material = Enum.Material.Wood, Hardness = 3.0, Door = true},
    IRON_DOOR = {ID = 83, Name = "é“é—¨", Color = Color3.fromRGB(180, 180, 180), Material = Enum.Material.Metal, Hardness = 5.0, Door = true},
    OAK_TRAPDOOR = {ID = 84, Name = "æ©¡æœ¨æ´»æ¿é—¨", Color = Color3.fromRGB(160, 120, 80), Material = Enum.Material.Wood, Hardness = 3.0, Trapdoor = true},
}

-- ç‰©å“ç³»ç»Ÿ
local ITEM_TYPES = {
    -- å·¥å…·
    WOODEN_PICKAXE = {Name = "æœ¨é•", Type = "Tool", Material = "Wood", Damage = 2, MiningSpeed = 1.2, Durability = 60},
    STONE_PICKAXE = {Name = "çŸ³é•", Type = "Tool", Material = "Stone", Damage = 3, MiningSpeed = 1.5, Durability = 132},
    IRON_PICKAXE = {Name = "é“é•", Type = "Tool", Material = "Iron", Damage = 4, MiningSpeed = 1.8, Durability = 251},
    DIAMOND_PICKAXE = {Name = "é’»çŸ³é•", Type = "Tool", Material = "Diamond", Damage = 5, MiningSpeed = 2.2, Durability = 1562},
    
    -- æ­¦å™¨
    WOODEN_SWORD = {Name = "æœ¨å‰‘", Type = "Weapon", Damage = 4, AttackSpeed = 1.6, Durability = 60},
    STONE_SWORD = {Name = "çŸ³å‰‘", Type = "Weapon", Damage = 5, AttackSpeed = 1.6, Durability = 132},
    IRON_SWORD = {Name = "é“å‰‘", Type = "Weapon", Damage = 6, AttackSpeed = 1.6, Durability = 251},
    DIAMOND_SWORD = {Name = "é’»çŸ³å‰‘", Type = "Weapon", Damage = 7, AttackSpeed = 1.6, Durability = 1562},
    BOW = {Name = "å¼“", Type = "Weapon", Damage = 6, AttackSpeed = 1.0, Durability = 385},
    ARROW = {Name = "ç®­", Type = "Ammo", StackSize = 64},
    
    -- ç›”ç”²
    LEATHER_HELMET = {Name = "çš®é©å¤´ç›”", Type = "Armor", ArmorPoints = 1, Durability = 56},
    IRON_HELMET = {Name = "é“å¤´ç›”", Type = "Armor", ArmorPoints = 2, Durability = 166},
    DIAMOND_HELMET = {Name = "é’»çŸ³å¤´ç›”", Type = "Armor", ArmorPoints = 3, Durability = 364},
    
    -- é£Ÿç‰©
    APPLE = {Name = "è‹¹æžœ", Type = "Food", HungerRestore = 4, Saturation = 2.4},
    BREAD = {Name = "é¢åŒ…", Type = "Food", HungerRestore = 5, Saturation = 6.0},
    COOKED_BEEF = {Name = "ç†Ÿç‰›è‚‰", Type = "Food", HungerRestore = 8, Saturation = 12.8},
    GOLDEN_APPLE = {Name = "é‡‘è‹¹æžœ", Type = "Food", HungerRestore = 4, Saturation = 9.6, SpecialEffect = "Regeneration"},
    
    -- ææ–™
    COAL = {Name = "ç…¤ç‚­", Type = "Material", StackSize = 64},
    IRON_INGOT = {Name = "é“é”­", Type = "Material", StackSize = 64},
    GOLD_INGOT = {Name = "é‡‘é”­", Type = "Material", StackSize = 64},
    DIAMOND = {Name = "é’»çŸ³", Type = "Material", StackSize = 64},
    STICK = {Name = "æœ¨æ£", Type = "Material", StackSize = 64},
    STRING = {Name = "çº¿", Type = "Material", StackSize = 64},
    FEATHER = {Name = "ç¾½æ¯›", Type = "Material", StackSize = 64},
    
    -- ç‰¹æ®Šç‰©å“
    TORCH_ITEM = {Name = "ç«æŠŠ", Type = "LightSource", StackSize = 64},
    FLINT_AND_STEEL = {Name = "æ‰“ç«çŸ³", Type = "Tool", Durability = 65},
    COMPASS = {Name = "æŒ‡å—é’ˆ", Type = "Tool"},
    CLOCK = {Name = "æ—¶é’Ÿ", Type = "Tool"},
    MAP = {Name = "åœ°å›¾", Type = "Tool"},
    ENDER_PEARL = {Name = "æœ«å½±çç ", Type = "Special", StackSize = 16},
    BLAZE_ROD = {Name = "çƒˆç„°æ£’", Type = "Material", StackSize = 64},
    NETHER_STAR = {Name = "ä¸‹ç•Œä¹‹æ˜Ÿ", Type = "Material", StackSize = 64},
    
    -- è¯æ°´
    HEALTH_POTION = {Name = "æ²»ç–—è¯æ°´", Type = "Potion", Effect = "Heal", Duration = 0, Potency = 4},
    REGEN_POTION = {Name = "å†ç”Ÿè¯æ°´", Type = "Potion", Effect = "Regeneration", Duration = 45, Potency = 1},
    SPEED_POTION = {Name = "é€Ÿåº¦è¯æ°´", Type = "Potion", Effect = "Speed", Duration = 180, Potency = 1},
    
    -- æ›´å¤šç‰©å“...
    EMERALD = {Name = "ç»¿å®çŸ³", Type = "Material", StackSize = 64},
    REDSTONE_DUST = {Name = "çº¢çŸ³ç²‰", Type = "Material", StackSize = 64},
    LAPIS_LAZULI = {Name = "é’é‡‘çŸ³", Type = "Material", StackSize = 64},
    QUARTZ = {Name = "çŸ³è‹±", Type = "Material", StackSize = 64},
    GLOWSTONE_DUST = {Name = "è§çŸ³ç²‰", Type = "Material", StackSize = 64},
    MAGMA_CREAM = {Name = "å²©æµ†è†", Type = "Material", StackSize = 64},
    GHAST_TEAR = {Name = "æ¶é­‚ä¹‹æ³ª", Type = "Material", StackSize = 64},
    PHANTOM_MEMBRANE = {Name = "å¹»ç¿¼è†œ", Type = "Material", StackSize = 64},
}

-- åˆæˆé…æ–¹ç³»ç»Ÿ
local CRAFTING_RECIPES = {
    -- å·¥å…·
    WOODEN_PICKAXE = {
        Pattern = {"WWW", " S ", " S "},
        Materials = {W = "OAK_PLANKS", S = "STICK"},
        Result = "WOODEN_PICKAXE",
        ResultCount = 1
    },
    STONE_PICKAXE = {
        Pattern = {"SSS", " I ", " I "},
        Materials = {S = "COBBLESTONE", I = "STICK"},
        Result = "STONE_PICKAXE",
        ResultCount = 1
    },
    IRON_PICKAXE = {
        Pattern = {"III", " S ", " S "},
        Materials = {I = "IRON_INGOT", S = "STICK"},
        Result = "IRON_PICKAXE",
        ResultCount = 1
    },
    DIAMOND_PICKAXE = {
        Pattern = {"DDD", " S ", " S "},
        Materials = {D = "DIAMOND", S = "STICK"},
        Result = "DIAMOND_PICKAXE",
        ResultCount = 1
    },
    
    -- æ­¦å™¨
    WOODEN_SWORD = {
        Pattern = {" W ", " W ", " S "},
        Materials = {W = "OAK_PLANKS", S = "STICK"},
        Result = "WOODEN_SWORD",
        ResultCount = 1
    },
    IRON_SWORD = {
        Pattern = {" I ", " I ", " S "},
        Materials = {I = "IRON_INGOT", S = "STICK"},
        Result = "IRON_SWORD",
        ResultCount = 1
    },
    DIAMOND_SWORD = {
        Pattern = {" D ", " D ", " S "},
        Materials = {D = "DIAMOND", S = "STICK"},
        Result = "DIAMOND_SWORD",
        ResultCount = 1
    },
    BOW = {
        Pattern = {" S ", "SI ", " S "},
        Materials = {S = "STICK", I = "STRING"},
        Result = "BOW",
        ResultCount = 1
    },
    ARROW = {
        Pattern = {" F ", " S ", " L "},
        Materials = {F = "FLINT", S = "STICK", L = "FEATHER"},
        Result = "ARROW",
        ResultCount = 4
    },
    
    -- æ–¹å—
    TORCH = {
        Pattern = {" C ", " S "},
        Materials = {C = "COAL", S = "STICK"},
        Result = "TORCH_ITEM",
        ResultCount = 4
    },
    FURNACE = {
        Pattern = {"CCC", "C C", "CCC"},
        Materials = {C = "COBBLESTONE"},
        Result = "FURNACE",
        ResultCount = 1
    },
    CRAFTING_TABLE = {
        Pattern = {"PP", "PP"},
        Materials = {P = "OAK_PLANKS"},
        Result = "CRAFTING_TABLE",
        ResultCount = 1
    },
    CHEST = {
        Pattern = {"PPP", "P P", "PPP"},
        Materials = {P = "OAK_PLANKS"},
        Result = "CHEST",
        ResultCount = 1
    },
    
    -- ç›”ç”²
    LEATHER_HELMET = {
        Pattern = {"LLL", "L L"},
        Materials = {L = "LEATHER"},
        Result = "LEATHER_HELMET",
        ResultCount = 1
    },
    IRON_HELMET = {
        Pattern = {"III", "I I"},
        Materials = {I = "IRON_INGOT"},
        Result = "IRON_HELMET",
        ResultCount = 1
    },
    
    -- æ›´å¤šé…æ–¹...
    STICK = {
        Pattern = {"P", "P"},
        Materials = {P = "OAK_PLANKS"},
        Result = "STICK",
        ResultCount = 4
    },
    OAK_PLANKS = {
        Pattern = {"W"},
        Materials = {W = "OAK_LOG"},
        Result = "OAK_PLANKS",
        ResultCount = 4
    },
    COBBLESTONE = {
        Pattern = {"S"},
        Materials = {S = "STONE"},
        Result = "COBBLESTONE",
        ResultCount = 1
    },
    BRICKS = {
        Pattern = {"BB", "BB"},
        Materials = {B = "CLAY_BALL"},
        Result = "BRICKS",
        ResultCount = 4
    },
}

-- ç”Ÿç‰©ç³»ç»Ÿ
local MOB_TYPES = {
    -- è¢«åŠ¨ç”Ÿç‰©
    COW = {
        Name = "ç‰›",
        Health = 10,
        Damage = 0,
        Speed = 8,
        Hostile = false,
        Drops = {"LEATHER", "BEEF", "BEEF", "BEEF"},
        Experience = 1,
        Size = Vector3.new(4, 3, 4)
    },
    PIG = {
        Name = "çŒª",
        Health = 10,
        Damage = 0,
        Speed = 10,
        Hostile = false,
        Drops = {"PORKCHOP", "PORKCHOP", "PORKCHOP"},
        Experience = 1,
        Size = Vector3.new(3, 2, 3)
    },
    SHEEP = {
        Name = "ç¾Š",
        Health = 8,
        Damage = 0,
        Speed = 9,
        Hostile = false,
        Drops = {"WOOL_WHITE", "MUTTON", "MUTTON"},
        Experience = 1,
        Size = Vector3.new(3, 2, 3)
    },
    CHICKEN = {
        Name = "é¸¡",
        Health = 4,
        Damage = 0,
        Speed = 12,
        Hostile = false,
        Drops = {"FEATHER", "CHICKEN", "EGG"},
        Experience = 1,
        Size = Vector3.new(2, 2, 2)
    },
    VILLAGER = {
        Name = "æ‘æ°‘",
        Health = 20,
        Damage = 0,
        Speed = 6,
        Hostile = false,
        Drops = {"EMERALD"},
        Experience = 0,
        Size = Vector3.new(3, 5, 3),
        CanTrade = true
    },
    
    -- æ•Œå¯¹ç”Ÿç‰©
    ZOMBIE = {
        Name = "åƒµå°¸",
        Health = 20,
        Damage = 3,
        Speed = 6,
        Hostile = true,
        Drops = {"ROTTEN_FLESH", "IRON_INGOT", "CARROT", "POTATO"},
        Experience = 5,
        Size = Vector3.new(3, 5, 3),
        SpawnConditions = {"Night", "Dark", "Underground"}
    },
    SKELETON = {
        Name = "éª·é«…",
        Health = 20,
        Damage = 4,
        Speed = 7,
        Hostile = true,
        Drops = {"ARROW", "BONE", "BOW"},
        Experience = 5,
        Size = Vector3.new(3, 5, 3),
        RangedAttack = true,
        SpawnConditions = {"Night", "Dark", "Underground"}
    },
    SPIDER = {
        Name = "èœ˜è››",
        Health = 16,
        Damage = 2,
        Speed = 15,
        Hostile = true,
        Drops = {"STRING", "SPIDER_EYE"},
        Experience = 5,
        Size = Vector3.new(4, 2, 4),
        CanClimb = true,
        SpawnConditions = {"Night", "Dark"}
    },
    CREEPER = {
        Name = "è‹¦åŠ›æ€•",
        Health = 20,
        Damage = 50, -- çˆ†ç‚¸ä¼¤å®³
        Speed = 8,
        Hostile = true,
        Drops = {"GUNPOWDER"},
        Experience = 5,
        Size = Vector3.new(3, 4, 3),
        Explodes = true,
        SpawnConditions = {"Night", "Dark", "Underground"}
    },
    
    -- ä¸‹ç•Œç”Ÿç‰©
    ZOMBIE_PIGMAN = {
        Name = "åƒµå°¸çŒªçµ",
        Health = 20,
        Damage = 5,
        Speed = 8,
        Hostile = false, -- é™¤éžè¢«æ”»å‡»
        Drops = {"GOLD_NUGGET", "ROTTEN_FLESH", "GOLD_INGOT"},
        Experience = 5,
        Size = Vector3.new(3, 5, 3),
        Dimension = "Nether"
    },
    BLAZE = {
        Name = "çƒˆç„°äºº",
        Health = 20,
        Damage = 6,
        Speed = 5,
        Hostile = true,
        Drops = {"BLAZE_ROD", "BLAZE_POWDER"},
        Experience = 10,
        Size = Vector3.new(3, 4, 3),
        RangedAttack = true,
        FireImmune = true,
        Dimension = "Nether"
    },
    GHAST = {
        Name = "æ¶é­‚",
        Health = 10,
        Damage = 17,
        Speed = 12,
        Hostile = true,
        Drops = {"GHAST_TEAR", "GUNPOWDER"},
        Experience = 5,
        Size = Vector3.new(8, 8, 8),
        RangedAttack = true,
        Flies = true,
        Dimension = "Nether"
    },
    
    -- æœ«åœ°ç”Ÿç‰©
    ENDERMAN = {
        Name = "æœ«å½±äºº",
        Health = 40,
        Damage = 7,
        Speed = 15,
        Hostile = true, -- å½“è¢«æ³¨è§†æ—¶
        Drops = {"ENDER_PEARL"},
        Experience = 5,
        Size = Vector3.new(3, 8, 3),
        Teleports = true,
        Dimension = "End"
    },
    ENDERMITE = {
        Name = "æœ«å½±èž¨",
        Health = 8,
        Damage = 2,
        Speed = 18,
        Hostile = true,
        Drops = {},
        Experience = 3,
        Size = Vector3.new(2, 1, 2),
        Dimension = "End"
    },
    SHULKER = {
        Name = "æ½œå½±è´",
        Health = 30,
        Damage = 4,
        Speed = 0,
        Hostile = true,
        Drops = {"SHULKER_SHELL"},
        Experience = 5,
        Size = Vector3.new(3, 3, 3),
        RangedAttack = true,
        Levitates = true,
        Dimension = "End"
    },
    
    -- BOSSç”Ÿç‰©
    WITHER = {
        Name = "å‡‹çµ",
        Health = 300,
        Damage = 8,
        Speed = 10,
        Hostile = true,
        Drops = {"NETHER_STAR"},
        Experience = 50,
        Size = Vector3.new(4, 10, 4),
        RangedAttack = true,
        Flies = true,
        Boss = true,
        SpawnConditions = {"Boss"}
    },
    ENDER_DRAGON = {
        Name = "æœ«å½±é¾™",
        Health = 200,
        Damage = 10,
        Speed = 25,
        Hostile = true,
        Drops = {"DRAGON_EGG", "DRAGON_BREATH"},
        Experience = 12000,
        Size = Vector3.new(16, 16, 40),
        Flies = true,
        Boss = true,
        Dimension = "End"
    },
    
    -- æ°´ä¸­ç”Ÿç‰©
    SQUID = {
        Name = "é±¿é±¼",
        Health = 10,
        Damage = 0,
        Speed = 8,
        Hostile = false,
        Drops = {"INK_SAC"},
        Experience = 1,
        Size = Vector3.new(3, 3, 3),
        Aquatic = true
    },
    GUARDIAN = {
        Name = "å®ˆå«è€…",
        Health = 30,
        Damage = 6,
        Speed = 6,
        Hostile = true,
        Drops = {"PRISMARINE_SHARD", "PRISMARINE_CRYSTALS", "FISH"},
        Experience = 10,
        Size = Vector3.new(4, 4, 4),
        RangedAttack = true,
        Aquatic = true
    },
    
    -- æ›´å¤šç”Ÿç‰©...
    WITCH = {
        Name = "å¥³å·«",
        Health = 26,
        Damage = 0,
        Speed = 6,
        Hostile = true,
        Drops = {"GLASS_BOTTLE", "GLOWSTONE_DUST", "REDSTONE", "SPIDER_EYE", "SUGAR", "STICK"},
        Experience = 5,
        Size = Vector3.new(3, 5, 3),
        RangedAttack = true,
        UsesPotions = true
    },
    SLIME = {
        Name = "å²èŽ±å§†",
        Health = 16,
        Damage = 3,
        Speed = 6,
        Hostile = true,
        Drops = {"SLIME_BALL"},
        Experience = 4,
        Size = Vector3.new(4, 4, 4),
        Splits = true,
        SpawnConditions = {"Swamp", "Underground"}
    },
    CAVE_SPIDER = {
        Name = "æ´žç©´èœ˜è››",
        Health = 12,
        Damage = 2,
        Speed = 16,
        Hostile = true,
        Drops = {"STRING", "SPIDER_EYE"},
        Experience = 5,
        Size = Vector3.new(3, 1.5, 3),
        CanClimb = true,
        Poisonous = true,
        SpawnConditions = {"Mineshaft"}
    },
    SILVERFISH = {
        Name = "è ¹è™«",
        Health = 8,
        Damage = 1,
        Speed = 12,
        Hostile = true,
        Drops = {},
        Experience = 5,
        Size = Vector3.new(1, 0.5, 1),
        InfestsBlocks = true,
        SpawnConditions = {"Stronghold"}
    },
}

-- æ¸¸æˆçŠ¶æ€ç®¡ç†
local GameState = {
    -- çŽ©å®¶çŠ¶æ€
    Health = CONFIG.MAX_HEALTH,
    Hunger = CONFIG.MAX_HUNGER,
    Oxygen = CONFIG.MAX_OXYGEN,
    Sanity = CONFIG.MAX_SANITY,
    Experience = 0,
    Level = 1,
    
    -- ä½ç½®å’Œç»´åº¦
    Position = Vector3.new(0, 100, 0),
    Dimension = "Overworld", -- Overworld, Nether, End
    SpawnPoint = Vector3.new(0, 100, 0),
    
    -- æ¸¸æˆè¿›åº¦
    GameTime = 0,
    IsDay = true,
    Difficulty = "Normal", -- Peaceful, Easy, Normal, Hard
    
    -- åº“å­˜ç³»ç»Ÿ
    Inventory = {},
    Hotbar = {},
    SelectedHotbarSlot = 1,
    Armor = {},
    
    -- ä¸–ç•Œæ•°æ®
    Chunks = {},
    Mobs = {},
    Structures = {},
    Waypoints = {},
    
    -- æ¸¸æˆè®¾ç½®
    RenderDistance = CONFIG.RENDER_DISTANCE,
    ShowCoordinates = true,
    AutoJump = true,
    ViewBobbing = true,
    
    -- åˆæˆå’Œåˆ¶ä½œ
    UnlockedRecipes = {},
    DiscoveredBlocks = {},
    DiscoveredItems = {},
    
    -- ç»Ÿè®¡
    BlocksMined = 0,
    BlocksPlaced = 0,
    MobsKilled = 0,
    DistanceTraveled = 0,
    Deaths = 0,
    
    -- åœ°å›¾å’ŒæŽ¢ç´¢
    ExploredChunks = {},
    MapData = {},
    
    -- å¤šäººæ¸¸æˆ (æœ¬åœ°)
    LocalPlayers = {},
    LocalWorlds = {},
}

-- ä¸»UIç³»ç»Ÿ (æ”¯æŒæ‰‹æœº)
local function createMobileUI()
    local screenGui = Instance.new("ScreenGui")
    screenGui.Name = "MinecraftMobileUI"
    screenGui.Parent = player.PlayerGui
    screenGui.ResetOnSpawn = false
    
    -- è™šæ‹Ÿæ‘‡æ† (ç§»åŠ¨æŽ§åˆ¶)
    local joystickFrame = Instance.new("Frame")
    joystickFrame.Name = "JoystickFrame"
    joystickFrame.Size = UDim2.new(0.25, 0, 0.25, 0)
    joystickFrame.Position = UDim2.new(0.02, 0, 0.7, 0)
    joystickFrame.BackgroundColor3 = Color3.fromRGB(0, 0, 0)
    joystickFrame.BackgroundTransparency = 0.5
    joystickFrame.BorderSizePixel = 0
    joystickFrame.Parent = screenGui
    
    local joystickThumb = Instance.new("ImageButton")
    joystickThumb.Name = "JoystickThumb"
    joystickThumb.Size = UDim2.new(0.3, 0, 0.3, 0)
    joystickThumb.Position = UDim2.new(0.35, 0, 0.35, 0)
    joystickThumb.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
    joystickThumb.BackgroundTransparency = 0.3
    joystickThumb.Image = "rbxassetid://3570695787"
    joystickThumb.ScaleType = Enum.ScaleType.Slice
    joystickThumb.SliceCenter = Rect.new(100, 100, 100, 100)
    joystickThumb.Parent = joystickFrame
    
    -- è·³è·ƒæŒ‰é’®
    local jumpButton = Instance.new("TextButton")
    jumpButton.Name = "JumpButton"
    jumpButton.Size = UDim2.new(0.15, 0, 0.15, 0)
    jumpButton.Position = UDim2.new(0.85, 0, 0.8, 0)
    jumpButton.BackgroundColor3 = Color3.fromRGB(80, 80, 80)
    jumpButton.BackgroundTransparency = 0.3
    jumpButton.Text = "è·³è·ƒ"
    jumpButton.TextColor3 = Color3.fromRGB(255, 255, 255)
    jumpButton.Font = Enum.Font.SourceSansBold
    jumpButton.TextSize = 18
    jumpButton.Parent = screenGui
    
    -- æ”»å‡»/æŒ–æŽ˜æŒ‰é’®
    local attackButton = Instance.new("TextButton")
    attackButton.Name = "AttackButton"
    attackButton.Size = UDim2.new(0.15, 0, 0.15, 0)
    attackButton.Position = UDim2.new(0.85, 0, 0.6, 0)
    attackButton.BackgroundColor3 = Color3.fromRGB(200, 50, 50)
    attackButton.BackgroundTransparency = 0.3
    attackButton.Text = "æ”»å‡»"
    attackButton.TextColor3 = Color3.fromRGB(255, 255, 255)
    attackButton.Font = Enum.Font.SourceSansBold
    attackButton.TextSize = 18
    attackButton.Parent = screenGui
    
    -- æ”¾ç½®/ä½¿ç”¨æŒ‰é’®
    local useButton = Instance.new("TextButton")
    useButton.Name = "UseButton"
    useButton.Size = UDim2.new(0.15, 0, 0.15, 0)
    useButton.Position = UDim2.new(0.85, 0, 0.4, 0)
    useButton.BackgroundColor3 = Color3.fromRGB(50, 150, 255)
    useButton.BackgroundTransparency = 0.3
    useButton.Text = "ä½¿ç”¨"
    useButton.TextColor3 = Color3.fromRGB(255, 255, 255)
    useButton.Font = Enum.Font.SourceSansBold
    useButton.TextSize = 18
    useButton.Parent = screenGui
    
    -- ç‰©å“æ æŒ‰é’®
    local inventoryButton = Instance.new("TextButton")
    inventoryButton.Name = "InventoryButton"
    inventoryButton.Size = UDim2.new(0.12, 0, 0.08, 0)
    inventoryButton.Position = UDim2.new(0.02, 0, 0.02, 0)
    inventoryButton.BackgroundColor3 = Color3.fromRGB(60, 60, 60)
    inventoryButton.BackgroundTransparency = 0.3
    inventoryButton.Text = "ðŸ“¦"
    inventoryButton.TextColor3 = Color3.fromRGB(255, 255, 255)
    inventoryButton.Font = Enum.Font.SourceSansBold
    inventoryButton.TextSize = 24
    inventoryButton.Parent = screenGui
    
    -- åˆæˆæŒ‰é’®
    local craftButton = Instance.new("TextButton")
    craftButton.Name = "CraftButton"
    craftButton.Size = UDim2.new(0.12, 0, 0.08, 0)
    craftButton.Position = UDim2.new(0.16, 0, 0.02, 0)
    craftButton.BackgroundColor3 = Color3.fromRGB(60, 60, 60)
    craftButton.BackgroundTransparency = 0.3
    craftButton.Text = "ðŸ”¨"
    craftButton.TextColor3 = Color3.fromRGB(255, 255, 255)
    craftButton.Font = Enum.Font.SourceSansBold
    craftButton.TextSize = 24
    craftButton.Parent = screenGui
    
    -- åœ°å›¾æŒ‰é’®
    local mapButton = Instance.new("TextButton")
    mapButton.Name = "MapButton"
    mapButton.Size = UDim2.new(0.12, 0, 0.08, 0)
    mapButton.Position = UDim2.new(0.3, 0, 0.02, 0)
    mapButton.BackgroundColor3 = Color3.fromRGB(60, 60, 60)
    mapButton.BackgroundTransparency = 0.3
    mapButton.Text = "ðŸ—ºï¸"
    mapButton.TextColor3 = Color3.fromRGB(255, 255, 255)
    mapButton.Font = Enum.Font.SourceSansBold
    mapButton.TextSize = 24
    mapButton.Parent = screenGui
    
    -- çŠ¶æ€æ˜¾ç¤º
    local statusFrame = Instance.new("Frame")
    statusFrame.Name = "StatusFrame"
    statusFrame.Size = UDim2.new(0.25, 0, 0.15, 0)
    statusFrame.Position = UDim2.new(0.73, 0, 0.02, 0)
    statusFrame.BackgroundColor3 = Color3.fromRGB(0, 0, 0)
    statusFrame.BackgroundTransparency = 0.5
    statusFrame.Parent = screenGui
    
    -- ç”Ÿå‘½å€¼æ˜¾ç¤º
    local healthBar = Instance.new("Frame")
    healthBar.Name = "HealthBar"
    healthBar.Size = UDim2.new(0.9, 0, 0.25, 0)
    healthBar.Position = UDim2.new(0.05, 0, 0.1, 0)
    healthBar.BackgroundColor3 = Color3.fromRGB(255, 50, 50)
    healthBar.BorderSizePixel = 2
    healthBar.BorderColor3 = Color3.fromRGB(0, 0, 0)
    healthBar.Parent = statusFrame
    
    local healthText = Instance.new("TextLabel")
    healthText.Name = "HealthText"
    healthText.Size = UDim2.new(1, 0, 1, 0)
    healthText.BackgroundTransparency = 1
    healthText.Text = "â¤ï¸ 100/100"
    healthText.TextColor3 = Color3.fromRGB(255, 255, 255)
    healthText.Font = Enum.Font.SourceSansBold
    healthText.TextSize = 14
    healthText.Parent = healthBar
    
    -- é¥¥é¥¿å€¼æ˜¾ç¤º
    local hungerBar = Instance.new("Frame")
    hungerBar.Name = "HungerBar"
    hungerBar.Size = UDim2.new(0.9, 0, 0.25, 0)
    hungerBar.Position = UDim2.new(0.05, 0, 0.4, 0)
    hungerBar.BackgroundColor3 = Color3.fromRGB(255, 180, 0)
    hungerBar.BorderSizePixel = 2
    hungerBar.BorderColor3 = Color3.fromRGB(0, 0, 0)
    hungerBar.Parent = statusFrame
    
    local hungerText = Instance.new("TextLabel")
    hungerText.Name = "HungerText"
    hungerText.Size = UDim2.new(1, 0, 1, 0)
    hungerText.BackgroundTransparency = 1
    hungerText.Text = "ðŸ– 100/100"
    hungerText.TextColor3 = Color3.fromRGB(255, 255, 255)
    hungerText.Font = Enum.Font.SourceSansBold
    hungerText.TextSize = 14
    hungerText.Parent = hungerBar
    
    -- ç»éªŒå€¼æ˜¾ç¤º
    local expBar = Instance.new("Frame")
    expBar.Name = "ExpBar"
    expBar.Size = UDim2.new(0.9, 0, 0.25, 0)
    expBar.Position = UDim2.new(0.05, 0, 0.7, 0)
    expBar.BackgroundColor3 = Color3.fromRGB(50, 200, 100)
    expBar.BorderSizePixel = 2
    expBar.BorderColor3 = Color3.fromRGB(0, 0, 0)
    expBar.Parent = statusFrame
    
    local expText = Instance.new("TextLabel")
    expText.Name = "ExpText"
    expText.Size = UDim2.new(1, 0, 1, 0)
    expText.BackgroundTransparency = 1
    expText.Text = "â­ Lv.1 (0/100)"
    expText.TextColor3 = Color3.fromRGB(255, 255, 255)
    expText.Font = Enum.Font.SourceSansBold
    expText.TextSize = 14
    expText.Parent = expBar
    
    -- å¿«æ·æ 
    local hotbarFrame = Instance.new("Frame")
    hotbarFrame.Name = "HotbarFrame"
    hotbarFrame.Size = UDim2.new(1, 0, 0.1, 0)
    hotbarFrame.Position = UDim2.new(0, 0, 0.9, 0)
    hotbarFrame.BackgroundColor3 = Color3.fromRGB(0, 0, 0)
    hotbarFrame.BackgroundTransparency = 0.5
    hotbarFrame.Parent = screenGui
    
    -- åˆ›å»º9ä¸ªå¿«æ·æ æ§½ä½
    local hotbarSlots = {}
    for i = 1, 9 do
        local slot = Instance.new("Frame")
        slot.Name = "HotbarSlot" .. i
        slot.Size = UDim2.new(0.1, 0, 0.8, 0)
        slot.Position = UDim2.new(0.05 + (i-1) * 0.1, 0, 0.1, 0)
        slot.BackgroundColor3 = Color3.fromRGB(60, 60, 60)
        slot.BorderSizePixel = 2
        slot.BorderColor3 = Color3.fromRGB(100, 100, 100)
        slot.Parent = hotbarFrame
        
        local slotNumber = Instance.new("TextLabel")
        slotNumber.Name = "SlotNumber"
        slotNumber.Size = UDim2.new(0.3, 0, 0.3, 0)
        slotNumber.Position = UDim2.new(0.7, 0, 0.7, 0)
        slotNumber.BackgroundTransparency = 1
        slotNumber.Text = tostring(i)
        slotNumber.TextColor3 = Color3.fromRGB(255, 255, 255)
        slotNumber.Font = Enum.Font.SourceSansBold
        slotNumber.TextSize = 14
        slotNumber.Parent = slot
        
        hotbarSlots[i] = slot
    end
    
    -- å½“å‰æ§½ä½é«˜äº®
    hotbarSlots[1].BorderColor3 = Color3.fromRGB(255, 255, 0)
    
    return {
        ScreenGui = screenGui,
        JoystickThumb = joystickThumb,
        JumpButton = jumpButton,
        AttackButton = attackButton,
        UseButton = useButton,
        InventoryButton = inventoryButton,
        CraftButton = craftButton,
        MapButton = mapButton,
        HealthBar = healthBar,
        HungerBar = hungerBar,
        ExpBar = expBar,
        HealthText = healthText,
        HungerText = hungerText,
        ExpText = expText,
        HotbarSlots = hotbarSlots,
        HotbarFrame = hotbarFrame
    }
end

-- ç‰©å“æ UI
local function createInventoryUI()
    local inventoryScreen = Instance.new("ScreenGui")
    inventoryScreen.Name = "InventoryScreen"
    inventoryScreen.Parent = player.PlayerGui
    inventoryScreen.Enabled = false
    
    local mainFrame = Instance.new("Frame")
    mainFrame.Name = "MainFrame"
    mainFrame.Size = UDim2.new(0.8, 0, 0.8, 0)
    mainFrame.Position = UDim2.new(0.1, 0, 0.1, 0)
    mainFrame.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
    mainFrame.BorderSizePixel = 3
    mainFrame.BorderColor3 = Color3.fromRGB(100, 100, 100)
    mainFrame.Parent = inventoryScreen
    
    local title = Instance.new("TextLabel")
    title.Name = "Title"
    title.Size = UDim2.new(1, 0, 0.1, 0)
    title.BackgroundColor3 = Color3.fromRGB(60, 60, 60)
    title.Text = "ç‰©å“æ "
    title.TextColor3 = Color3.fromRGB(255, 255, 255)
    title.Font = Enum.Font.SourceSansBold
    title.TextSize = 24
    title.Parent = mainFrame
    
    -- åˆ›å»º36ä¸ªç‰©å“æ æ§½ä½ (4x9)
    local inventorySlots = {}
    for row = 0, 3 do
        for col = 0, 8 do
            local index = row * 9 + col + 1
            local slot = Instance.new("Frame")
            slot.Name = "InventorySlot" .. index
            slot.Size = UDim2.new(0.1, 0, 0.2, 0)
            slot.Position = UDim2.new(0.02 + col * 0.106, 0, 0.12 + row * 0.21, 0)
            slot.BackgroundColor3 = Color3.fromRGB(80, 80, 80)
            slot.BorderSizePixel = 2
            slot.BorderColor3 = Color3.fromRGB(120, 120, 120)
            slot.Parent = mainFrame
            
            inventorySlots[index] = slot
        end
    end
    
    -- ç›”ç”²æ§½ä½
    local armorFrame = Instance.new("Frame")
    armorFrame.Name = "ArmorFrame"
    armorFrame.Size = UDim2.new(0.15, 0, 0.3, 0)
    armorFrame.Position = UDim2.new(0.82, 0, 0.15, 0)
    armorFrame.BackgroundColor3 = Color3.fromRGB(60, 60, 60)
    armorFrame.BorderSizePixel = 2
    armorFrame.Parent = mainFrame
    
    local armorTitle = Instance.new("TextLabel")
    armorTitle.Name = "ArmorTitle"
    armorTitle.Size = UDim2.new(1, 0, 0.25, 0)
    armorTitle.BackgroundTransparency = 1
    armorTitle.Text = "ç›”ç”²"
    armorTitle.TextColor3 = Color3.fromRGB(255, 255, 255)
    armorTitle.Font = Enum.Font.SourceSansBold
    armorTitle.Parent = armorFrame
    
    -- åˆæˆåŒºåŸŸ
    local craftingFrame = Instance.new("Frame")
    craftingFrame.Name = "CraftingFrame"
    craftingFrame.Size = UDim2.new(0.3, 0, 0.4, 0)
    craftingFrame.Position = UDim2.new(0.5, 0, 0.5, 0)
    craftingFrame.BackgroundColor3 = Color3.fromRGB(60, 60, 60)
    craftingFrame.BorderSizePixel = 2
    craftingFrame.Parent = mainFrame
    
    local craftingTitle = Instance.new("TextLabel")
    craftingTitle.Name = "CraftingTitle"
    craftingTitle.Size = UDim2.new(1, 0, 0.15, 0)
    craftingTitle.BackgroundTransparency = 1
    craftingTitle.Text = "åˆæˆ"
    craftingTitle.TextColor3 = Color3.fromRGB(255, 255, 255)
    craftingTitle.Font = Enum.Font.SourceSansBold
    craftingTitle.Parent = craftingFrame
    
    -- å…³é—­æŒ‰é’®
    local closeButton = Instance.new("TextButton")
    closeButton.Name = "CloseButton"
    closeButton.Size = UDim2.new(0.1, 0, 0.08, 0)
    closeButton.Position = UDim2.new(0.9, 0, 0.02, 0)
    closeButton.BackgroundColor3 = Color3.fromRGB(200, 50, 50)
    closeButton.Text = "X"
    closeButton.TextColor3 = Color3.fromRGB(255, 255, 255)
    closeButton.Font = Enum.Font.SourceSansBold
    closeButton.Parent = mainFrame
    
    return {
        Screen = inventoryScreen,
        MainFrame = mainFrame,
        InventorySlots = inventorySlots,
        CloseButton = closeButton
    }
end

-- åˆæˆUI
local function createCraftingUI()
    local craftingScreen = Instance.new("ScreenGui")
    craftingScreen.Name = "CraftingScreen"
    craftingScreen.Parent = player.PlayerGui
    craftingScreen.Enabled = false
    
    local mainFrame = Instance.new("Frame")
    mainFrame.Name = "MainFrame"
    mainFrame.Size = UDim2.new(0.9, 0, 0.9, 0)
    mainFrame.Position = UDim2.new(0.05, 0, 0.05, 0)
    mainFrame.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
    mainFrame.BorderSizePixel = 3
    mainFrame.Parent = craftingScreen
    
    local title = Instance.new("TextLabel")
    title.Name = "Title"
    title.Size = UDim2.new(1, 0, 0.05, 0)
    title.BackgroundColor3 = Color3.fromRGB(80, 80, 80)
    title.Text = "åˆæˆè¡¨"
    title.TextColor3 = Color3.fromRGB(255, 255, 255)
    title.Font = Enum.Font.SourceSansBold
    title.TextSize = 24
    title.Parent = mainFrame
    
    -- é…æ–¹åˆ—è¡¨
    local recipesScrollingFrame = Instance.new("ScrollingFrame")
    recipesScrollingFrame.Name = "RecipesScrollingFrame"
    recipesScrollingFrame.Size = UDim2.new(0.3, 0, 0.9, 0)
    recipesScrollingFrame.Position = UDim2.new(0.02, 0, 0.06, 0)
    recipesScrollingFrame.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
    recipesScrollingFrame.ScrollingEnabled = true
    recipesScrollingFrame.Parent = mainFrame
    
    -- åˆæˆç½‘æ ¼ (3x3)
    local craftingGrid = {}
    for row = 0, 2 do
        for col = 0, 2 do
            local slot = Instance.new("Frame")
            slot.Name = "CraftingSlot_" .. row .. "_" .. col
            slot.Size = UDim2.new(0.08, 0, 0.08, 0)
            slot.Position = UDim2.new(0.4 + col * 0.09, 0, 0.2 + row * 0.09, 0)
            slot.BackgroundColor3 = Color3.fromRGB(80, 80, 80)
            slot.BorderSizePixel = 2
            slot.Parent = mainFrame
            
            craftingGrid[row * 3 + col + 1] = slot
        end
    end
    
    -- ç»“æžœæ§½ä½
    local resultSlot = Instance.new("Frame")
    resultSlot.Name = "ResultSlot"
    resultSlot.Size = UDim2.new(0.08, 0, 0.08, 0)
    resultSlot.Position = UDim2.new(0.7, 0, 0.38, 0)
    resultSlot.BackgroundColor3 = Color3.fromRGB(100, 100, 100)
    resultSlot.BorderSizePixel = 2
    resultSlot.Parent = mainFrame
    
    -- åˆæˆæŒ‰é’®
    local craftButton = Instance.new("TextButton")
    craftButton.Name = "CraftButton"
    craftButton.Size = UDim2.new(0.1, 0, 0.05, 0)
    craftButton.Position = UDim2.new(0.68, 0, 0.5, 0)
    craftButton.BackgroundColor3 = Color3.fromRGB(50, 150, 50)
    craftButton.Text = "åˆæˆ"
    craftButton.TextColor3 = Color3.fromRGB(255, 255, 255)
    craftButton.Font = Enum.Font.SourceSansBold
    craftButton.Parent = mainFrame
    
    -- å…³é—­æŒ‰é’®
    local closeButton = Instance.new("TextButton")
    closeButton.Name = "CloseButton"
    closeButton.Size = UDim2.new(0.05, 0, 0.05, 0)
    closeButton.Position = UDim2.new(0.95, 0, 0.02, 0)
    closeButton.BackgroundColor3 = Color3.fromRGB(200, 50, 50)
    closeButton.Text = "X"
    closeButton.TextColor3 = Color3.fromRGB(255, 255, 255)
    closeButton.Font = Enum.Font.SourceSansBold
    closeButton.Parent = mainFrame
    
    return {
        Screen = craftingScreen,
        MainFrame = mainFrame,
        RecipesScrollingFrame = recipesScrollingFrame,
        CraftingGrid = craftingGrid,
        ResultSlot = resultSlot,
        CraftButton = craftButton,
        CloseButton = closeButton
    }
end

-- åœ°å›¾ç³»ç»Ÿ
local function createMapSystem()
    local mapScreen = Instance.new("ScreenGui")
    mapScreen.Name = "MapScreen"
    mapScreen.Parent = player.PlayerGui
    mapScreen.Enabled = false
    
    local mainFrame = Instance.new("Frame")
    mainFrame.Name = "MainFrame"
    mainFrame.Size = UDim2.new(0.8, 0, 0.8, 0)
    mainFrame.Position = UDim2.new(0.1, 0, 0.1, 0)
    mainFrame.BackgroundColor3 = Color3.fromRGB(30, 50, 70)
    mainFrame.BorderSizePixel = 3
    mainFrame.Parent = mapScreen
    
    local mapCanvas = Instance.new("Frame")
    mapCanvas.Name = "MapCanvas"
    mapCanvas.Size = UDim2.new(0.9, 0, 0.9, 0)
    mapCanvas.Position = UDim2.new(0.05, 0, 0.05, 0)
    mapCanvas.BackgroundColor3 = Color3.fromRGB(100, 150, 200)
    mapCanvas.Parent = mainFrame
    
    -- çŽ©å®¶ä½ç½®æ ‡è®°
    local playerMarker = Instance.new("Frame")
    playerMarker.Name = "PlayerMarker"
    playerMarker.Size = UDim2.new(0.01, 0, 0.01, 0)
    playerMarker.BackgroundColor3 = Color3.fromRGB(255, 0, 0)
    playerMarker.BorderSizePixel = 2
    playerMarker.BorderColor3 = Color3.fromRGB(255, 255, 255)
    playerMarker.Parent = mapCanvas
    
    -- ç¼©æ”¾æŽ§åˆ¶
    local zoomInButton = Instance.new("TextButton")
    zoomInButton.Name = "ZoomInButton"
    zoomInButton.Size = UDim2.new(0.05, 0, 0.05, 0)
    zoomInButton.Position = UDim2.new(0.9, 0, 0.02, 0)
    zoomInButton.BackgroundColor3 = Color3.fromRGB(80, 80, 80)
    zoomInButton.Text = "+"
    zoomInButton.TextColor3 = Color3.fromRGB(255, 255, 255)
    zoomInButton.Font = Enum.Font.SourceSansBold
    zoomInButton.Parent = mainFrame
    
    local zoomOutButton = Instance.new("TextButton")
    zoomOutButton.Name = "ZoomOutButton"
    zoomOutButton.Size = UDim2.new(0.05, 0, 0.05, 0)
    zoomOutButton.Position = UDim2.new(0.9, 0, 0.08, 0)
    zoomOutButton.BackgroundColor3 = Color3.fromRGB(80, 80, 80)
    zoomOutButton.Text = "-"
    zoomOutButton.TextColor3 = Color3.fromRGB(255, 255, 255)
    zoomOutButton.Font = Enum.Font.SourceSansBold
    zoomOutButton.Parent = mainFrame
    
    local closeButton = Instance.new("TextButton")
    closeButton.Name = "CloseButton"
    closeButton.Size = UDim2.new(0.05, 0, 0.05, 0)
    closeButton.Position = UDim2.new(0.95, 0, 0.02, 0)
    closeButton.BackgroundColor3 = Color3.fromRGB(200, 50, 50)
    closeButton.Text = "X"
    closeButton.TextColor3 = Color3.fromRGB(255, 255, 255)
    closeButton.Font = Enum.Font.SourceSansBold
    closeButton.Parent = mainFrame
    
    return {
        Screen = mapScreen,
        MapCanvas = mapCanvas,
        PlayerMarker = playerMarker,
        ZoomInButton = zoomInButton,
        ZoomOutButton = zoomOutButton,
        CloseButton = closeButton
    }
end

-- ä¸–ç•Œç”Ÿæˆç³»ç»Ÿ
local function generateWorld()
    print("å¼€å§‹ç”Ÿæˆä¸–ç•Œ...")
    
    local worldSeed = CONFIG.WORLD_SEED
    math.randomseed(worldSeed)
    
    -- ç”Ÿæˆåœ°å½¢
    for chunkX = -CONFIG.RENDER_DISTANCE, CONFIG.RENDER_DISTANCE do
        for chunkZ = -CONFIG.RENDER_DISTANCE, CONFIG.RENDER_DISTANCE do
            local chunkKey = chunkX .. "_" .. chunkZ
            GameState.Chunks[chunkKey] = {}
            
            -- ç”ŸæˆåŸºç¡€åœ°å½¢
            for x = 0, CONFIG.CHUNK_SIZE - 1 do
                for z = 0, CONFIG.CHUNK_SIZE - 1 do
                    local worldX = chunkX * CONFIG.CHUNK_SIZE + x
                    local worldZ = chunkZ * CONFIG.CHUNK_SIZE + z
                    
                    -- ä½¿ç”¨æŸæž—å™ªå£°ç”Ÿæˆåœ°å½¢
                    local height = math.noise(
                        worldX * 0.01, 
                        worldZ * 0.01
                    ) * 20 + 50
                    
                    -- æ·»åŠ ç»†èŠ‚
                    height = height + math.noise(
                        worldX * 0.05,
                        worldZ * 0.05
                    ) * 5
                    
                    height = math.floor(height)
                    
                    -- ç”Ÿæˆæ–¹å—
                    for y = 0, height do
                        local blockType
                        
                        if y == height then
                            -- é¡¶å±‚
                            local temperature = math.noise(worldX * 0.002, worldZ * 0.002)
                            if temperature > 0.3 then
                                blockType = "SAND"
                            else
                                blockType = "GRASS"
                            end
                        elseif y > height - 3 then
                            blockType = "DIRT"
                        elseif y > height - 10 then
                            blockType = "STONE"
                        else
                            blockType = "DEEPSLATE"
                        end
                        
                        -- æ”¾ç½®æ–¹å—
                        local position = Vector3.new(
                            worldX * CONFIG.BLOCK_SIZE,
                            y * CONFIG.BLOCK_SIZE,
                            worldZ * CONFIG.BLOCK_SIZE
                        )
                        
                        local block = Instance.new("Part")
                        block.Size = Vector3.new(CONFIG.BLOCK_SIZE, CONFIG.BLOCK_SIZE, CONFIG.BLOCK_SIZE)
                        block.Position = position
                        block.Anchored = true
                        block.CanCollide = true
                        
                        local blockData = BLOCK_TYPES[blockType]
                        if blockData then
                            block.Color = blockData.Color
                            block.Material = blockData.Material
                            
                            if blockData.LightEmission then
                                local light = Instance.new("PointLight")
                                light.Brightness = blockData.LightEmission
                                light.Range = 10
                                light.Parent = block
                            end
                        end
                        
                        block.Parent = workspace
                        
                        -- å­˜å‚¨æ–¹å—æ•°æ®
                        local blockKey = worldX .. "_" .. y .. "_" .. worldZ
                        GameState.Chunks[chunkKey][blockKey] = {
                            Type = blockType,
                            Position = position,
                            Instance = block
                        }
                    end
                    
                    -- ç”Ÿæˆæ ‘æœ¨
                    if math.random(1, 50) == 1 then
                        generateTree(
                            worldX * CONFIG.BLOCK_SIZE,
                            height * CONFIG.BLOCK_SIZE,
                            worldZ * CONFIG.BLOCK_SIZE
                        )
                    end
                    
                    -- ç”Ÿæˆæ´žç©´
                    if math.random(1, 20) == 1 then
                        generateCave(
                            worldX * CONFIG.BLOCK_SIZE,
                            worldZ * CONFIG.BLOCK_SIZE,
                            height
                        )
                    end
                end
            end
            
            -- ç”ŸæˆçŸ¿æ´ž
            if math.random(1, 10) == 1 then
                generateMineshaft(chunkX, chunkZ)
            end
            
            -- ç”Ÿæˆæ‘åº„
            if math.random(1, 100) == 1 then
                generateVillage(chunkX, chunkZ)
            end
        end
    end
    
    -- ç”Ÿæˆå‡ºç”Ÿç‚¹å¹³å°
    generateSpawnPlatform()
    
    print("ä¸–ç•Œç”Ÿæˆå®Œæˆï¼")
end

-- ç”Ÿæˆæ ‘
local function generateTree(x, y, z)
    local treeHeight = math.random(4, 7)
    local logHeight = math.random(3, 5)
    
    -- ç”Ÿæˆæ ‘å¹²
    for i = 1, logHeight do
        createBlock(
            Vector3.new(x, y + i * CONFIG.BLOCK_SIZE, z),
            "OAK_LOG"
        )
    end
    
    -- ç”Ÿæˆæ ‘å¶
    for dx = -2, 2 do
        for dz = -2, 2 do
            for dy = 0, 2 do
                if math.abs(dx) + math.abs(dz) + math.abs(dy) <= 3 then
                    createBlock(
                        Vector3.new(
                            x + dx * CONFIG.BLOCK_SIZE,
                            y + (logHeight + dy) * CONFIG.BLOCK_SIZE,
                            z + dz * CONFIG.BLOCK_SIZE
                        ),
                        "OAK_LEAVES"
                    )
                end
            end
        end
    end
end

-- ç”Ÿæˆæ´žç©´
local function generateCave(x, z, surfaceHeight)
    local caveHeight = math.random(10, 30)
    local caveWidth = math.random(3, 8)
    
    for y = 5, caveHeight do
        if y < surfaceHeight - 5 then
            local noise = math.noise(
                x * 0.03,
                y * 0.05,
                z * 0.03
            )
            
            if noise > 0.2 then
                -- ç”Ÿæˆæ´žç©´é€šé“
                for dx = -caveWidth, caveWidth do
                    for dz = -caveWidth, caveWidth do
                        if dx*dx + dz*dz <= caveWidth*caveWidth then
                            removeBlock(
                                Vector3.new(
                                    x + dx * CONFIG.BLOCK_SIZE,
                                    y * CONFIG.BLOCK_SIZE,
                                    z + dz * CONFIG.BLOCK_SIZE
                                )
                            )
                        end
                    end
                end
                
                -- ç”ŸæˆçŸ¿ç‰©
                if math.random(1, 10) == 1 then
                    local oreTypes = {"COAL_ORE", "IRON_ORE", "COPPER_ORE"}
                    if y < 20 then
                        table.insert(oreTypes, "GOLD_ORE")
                        table.insert(oreTypes, "REDSTONE_ORE")
                    end
                    if y < 10 then
                        table.insert(oreTypes, "DIAMOND_ORE")
                        table.insert(oreTypes, "EMERALD_ORE")
                    end
                    
                    local oreType = oreTypes[math.random(1, #oreTypes)]
                    generateOreVein(
                        x + math.random(-caveWidth, caveWidth) * CONFIG.BLOCK_SIZE,
                        y * CONFIG.BLOCK_SIZE,
                        z + math.random(-caveWidth, caveWidth) * CONFIG.BLOCK_SIZE,
                        oreType,
                        3
                    )
                end
            end
        end
    end
end

-- ç”ŸæˆçŸ¿è„‰
local function generateOreVein(x, y, z, oreType, size)
    for dx = -size, size do
        for dy = -size, size do
            for dz = -size, dz do
                if dx*dx + dy*dy + dz*dz <= size*size then
                    if math.random(1, 2) == 1 then
                        createBlock(
                            Vector3.new(
                                x + dx * CONFIG.BLOCK_SIZE,
                                y + dy * CONFIG.BLOCK_SIZE,
                                z + dz * CONFIG.BLOCK_SIZE
                            ),
                            oreType
                        )
                    end
                end
            end
        end
    end
end

-- ç”ŸæˆçŸ¿äº•
local function generateMineshaft(chunkX, chunkZ)
    local startX = chunkX * CONFIG.CHUNK_SIZE * CONFIG.BLOCK_SIZE
    local startZ = chunkZ * CONFIG.CHUNK_SIZE * CONFIG.BLOCK_SIZE
    local startY = 30 * CONFIG.BLOCK_SIZE
    
    -- ç”Ÿæˆä¸»é€šé“
    for length = 0, 50 do
        local x = startX + length * CONFIG.BLOCK_SIZE * 2
        for w = -2, 2 do
            for h = -2, 2 do
                if math.random(1, 5) > 1 then
                    removeBlock(
                        Vector3.new(
                            x + w * CONFIG.BLOCK_SIZE,
                            startY + h * CONFIG.BLOCK_SIZE,
                            startZ
                        )
                    )
                end
            end
        end
        
        -- ç”Ÿæˆæ”¯æ’‘æŸ±
        if length % 10 == 0 then
            for h = -5, 0 do
                createBlock(
                    Vector3.new(
                        x,
                        startY + h * CONFIG.BLOCK_SIZE,
                        startZ
                    ),
                    "OAK_LOG"
                )
            end
        end
        
        -- ç”Ÿæˆåˆ†æ”¯
        if math.random(1, 5) == 1 then
            local branchLength = math.random(5, 20)
            for b = 1, branchLength do
                local zOffset = b * CONFIG.BLOCK_SIZE * 2
                for w = -1, 1 do
                    for h = -1, 1 do
                        removeBlock(
                            Vector3.new(
                                x + w * CONFIG.BLOCK_SIZE,
                                startY + h * CONFIG.BLOCK_SIZE,
                                startZ + zOffset
                            )
                        )
                    end
                end
            end
        end
    end
    
    -- ç”ŸæˆçŸ¿è½¦è½¨é“
    for length = 0, 50 do
        local x = startX + length * CONFIG.BLOCK_SIZE * 2
        createBlock(
            Vector3.new(x, startY - CONFIG.BLOCK_SIZE, startZ),
            "IRON_BARS"
        )
    end
end

-- ç”Ÿæˆæ‘åº„
local function generateVillage(chunkX, chunkZ)
    local centerX = chunkX * CONFIG.CHUNK_SIZE * CONFIG.BLOCK_SIZE
    local centerZ = chunkZ * CONFIG.CHUNK_SIZE * CONFIG.BLOCK_SIZE
    
    -- ç”Ÿæˆä¸­å¿ƒé“è·¯
    for i = -20, 20 do
        createBlock(
            Vector3.new(centerX + i * CONFIG.BLOCK_SIZE * 3, 0, centerZ),
            "GRAVEL"
        )
        createBlock(
            Vector3.new(centerX, 0, centerZ + i * CONFIG.BLOCK_SIZE * 3),
            "GRAVEL"
        )
    end
    
    -- ç”Ÿæˆæˆ¿å±‹
    local housePositions = {
        {centerX + 40, centerZ + 40},
        {centerX - 40, centerZ + 40},
        {centerX + 40, centerZ - 40},
        {centerX - 40, centerZ - 40}
    }
    
    for _, pos in ipairs(housePositions) do
        generateHouse(pos[1], pos[2])
        
        -- ç”Ÿæˆæ‘æ°‘
        spawnMob(pos[1], 0, pos[2], "VILLAGER")
    end
    
    -- ç”Ÿæˆå†œåœº
    generateFarm(centerX + 80, centerZ)
    
    -- ç”Ÿæˆé“åŒ é“º
    generateBlacksmith(centerX - 80, centerZ)
    
    -- ç”Ÿæˆæ°´äº•
    generateWell(centerX, centerZ)
end

-- ç”Ÿæˆæˆ¿å±‹
local function generateHouse(x, z)
    local width = 7
    local length = 9
    local height = 5
    
    -- åœ°åŸº
    for wx = 0, width do
        for wz = 0, length do
            createBlock(
                Vector3.new(
                    x + wx * CONFIG.BLOCK_SIZE,
                    0,
                    z + wz * CONFIG.BLOCK_SIZE
                ),
                "COBBLESTONE"
            )
        end
    end
    
    -- å¢™å£
    for h = 1, height do
        for wx = 0, width do
            -- å‰åŽå¢™
            createBlock(
                Vector3.new(
                    x + wx * CONFIG.BLOCK_SIZE,
                    h * CONFIG.BLOCK_SIZE,
                    z
                ),
                "OAK_PLANKS"
            )
            createBlock(
                Vector3.new(
                    x + wx * CONFIG.BLOCK_SIZE,
                    h * CONFIG.BLOCK_SIZE,
                    z + length * CONFIG.BLOCK_SIZE
                ),
                "OAK_PLANKS"
            )
        end
        
        for wz = 0, length do
            -- å·¦å³å¢™
            createBlock(
                Vector3.new(
                    x,
                    h * CONFIG.BLOCK_SIZE,
                    z + wz * CONFIG.BLOCK_SIZE
                ),
                "OAK_PLANKS"
            )
            createBlock(
                Vector3.new(
                    x + width * CONFIG.BLOCK_SIZE,
                    h * CONFIG.BLOCK_SIZE,
                    z + wz * CONFIG.BLOCK_SIZE
                ),
                "OAK_PLANKS"
            )
        end
    end
    
    -- å±‹é¡¶
    for wx = -1, width + 1 do
        for wz = -1, length + 1 do
            createBlock(
                Vector3.new(
                    x + wx * CONFIG.BLOCK_SIZE,
                    (height + 1) * CONFIG.BLOCK_SIZE,
                    z + wz * CONFIG.BLOCK_SIZE
                ),
                "OAK_PLANKS"
            )
        end
    end
    
    -- é—¨ (ä¸­é—´ä½ç½®)
    removeBlock(Vector3.new(x + math.floor(width/2) * CONFIG.BLOCK_SIZE, 1 * CONFIG.BLOCK_SIZE, z))
    removeBlock(Vector3.new(x + math.floor(width/2) * CONFIG.BLOCK_SIZE, 2 * CONFIG.BLOCK_SIZE, z))
    
    -- çª—æˆ·
    for h = 2, 3 do
        removeBlock(Vector3.new(x, h * CONFIG.BLOCK_SIZE, z + math.floor(length/2) * CONFIG.BLOCK_SIZE))
        removeBlock(Vector3.new(x + width * CONFIG.BLOCK_SIZE, h * CONFIG.BLOCK_SIZE, z + math.floor(length/2) * CONFIG.BLOCK_SIZE))
    end
    
    -- å†…éƒ¨å®¶å…·
    createBlock(
        Vector3.new(
            x + 2 * CONFIG.BLOCK_SIZE,
            1 * CONFIG.BLOCK_SIZE,
            z + 2 * CONFIG.BLOCK_SIZE
        ),
        "CRAFTING_TABLE"
    )
    
    createBlock(
        Vector3.new(
            x + (width - 2) * CONFIG.BLOCK_SIZE,
            1 * CONFIG.BLOCK_SIZE,
            z + 2 * CONFIG.BLOCK_SIZE
        ),
        "CHEST"
    )
    
    createBlock(
        Vector3.new(
            x + 2 * CONFIG.BLOCK_SIZE,
            1 * CONFIG.BLOCK_SIZE,
            z + (length - 2) * CONFIG.BLOCK_SIZE
        ),
        "FURNACE"
    )
    
    createBlock(
        Vector3.new(
            x + (width - 2) * CONFIG.BLOCK_SIZE,
            1 * CONFIG.BLOCK_SIZE,
            z + (length - 2) * CONFIG.BLOCK_SIZE
        ),
        "BED"
    )
end

-- ç”Ÿæˆå†œåœº
local function generateFarm(x, z)
    local size = 10
    
    -- è€•åœ°
    for fx = -size, size do
        for fz = -size, size do
            createBlock(
                Vector3.new(
                    x + fx * CONFIG.BLOCK_SIZE,
                    0,
                    z + fz * CONFIG.BLOCK_SIZE
                ),
                "DIRT"
            )
        end
    end
    
    -- æ°´æº
    createBlock(
        Vector3.new(x, 0, z),
        "WATER"
    )
    
    -- æ …æ 
    for fx = -size-1, size+1 do
        createBlock(
            Vector3.new(
                x + fx * CONFIG.BLOCK_SIZE,
                1 * CONFIG.BLOCK_SIZE,
                z - (size+1) * CONFIG.BLOCK_SIZE
            ),
            "OAK_FENCE"
        )
        createBlock(
            Vector3.new(
                x + fx * CONFIG.BLOCK_SIZE,
                1 * CONFIG.BLOCK_SIZE,
                z + (size+1) * CONFIG.BLOCK_SIZE
            ),
            "OAK_FENCE"
        )
    end
    
    for fz = -size, size do
        createBlock(
            Vector3.new(
                x - (size+1) * CONFIG.BLOCK_SIZE,
                1 * CONFIG.BLOCK_SIZE,
                z + fz * CONFIG.BLOCK_SIZE
            ),
            "OAK_FENCE"
        )
        createBlock(
            Vector3.new(
                x + (size+1) * CONFIG.BLOCK_SIZE,
                1 * CONFIG.BLOCK_SIZE,
                z + fz * CONFIG.BLOCK_SIZE
            ),
            "OAK_FENCE"
        )
    end
    
    -- ç”ŸæˆåŠ¨ç‰©
    for i = 1, 4 do
        spawnMob(
            x + math.random(-size, size) * CONFIG.BLOCK_SIZE,
            0,
            z + math.random(-size, size) * CONFIG.BLOCK_SIZE,
            "COW"
        )
        spawnMob(
            x + math.random(-size, size) * CONFIG.BLOCK_SIZE,
            0,
            z + math.random(-size, size) * CONFIG.BLOCK_SIZE,
            "CHICKEN"
        )
    end
end

-- ç”Ÿæˆé“åŒ é“º
local function generateBlacksmith(x, z)
    local width = 9
    local length = 11
    local height = 6
    
    -- ä½¿ç”¨çŸ³å¤´å»ºé€ 
    for wx = 0, width do
        for wz = 0, length do
            createBlock(
                Vector3.new(
                    x + wx * CONFIG.BLOCK_SIZE,
                    0,
                    z + wz * CONFIG.BLOCK_SIZE
                ),
                "COBBLESTONE"
            )
        end
    end
    
    for h = 1, height do
        for wx = 0, width do
            createBlock(
                Vector3.new(
                    x + wx * CONFIG.BLOCK_SIZE,
                    h * CONFIG.BLOCK_SIZE,
                    z
                ),
                "COBBLESTONE"
            )
            createBlock(
                Vector3.new(
                    x + wx * CONFIG.BLOCK_SIZE,
                    h * CONFIG.BLOCK_SIZE,
                    z + length * CONFIG.BLOCK_SIZE
                ),
                "COBBLESTONE"
            )
        end
        
        for wz = 0, length do
            createBlock(
                Vector3.new(
                    x,
                    h * CONFIG.BLOCK_SIZE,
                    z + wz * CONFIG.BLOCK_SIZE
                ),
                "COBBLESTONE"
            )
            createBlock(
                Vector3.new(
                    x + width * CONFIG.BLOCK_SIZE,
                    h * CONFIG.BLOCK_SIZE,
                    z + wz * CONFIG.BLOCK_SIZE
                ),
                "COBBLESTONE"
            )
        end
    end
    
    -- çƒŸå›±
    for h = height + 1, height + 3 do
        createBlock(
            Vector3.new(
                x + 2 * CONFIG.BLOCK_SIZE,
                h * CONFIG.BLOCK_SIZE,
                z + 2 * CONFIG.BLOCK_SIZE
            ),
            "BRICKS"
        )
    end
    
    -- å†…éƒ¨è®¾å¤‡
    createBlock(
        Vector3.new(
            x + math.floor(width/2) * CONFIG.BLOCK_SIZE,
            1 * CONFIG.BLOCK_SIZE,
            z + 2 * CONFIG.BLOCK_SIZE
        ),
        "FURNACE"
    )
    
    createBlock(
        Vector3.new(
            x + math.floor(width/2) * CONFIG.BLOCK_SIZE,
            1 * CONFIG.BLOCK_SIZE,
            z + 4 * CONFIG.BLOCK_SIZE
        ),
        "ANVIL"
    )
    
    createBlock(
        Vector3.new(
            x + (width - 2) * CONFIG.BLOCK_SIZE,
            1 * CONFIG.BLOCK_SIZE,
            z + (length - 2) * CONFIG.BLOCK_SIZE
        ),
        "CHEST"
    )
end

-- ç”Ÿæˆæ°´äº•
local function generateWell(x, z)
    local radius = 3
    
    -- äº•å£
    for angle = 0, 360, 45 do
        local wx = math.cos(math.rad(angle)) * radius
        local wz = math.sin(math.rad(angle)) * radius
        
        for h = 0, 5 do
            createBlock(
                Vector3.new(
                    x + wx * CONFIG.BLOCK_SIZE,
                    h * CONFIG.BLOCK_SIZE,
                    z + wz * CONFIG.BLOCK_SIZE
                ),
                "COBBLESTONE"
            )
        end
    end
    
    -- äº•é¡¶
    for angle = 0, 360, 45 do
        local wx = math.cos(math.rad(angle)) * (radius + 1)
        local wz = math.sin(math.rad(angle)) * (radius + 1)
        
        createBlock(
            Vector3.new(
                x + wx * CONFIG.BLOCK_SIZE,
                6 * CONFIG.BLOCK_SIZE,
                z + wz * CONFIG.BLOCK_SIZE
            ),
            "OAK_PLANKS"
        )
    end
    
    -- äº•æ°´
    for wx = -radius + 1, radius - 1 do
        for wz = -radius + 1, radius - 1 do
            createBlock(
                Vector3.new(
                    x + wx * CONFIG.BLOCK_SIZE,
                    1 * CONFIG.BLOCK_SIZE,
                    z + wz * CONFIG.BLOCK_SIZE
                ),
                "WATER"
            )
        end
    end
    
    -- è¾˜è½³
    createBlock(
        Vector3.new(
            x,
            7 * CONFIG.BLOCK_SIZE,
            z
        ),
        "OAK_FENCE"
    )
end

-- ç”Ÿæˆå‡ºç”Ÿç‚¹å¹³å°
local function generateSpawnPlatform()
    local size = 5
    
    for x = -size, size do
        for z = -size, size do
            createBlock(
                Vector3.new(
                    x * CONFIG.BLOCK_SIZE,
                    0,
                    z * CONFIG.BLOCK_SIZE
                ),
                "GRASS"
            )
        end
    end
    
    -- ç”Ÿæˆå‡ºç”Ÿç‚¹æ ‘æœ¨
    generateTree(0, 0, 3 * CONFIG.BLOCK_SIZE)
    generateTree(3 * CONFIG.BLOCK_SIZE, 0, 0)
    generateTree(-3 * CONFIG.BLOCK_SIZE, 0, 0)
    generateTree(0, 0, -3 * CONFIG.BLOCK_SIZE)
    
    -- ç”Ÿæˆå‡ºç”Ÿç‚¹ç®±å­
    createBlock(
        Vector3.new(2 * CONFIG.BLOCK_SIZE, 1 * CONFIG.BLOCK_SIZE, 0),
        "CHEST"
    )
    
    -- åˆå§‹ç‰©å“
    GameState.Inventory = {
        {Type = "WOODEN_PICKAXE", Count = 1},
        {Type = "WOODEN_SWORD", Count = 1},
        {Type = "APPLE", Count = 5},
        {Type = "OAK_PLANKS", Count = 32},
        {Type = "STICK", Count = 16}
    }
    
    -- è®¾ç½®å‡ºç”Ÿç‚¹
    GameState.SpawnPoint = Vector3.new(0, 10, 0)
    
    print("å‡ºç”Ÿç‚¹ç”Ÿæˆå®Œæˆï¼")
end

-- ç”Ÿæˆç”Ÿç‰©
local function spawnMob(x, y, z, mobType)
    local mobData = MOB_TYPES[mobType]
    if not mobData then return end
    
    local mob = Instance.new("Part")
    mob.Name = mobData.Name
    mob.Size = mobData.Size
    mob.Position = Vector3.new(x, y + mobData.Size.Y/2, z)
    mob.Anchored = false
    mob.CanCollide = true
    
    -- è®¾ç½®é¢œè‰²å’Œæè´¨
    if mobType == "ZOMBIE" then
        mob.Color = Color3.fromRGB(100, 150, 100)
        mob.Material = Enum.Material.Grass
    elseif mobType == "SKELETON" then
        mob.Color = Color3.fromRGB(220, 220, 220)
        mob.Material = Enum.Material.Slate
    elseif mobType == "SPIDER" then
        mob.Color = Color3.fromRGB(50, 50, 50)
        mob.Material = Enum.Material.Slate
    elseif mobType == "CREEPER" then
        mob.Color = Color3.fromRGB(100, 200, 100)
        mob.Material = Enum.Material.Grass
    elseif mobType == "COW" then
        mob.Color = Color3.fromRGB(120, 80, 50)
        mob.Material = Enum.Material.Grass
    else
        mob.Color = Color3.fromRGB(200, 200, 200)
        mob.Material = Enum.Material.Slate
    end
    
    -- æ·»åŠ åˆšä½“
    local bodyVelocity = Instance.new("BodyVelocity")
    bodyVelocity.MaxForce = Vector3.new(4000, 4000, 4000)
    bodyVelocity.Parent = mob
    
    -- æ·»åŠ AIè„šæœ¬
    local ai = Instance.new("Script")
    ai.Name = "MobAI"
    ai.Parent = mob
    
    -- å­˜å‚¨ç”Ÿç‰©æ•°æ®
    local mobInstance = {
        Type = mobType,
        Data = mobData,
        Instance = mob,
        Health = mobData.Health,
        Target = nil,
        State = "Idle" -- Idle, Wander, Chase, Attack, Flee
    }
    
    table.insert(GameState.Mobs, mobInstance)
    mob.Parent = workspace
    
    return mobInstance
end

-- åˆ›å»ºæ–¹å—
local function createBlock(position, blockType)
    local blockData = BLOCK_TYPES[blockType]
    if not blockData then return nil end
    
    local chunkX = math.floor(position.X / (CONFIG.CHUNK_SIZE * CONFIG.BLOCK_SIZE))
    local chunkZ = math.floor(position.Z / (CONFIG.CHUNK_SIZE * CONFIG.BLOCK_SIZE))
    local chunkKey = chunkX .. "_" .. chunkZ
    
    if not GameState.Chunks[chunkKey] then
        GameState.Chunks[chunkKey] = {}
    end
    
    local blockKey = math.floor(position.X) .. "_" .. math.floor(position.Y) .. "_" .. math.floor(position.Z)
    
    -- æ£€æŸ¥æ˜¯å¦å·²å­˜åœ¨æ–¹å—
    if GameState.Chunks[chunkKey][blockKey] then
        return nil
    end
    
    local block = Instance.new("Part")
    block.Name = blockData.Name
    block.Size = Vector3.new(CONFIG.BLOCK_SIZE, CONFIG.BLOCK_SIZE, CONFIG.BLOCK_SIZE)
    block.Position = Vector3.new(
        math.floor(position.X / CONFIG.BLOCK_SIZE) * CONFIG.BLOCK_SIZE + CONFIG.BLOCK_SIZE/2,
        math.floor(position.Y / CONFIG.BLOCK_SIZE) * CONFIG.BLOCK_SIZE + CONFIG.BLOCK_SIZE/2,
        math.floor(position.Z / CONFIG.BLOCK_SIZE) * CONFIG.BLOCK_SIZE + CONFIG.BLOCK_SIZE/2
    )
    block.Anchored = true
    block.CanCollide = true
    block.Color = blockData.Color
    block.Material = blockData.Material
    
    if blockData.Transparent then
        block.Transparency = 0.3
    end
    
    if blockData.LightEmission then
        local light = Instance.new("PointLight")
        light.Brightness = blockData.LightEmission
        light.Range = 10
        light.Parent = block
    end
    
    -- æ·»åŠ æ ‡ç­¾
    local tag = Instance.new("StringValue")
    tag.Name = "BlockType"
    tag.Value = blockType
    tag.Parent = block
    
    block.Parent = workspace
    
    -- å­˜å‚¨æ•°æ®
    GameState.Chunks[chunkKey][blockKey] = {
        Type = blockType,
        Position = position,
        Instance = block
    }
    
    -- ç»Ÿè®¡
    GameState.BlocksPlaced = GameState.BlocksPlaced + 1
    
    -- å‘çŽ°æ–°æ–¹å—
    if not GameState.DiscoveredBlocks[blockType] then
        GameState.DiscoveredBlocks[blockType] = true
        showNotification("å‘çŽ°æ–°æ–¹å—: " .. blockData.Name)
    end
    
    return block
end

-- ç§»é™¤æ–¹å—
local function removeBlock(position)
    local chunkX = math.floor(position.X / (CONFIG.CHUNK_SIZE * CONFIG.BLOCK_SIZE))
    local chunkZ = math.floor(position.Z / (CONFIG.CHUNK_SIZE * CONFIG.BLOCK_SIZE))
    local chunkKey = chunkX .. "_" .. chunkZ
    
    if not GameState.Chunks[chunkKey] then return nil end
    
    local blockKey = math.floor(position.X) .. "_" .. math.floor(position.Y) .. "_" .. math.floor(position.Z)
    local blockData = GameState.Chunks[chunkKey][blockKey]
    
    if blockData and blockData.Instance then
        local blockType = blockData.Type
        blockData.Instance:Destroy()
        GameState.Chunks[chunkKey][blockKey] = nil
        
        -- ç»Ÿè®¡
        GameState.BlocksMined = GameState.BlocksMined + 1
        
        return blockType
    end
    
    return nil
end

-- æ˜¾ç¤ºé€šçŸ¥
local function showNotification(message)
    local notification = Instance.new("ScreenGui")
    notification.Name = "Notification"
    notification.Parent = player.PlayerGui
    
    local frame = Instance.new("Frame")
    frame.Size = UDim2.new(0.4, 0, 0.1, 0)
    frame.Position = UDim2.new(0.3, 0, 0.1, 0)
    frame.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
    frame.BackgroundTransparency = 0.3
    frame.BorderSizePixel = 2
    frame.Parent = notification
    
    local text = Instance.new("TextLabel")
    text.Size = UDim2.new(1, 0, 1, 0)
    text.BackgroundTransparency = 1
    text.Text = message
    text.TextColor3 = Color3.fromRGB(255, 255, 255)
    text.Font = Enum.Font.SourceSansBold
    text.TextSize = 18
    text.Parent = frame
    
    -- æ·¡å‡ºæ•ˆæžœ
    task.spawn(function()
        task.wait(3)
        local tween = TweenService:Create(
            frame,
            TweenInfo.new(1),
            {BackgroundTransparency = 1}
        )
        tween:Play()
        tween.Completed:Connect(function()
            notification:Destroy()
        end)
    end)
end

-- æ£€æŸ¥å¹³å°
local function isMobile()
    return UserInputService.TouchEnabled
end

-- ç§»åŠ¨æŽ§åˆ¶
local function setupMobileControls(joystickThumb, jumpButton)
    local joystickPosition = joystickThumb.AbsolutePosition
    local joystickSize = joystickThumb.AbsoluteSize
    local joystickCenter = joystickPosition + joystickSize / 2
    
    local isJumping = false
    
    -- æ‘‡æ†æŽ§åˆ¶
    local touchConnection
    local currentTouch
    
    joystickThumb.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.Touch then
            currentTouch = input
        end
    end)
    
    joystickThumb.InputChanged:Connect(function(input)
        if input == currentTouch then
            local position = input.Position
            local delta = position - joystickCenter
            local direction = Vector2.new(
                delta.X / (joystickSize.X / 2),
                delta.Y / (joystickSize.Y / 2)
            )
            
            -- é™åˆ¶æ‘‡æ†ç§»åŠ¨èŒƒå›´
            local magnitude = math.min(direction.Magnitude, 1)
            direction = direction.Unit * magnitude
            
            -- æ›´æ–°æ‘‡æ†ä½ç½®
            joystickThumb.Position = UDim2.new(
                0.35 + direction.X * 0.35,
                0,
                0.35 + direction.Y * 0.35,
                0
            )
            
            -- ç§»åŠ¨è§’è‰²
            if character and character:FindFirstChild("Humanoid") then
                local humanoid = character.Humanoid
                local moveDirection = Vector3.new(
                    direction.X,
                    0,
                    direction.Y
                )
                
                -- è½¬æ¢ä¸ºä¸–ç•Œæ–¹å‘
                local camera = workspace.CurrentCamera
                local forward = camera.CFrame.LookVector
                local right = camera.CFrame.RightVector
                
                forward = Vector3.new(forward.X, 0, forward.Z).Unit
                right = Vector3.new(right.X, 0, right.Z).Unit
                
                local moveVector = (forward * moveDirection.Z + right * moveDirection.X) * magnitude
                humanoid:Move(moveVector)
            end
        end
    end)
    
    joystickThumb.InputEnded:Connect(function(input)
        if input == currentTouch then
            currentTouch = nil
            -- å¤ä½æ‘‡æ†
            TweenService:Create(
                joystickThumb,
                TweenInfo.new(0.2),
                {Position = UDim2.new(0.35, 0, 0.35, 0)}
            ):Play()
        end
    end)
    
    -- è·³è·ƒæŽ§åˆ¶
    jumpButton.MouseButton1Down:Connect(function()
        if character and character:FindFirstChild("Humanoid") then
            character.Humanoid.Jump = true
        end
    end)
end

-- ä¸»æ¸¸æˆå¾ªçŽ¯
local function gameLoop()
    local lastTime = tick()
    local dayNightCycle = 0
    
    while true do
        local currentTime = tick()
        local deltaTime = currentTime - lastTime
        lastTime = currentTime
        
        -- æ›´æ–°æ¸¸æˆæ—¶é—´
        GameState.GameTime = GameState.GameTime + deltaTime
        dayNightCycle = (dayNightCycle + deltaTime / CONFIG.DAY_LENGTH) % 1
        
        -- æ˜¼å¤œå¾ªçŽ¯
        if GameState.DayNightCycle then
            local timeOfDay = dayNightCycle * 24
            GameState.IsDay = timeOfDay > 6 and timeOfDay < 18
            
            local brightness
            if GameState.IsDay then
                brightness = 2.0
                Lighting.Ambient = Color3.fromRGB(150, 150, 150)
            else
                brightness = 0.1
                Lighting.Ambient = Color3.fromRGB(50, 50, 80)
            end
            
            Lighting.Brightness = brightness
            Lighting.ClockTime = timeOfDay
        end
        
        -- ç”Ÿå­˜æœºåˆ¶
        survivalMechanics(deltaTime)
        
        -- ç”Ÿç‰©AI
        updateMobs(deltaTime)
        
        -- æ›´æ–°UI
        updateUI()
        
        -- åŒºå—åŠ è½½/å¸è½½
        updateChunks()
        
        -- çŽ¯å¢ƒæ•ˆæžœ
        updateEnvironment(deltaTime)
        
        task.wait()
    end
end

-- ç”Ÿå­˜æœºåˆ¶
local function survivalMechanics(deltaTime)
    -- é¥¥é¥¿å‡å°‘
    if GameState.Hunger > 0 then
        GameState.Hunger = math.max(0, GameState.Hunger - deltaTime * 0.2)
    end
    
    -- é¥¥é¥¿å½±å“
    if GameState.Hunger <= 20 then
        -- é¥¥é¥¿çŠ¶æ€
        if GameState.Hunger <= 0 then
            GameState.Health = math.max(0, GameState.Health - deltaTime * 1)
        else
            GameState.Health = math.max(0, GameState.Health - deltaTime * 0.2)
        end
    elseif GameState.Hunger > 80 and GameState.Health < CONFIG.MAX_HEALTH then
        -- æ¢å¤ç”Ÿå‘½
        GameState.Health = math.min(CONFIG.MAX_HEALTH, GameState.Health + deltaTime * 0.5)
    end
    
    -- æ°´ä¸‹æ£€æŸ¥
    local headPos = character.Head.Position
    if headPos.Y < 0 then -- ç®€å•çš„æ°´é¢æ£€æµ‹
        GameState.Oxygen = math.max(0, GameState.Oxygen - deltaTime * 10)
        if GameState.Oxygen <= 0 then
            GameState.Health = math.max(0, GameState.Health - deltaTime * 5)
        end
    else
        GameState.Oxygen = math.min(CONFIG.MAX_OXYGEN, GameState.Oxygen + deltaTime * 20)
    end
    
    -- ç²¾ç¥žå€¼ (åœ¨é»‘æš—ä¸­é™ä½Ž)
    local lightLevel = Lighting.Brightness
    if lightLevel < 0.3 and not GameState.IsDay then
        GameState.Sanity = math.max(0, GameState.Sanity - deltaTime * 0.5)
    elseif GameState.Sanity < CONFIG.MAX_SANITY then
        GameState.Sanity = math.min(CONFIG.MAX_SANITY, GameState.Sanity + deltaTime * 0.2)
    end
    
    -- ç²¾ç¥žå€¼å½±å“
    if GameState.Sanity < 30 then
        -- å¼€å§‹çœ‹åˆ°å¹»è§‰
    end
end

-- æ›´æ–°ç”Ÿç‰©AI
local function updateMobs(deltaTime)
    for _, mob in ipairs(GameState.Mobs) do
        if mob.Instance and mob.Instance.Parent then
            local mobData = mob.Data
            
            if mobData.Hostile or mob.Target then
                -- æ•Œå¯¹æˆ–å·²æ¿€æ€’çš„ç”Ÿç‰©
                local distanceToPlayer = (character.HumanoidRootPart.Position - mob.Instance.Position).Magnitude
                
                if distanceToPlayer < 20 then
                    -- è¿½é€çŽ©å®¶
                    if not mob.Target then
                        mob.Target = character
                        mob.State = "Chase"
                    end
                    
                    if mob.State == "Chase" then
                        if distanceToPlayer > 3 then
                            -- ç§»åŠ¨å‘çŽ©å®¶
                            local direction = (character.HumanoidRootPart.Position - mob.Instance.Position).Unit
                            local bodyVelocity = mob.Instance:FindFirstChild("BodyVelocity")
                            if bodyVelocity then
                                bodyVelocity.Velocity = direction * mobData.Speed
                            end
                        else
                            -- æ”»å‡»èŒƒå›´
                            mob.State = "Attack"
                        end
                    elseif mob.State == "Attack" then
                        -- æ”»å‡»çŽ©å®¶
                        if tick() % 1 < 0.1 then -- æ¯ç§’æ”»å‡»ä¸€æ¬¡
                            GameState.Health = math.max(0, GameState.Health - mobData.Damage)
                        end
                        
                        if distanceToPlayer > 4 then
                            mob.State = "Chase"
                        end
                    end
                else
                    mob.Target = nil
                    mob.State = "Idle"
                end
            else
                -- è¢«åŠ¨ç”Ÿç‰©
                if tick() % 5 < 0.1 then
                    -- éšæœºç§»åŠ¨
                    local randomDirection = Vector3.new(
                        math.random(-1, 1),
                        0,
                        math.random(-1, 1)
                    ).Unit
                    
                    local bodyVelocity = mob.Instance:FindFirstChild("BodyVelocity")
                    if bodyVelocity then
                        bodyVelocity.Velocity = randomDirection * mobData.Speed * 0.5
                    end
                end
            end
            
            -- ç‰¹æ®Šèƒ½åŠ›
            if mobData.Teleports and tick() % 3 < 0.1 then
                -- æœ«å½±äººä¼ é€
                if math.random(1, 10) == 1 then
                    mob.Instance.Position = mob.Instance.Position + Vector3.new(
                        math.random(-10, 10),
                        0,
                        math.random(-10, 10)
                    )
                end
            end
        end
    end
end

-- æ›´æ–°UI
local function updateUI()
    if GameState.MobileUI then
        local ui = GameState.MobileUI
        
        -- æ›´æ–°çŠ¶æ€æ¡
        ui.HealthBar.Size = UDim2.new(0.9 * (GameState.Health / CONFIG.MAX_HEALTH), 0, 0.25, 0)
        ui.HealthText.Text = string.format("â¤ï¸ %d/%d", GameState.Health, CONFIG.MAX_HEALTH)
        
        ui.HungerBar.Size = UDim2.new(0.9 * (GameState.Hunger / CONFIG.MAX_HUNGER), 0, 0.25, 0)
        ui.HungerText.Text = string.format("ðŸ– %d/%d", GameState.Hunger, CONFIG.MAX_HUNGER)
        
        -- æ›´æ–°ç»éªŒæ¡
        local expForNextLevel = GameState.Level * 100
        ui.ExpBar.Size = UDim2.new(0.9 * (GameState.Experience % expForNextLevel / expForNextLevel), 0, 0.25, 0)
        ui.ExpText.Text = string.format("â­ Lv.%d (%d/%d)", GameState.Level, GameState.Experience % expForNextLevel, expForNextLevel)
        
        -- æ›´æ–°å¿«æ·æ 
        for i = 1, 9 do
            local slot = ui.HotbarSlots[i]
            if i == GameState.SelectedHotbarSlot then
                slot.BorderColor3 = Color3.fromRGB(255, 255, 0)
            else
                slot.BorderColor3 = Color3.fromRGB(100, 100, 100)
            end
        end
    end
    
    -- æ˜¾ç¤ºåæ ‡
    if GameState.ShowCoordinates and character then
        local pos = character.HumanoidRootPart.Position
        local coordText = string.format("X: %d Y: %d Z: %d", math.floor(pos.X), math.floor(pos.Y), math.floor(pos.Z))
        
        -- å¯ä»¥åœ¨è¿™é‡Œæ·»åŠ åæ ‡æ˜¾ç¤ºUI
    end
end

-- æ›´æ–°åŒºå—
local function updateChunks()
    if not character then return end
    
    local playerPos = character.HumanoidRootPart.Position
    local playerChunkX = math.floor(playerPos.X / (CONFIG.CHUNK_SIZE * CONFIG.BLOCK_SIZE))
    local playerChunkZ = math.floor(playerPos.Z / (CONFIG.CHUNK_SIZE * CONFIG.BLOCK_SIZE))
    
    -- åŠ è½½æ–°åŒºå—
    for dx = -CONFIG.RENDER_DISTANCE, CONFIG.RENDER_DISTANCE do
        for dz = -CONFIG.RENDER_DISTANCE, CONFIG.RENDER_DISTANCE do
            local chunkX = playerChunkX + dx
            local chunkZ = playerChunkZ + dz
            local chunkKey = chunkX .. "_" .. chunkZ
            
            if not GameState.Chunks[chunkKey] then
                generateChunk(chunkX, chunkZ)
            end
        end
    end
    
    -- å¸è½½è¿œå¤„åŒºå—
    for chunkKey, chunkData in pairs(GameState.Chunks) do
        local parts = chunkKey:split("_")
        local chunkX = tonumber(parts[1])
        local chunkZ = tonumber(parts[2])
        
        local distance = math.abs(chunkX - playerChunkX) + math.abs(chunkZ - playerChunkZ)
        
        if distance > CONFIG.RENDER_DISTANCE + 1 then
            -- å¸è½½åŒºå—
            for _, blockData in pairs(chunkData) do
                if blockData.Instance then
                    blockData.Instance:Destroy()
                end
            end
            GameState.Chunks[chunkKey] = nil
        end
    end
end

-- ç”Ÿæˆå•ä¸ªåŒºå—
local function generateChunk(chunkX, chunkZ)
    local chunkKey = chunkX .. "_" .. chunkZ
    GameState.Chunks[chunkKey] = {}
    
    local worldSeed = CONFIG.WORLD_SEED
    
    for x = 0, CONFIG.CHUNK_SIZE - 1 do
        for z = 0, CONFIG.CHUNK_SIZE - 1 do
            local worldX = chunkX * CONFIG.CHUNK_SIZE + x
            local worldZ = chunkZ * CONFIG.CHUNK_SIZE + z
            
            -- ä½¿ç”¨ç§å­ç”Ÿæˆç¡®å®šæ€§çš„éšæœºæ•°
            math.randomseed(worldSeed + worldX * 1000 + worldZ)
            
            local height = math.noise(
                worldX * 0.01, 
                worldZ * 0.01
            ) * 20 + 50
            
            height = math.floor(height)
            
            for y = 0, height do
                local blockType
                
                if y == height then
                    -- ç”Ÿç‰©ç¾¤ç³»æ£€æµ‹
                    local biomeNoise = math.noise(worldX * 0.002, worldZ * 0.002)
                    if biomeNoise > 0.6 then
                        -- æ²™æ¼ 
                        blockType = "SAND"
                    elseif biomeNoise < -0.4 then
                        -- é›ªåœ°
                        blockType = "SNOW"
                    else
                        -- å¹³åŽŸ
                        blockType = "GRASS"
                    end
                elseif y > height - 3 then
                    blockType = "DIRT"
                elseif y > height - 10 then
                    blockType = "STONE"
                else
                    blockType = "DEEPSLATE"
                end
                
                local position = Vector3.new(
                    worldX * CONFIG.BLOCK_SIZE,
                    y * CONFIG.BLOCK_SIZE,
                    worldZ * CONFIG.BLOCK_SIZE
                )
                
                createBlock(position, blockType)
            end
        end
    end
end

-- æ›´æ–°çŽ¯å¢ƒ
local function updateEnvironment(deltaTime)
    -- å¤©æ°”ç³»ç»Ÿ
    if math.random(1, 1000) == 1 then
        -- å¼€å§‹ä¸‹é›¨æˆ–ä¸‹é›ª
        local precipitation = GameState.IsDay and "Rain" or "Snow"
        startWeather(precipitation)
    end
    
    -- çŽ¯å¢ƒéŸ³æ•ˆ
    if tick() % 30 < 0.1 then
        playAmbientSound()
    end
end

-- å¼€å§‹å¤©æ°”
local function startWeather(weatherType)
    if weatherType == "Rain" then
        -- åˆ›å»ºé›¨ç²’å­
        local rain = Instance.new("ParticleEmitter")
        rain.Name = "Rain"
        rain.Parent = workspace
        -- è®¾ç½®é›¨ç²’å­å±žæ€§...
    elseif weatherType == "Snow" then
        -- åˆ›å»ºé›ªç²’å­
        local snow = Instance.new("ParticleEmitter")
        snow.Name = "Snow"
        snow.Parent = workspace
        -- è®¾ç½®é›ªç²’å­å±žæ€§...
    end
    
    -- 30ç§’åŽåœæ­¢å¤©æ°”
    task.delay(30, function()
        stopWeather(weatherType)
    end)
end

-- æ’­æ”¾çŽ¯å¢ƒéŸ³æ•ˆ
local function playAmbientSound()
    -- æ ¹æ®ç”Ÿç‰©ç¾¤ç³»å’Œæ—¶é—´æ’­æ”¾ä¸åŒçš„éŸ³æ•ˆ
    local sounds = {
        Day = {
            Forest = "rbxassetid://",
            Plains = "rbxassetid://",
            Desert = "rbxassetid://"
        },
        Night = {
            Forest = "rbxassetid://",
            Plains = "rbxassetid://",
            Desert = "rbxassetid://"
        }
    }
    
    -- è¿™é‡Œå¯ä»¥æ·»åŠ éŸ³æ•ˆæ’­æ”¾é€»è¾‘
end

-- å¤„ç†è¾“å…¥
local function setupInput()
    -- é”®ç›˜æŽ§åˆ¶
    UserInputService.InputBegan:Connect(function(input, gameProcessed)
        if gameProcessed then return end
        
        if input.KeyCode == Enum.KeyCode.E then
            -- é‡‡é›†/æ”»å‡»
            handleMining()
        elseif input.KeyCode == Enum.KeyCode.R then
            -- æ”¾ç½®æ–¹å—
            handleBuilding()
        elseif input.KeyCode == Enum.KeyCode.Q then
            -- ä¸¢å¼ƒç‰©å“
            handleDropping()
        elseif input.KeyCode == Enum.KeyCode.F then
            -- ä½¿ç”¨ç‰©å“
            handleItemUse()
        elseif input.KeyCode >= Enum.KeyCode.One and input.KeyCode <= Enum.KeyCode.Nine then
            -- åˆ‡æ¢å¿«æ·æ 
            local slot = input.KeyCode.Value - Enum.KeyCode.One.Value + 1
            GameState.SelectedHotbarSlot = slot
        elseif input.KeyCode == Enum.KeyCode.I then
            -- æ‰“å¼€ç‰©å“æ 
            toggleInventory()
        elseif input.KeyCode == Enum.KeyCode.C then
            -- æ‰“å¼€åˆæˆè¡¨
            toggleCrafting()
        elseif input.KeyCode == Enum.KeyCode.M then
            -- æ‰“å¼€åœ°å›¾
            toggleMap()
        elseif input.KeyCode == Enum.KeyCode.T then
            -- èŠå¤©/å‘½ä»¤
            openChat()
        end
    end)
    
    -- é¼ æ ‡æŽ§åˆ¶
    UserInputService.InputChanged:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseMovement then
            -- è§†è§’æŽ§åˆ¶
            handleCamera(input)
        end
    end)
end

-- å¤„ç†æŒ–æŽ˜
local function handleMining()
    local ray = Ray.new(
        camera.CFrame.Position,
        camera.CFrame.LookVector * 10
    )
    
    local hit, position = workspace:FindPartOnRay(ray, character)
    
    if hit and hit.Name ~= "Terrain" then
        local blockType = hit:FindFirstChild("BlockType")
        if blockType then
            -- ç§»é™¤æ–¹å—
            removeBlock(position)
            
            -- æ·»åŠ åˆ°ç‰©å“æ 
            addToInventory(blockType.Value, 1)
            
            -- èŽ·å¾—ç»éªŒ
            GameState.Experience = GameState.Experience + 1
        else
            -- æ”»å‡»ç”Ÿç‰©
            for _, mob in ipairs(GameState.Mobs) do
                if mob.Instance == hit then
                    mob.Health = mob.Health - 10
                    if mob.Health <= 0 then
                        mob.Instance:Destroy()
                        GameState.MobsKilled = GameState.MobsKilled + 1
                        GameState.Experience = GameState.Experience + mob.Data.Experience
                        
                        -- æŽ‰è½ç‰©å“
                        if mob.Data.Drops then
                            for _, drop in ipairs(mob.Data.Drops) do
                                if math.random(1, 2) == 1 then
                                    spawnItemDrop(mob.Instance.Position, drop)
                                end
                            end
                        end
                    end
                    break
                end
            end
        end
    end
end

-- å¤„ç†å»ºé€ 
local function handleBuilding()
    local ray = Ray.new(
        camera.CFrame.Position,
        camera.CFrame.LookVector * 10
    )
    
    local hit, position = workspace:FindPartOnRay(ray, character)
    
    if hit then
        -- åœ¨å‡»ä¸­ç‚¹é™„è¿‘æ”¾ç½®æ–¹å—
        local normal = (position - hit.Position).Unit
        local placePosition = position + normal * (CONFIG.BLOCK_SIZE / 2)
        
        -- ä»Žå¿«æ·æ èŽ·å–å½“å‰é€‰æ‹©çš„æ–¹å—
        local selectedItem = getSelectedHotbarItem()
        if selectedItem and BLOCK_TYPES[selectedItem] then
            if removeFromInventory(selectedItem, 1) then
                createBlock(placePosition, selectedItem)
            end
        end
    end
end

-- æ·»åŠ åˆ°ç‰©å“æ 
local function addToInventory(itemType, count)
    for _, item in ipairs(GameState.Inventory) do
        if item.Type == itemType and item.Count < 64 then
            item.Count = item.Count + count
            return true
        end
    end
    
    -- æ–°ç‰©å“
    if #GameState.Inventory < 36 then
        table.insert(GameState.Inventory, {Type = itemType, Count = count})
        return true
    end
    
    return false
end

-- ä»Žç‰©å“æ ç§»é™¤
local function removeFromInventory(itemType, count)
    for i, item in ipairs(GameState.Inventory) do
        if item.Type == itemType and item.Count >= count then
            item.Count = item.Count - count
            if item.Count <= 0 then
                table.remove(GameState.Inventory, i)
            end
            return true
        end
    end
    return false
end

-- èŽ·å–å½“å‰å¿«æ·æ ç‰©å“
local function getSelectedHotbarItem()
    if GameState.Inventory[GameState.SelectedHotbarSlot] then
        return GameState.Inventory[GameState.SelectedHotbarSlot].Type
    end
    return nil
end

-- ç”Ÿæˆç‰©å“æŽ‰è½
local function spawnItemDrop(position, itemType)
    local item = Instance.new("Part")
    item.Size = Vector3.new(1, 1, 1)
    item.Position = position
    item.Anchored = false
    item.CanCollide = true
    item.Name = itemType
    
    -- æ·»åŠ æ ‡ç­¾
    local tag = Instance.new("StringValue")
    tag.Name = "ItemType"
    tag.Value = itemType
    tag.Parent = item
    
    -- æ·»åŠ å¸å¼•æ•ˆæžœ
    task.spawn(function()
        while item.Parent do
            task.wait(0.1)
            local playerPos = character.HumanoidRootPart.Position
            local direction = (playerPos - item.Position).Unit
            item.Velocity = direction * 5
        end
    end)
    
    item.Parent = workspace
    
    -- 10ç§’åŽæ¶ˆå¤±
    task.delay(10, function()
        if item.Parent then
            item:Destroy()
        end
    end)
end

-- æ‰“å¼€/å…³é—­ç‰©å“æ 
local function toggleInventory()
    if GameState.InventoryUI then
        GameState.InventoryUI.Screen.Enabled = not GameState.InventoryUI.Screen.Enabled
    end
end

-- æ‰“å¼€/å…³é—­åˆæˆè¡¨
local function toggleCrafting()
    if GameState.CraftingUI then
        GameState.CraftingUI.Screen.Enabled = not GameState.CraftingUI.Screen.Enabled
    end
end

-- æ‰“å¼€/å…³é—­åœ°å›¾
local function toggleMap()
    if GameState.MapUI then
        GameState.MapUI.Screen.Enabled = not GameState.MapUI.Screen.Enabled
    end
end

-- æ‰“å¼€èŠå¤©
local function openChat()
    -- å¯ä»¥åœ¨è¿™é‡Œå®žçŽ°èŠå¤©ç³»ç»Ÿ
    print("èŠå¤©åŠŸèƒ½å¾…å®žçŽ°")
end

-- åˆå§‹åŒ–æ¸¸æˆ
local function initializeGame()
    print("åˆå§‹åŒ–æˆ‘çš„ä¸–ç•Œç”Ÿå­˜æ¨¡å¼...")
    
    -- è®¾ç½®çŽ©å®¶å‡ºç”Ÿç‚¹
    character.HumanoidRootPart.CFrame = CFrame.new(GameState.SpawnPoint)
    
    -- åˆ›å»ºUI
    if isMobile() then
        print("æ£€æµ‹åˆ°ç§»åŠ¨è®¾å¤‡ï¼Œåˆ›å»ºç§»åŠ¨UI...")
        GameState.MobileUI = createMobileUI()
        setupMobileControls(GameState.MobileUI.JoystickThumb, GameState.MobileUI.JumpButton)
    else
        print("æ£€æµ‹åˆ°PCè®¾å¤‡ï¼Œä½¿ç”¨é”®ç›˜æŽ§åˆ¶...")
        setupInput()
    end
    
    -- åˆ›å»ºå…¶ä»–UI
    GameState.InventoryUI = createInventoryUI()
    GameState.CraftingUI = createCraftingUI()
    GameState.MapUI = createMapSystem()
    
    -- ç”Ÿæˆä¸–ç•Œ
    generateWorld()
    
    -- å¼€å§‹æ¸¸æˆå¾ªçŽ¯
    task.spawn(gameLoop)
    
    -- æ˜¾ç¤ºæ¬¢è¿Žæ¶ˆæ¯
    showNotification("æ¬¢è¿Žæ¥åˆ°æˆ‘çš„ä¸–ç•Œç”Ÿå­˜æ¨¡å¼ï¼")
    showNotification("ä½¿ç”¨WASDç§»åŠ¨ï¼Œé¼ æ ‡æŽ§åˆ¶è§†è§’")
    showNotification("Eé”®æŒ–æŽ˜ï¼ŒRé”®æ”¾ç½®ï¼ŒIé”®æ‰“å¼€ç‰©å“æ ")
    
    print("æ¸¸æˆåˆå§‹åŒ–å®Œæˆï¼")
end

-- ä¿å­˜æ¸¸æˆ
local function saveGame()
    local saveData = {
        Position = character.HumanoidRootPart.Position,
        Inventory = GameState.Inventory,
        Health = GameState.Health,
        Hunger = GameState.Hunger,
        Experience = GameState.Experience,
        Level = GameState.Level,
        GameTime = GameState.GameTime,
        DiscoveredBlocks = GameState.DiscoveredBlocks,
        DiscoveredItems = GameState.DiscoveredItems,
        UnlockedRecipes = GameState.UnlockedRecipes,
        Stats = {
            BlocksMined = GameState.BlocksMined,
            BlocksPlaced = GameState.BlocksPlaced,
            MobsKilled = GameState.MobsKilled,
            DistanceTraveled = GameState.DistanceTraveled,
            Deaths = GameState.Deaths
        }
    }
    
    -- è½¬æ¢ä¸ºJSON
    local json = HttpService:JSONEncode(saveData)
    
    -- ä¿å­˜åˆ°DataStore (å®žé™…æ¸¸æˆä¸­)
    -- è¿™é‡Œç®€åŒ–å¤„ç†ï¼Œåªæ‰“å°ä¿å­˜ä¿¡æ¯
    print("æ¸¸æˆå·²ä¿å­˜ï¼")
    print("ä½ç½®:", saveData.Position)
    print("ç‰©å“æ ç‰©å“æ•°:", #saveData.Inventory)
    print("ç”Ÿå‘½å€¼:", saveData.Health)
    print("ç»éªŒå€¼:", saveData.Experience)
end

-- åŠ è½½æ¸¸æˆ
local function loadGame()
    print("æ­£åœ¨åŠ è½½æ¸¸æˆ...")
    
    -- è¿™é‡Œå¯ä»¥ä»ŽDataStoreåŠ è½½æ•°æ®
    -- ç®€åŒ–å¤„ç†ï¼Œæ˜¾ç¤ºåŠ è½½æ¶ˆæ¯
    showNotification("æ¸¸æˆåŠ è½½ä¸­...")
    
    -- å»¶è¿Ÿä¸€ä¸‹æ˜¾ç¤ºåŠ è½½å®Œæˆ
    task.delay(2, function()
        showNotification("æ¸¸æˆåŠ è½½å®Œæˆï¼")
    end)
end

-- æ­»äº¡å¤„ç†
local function handleDeath()
    GameState.Deaths = GameState.Deaths + 1
    
    showNotification("ä½ æ­»äº†ï¼")
    showNotification("3ç§’åŽé‡ç”Ÿ...")
    
    task.wait(3)
    
    -- é‡ç½®çŽ©å®¶çŠ¶æ€
    GameState.Health = CONFIG.MAX_HEALTH
    GameState.Hunger = CONFIG.MAX_HUNGER
    GameState.Oxygen = CONFIG.MAX_OXYGEN
    GameState.Sanity = CONFIG.MAX_SANITY
    
    -- ä¼ é€å›žå‡ºç”Ÿç‚¹
    character.HumanoidRootPart.CFrame = CFrame.new(GameState.SpawnPoint)
    
    -- æŽ‰è½ç‰©å“
    if #GameState.Inventory > 0 then
        for _, item in ipairs(GameState.Inventory) do
            if math.random(1, 2) == 1 then
                spawnItemDrop(character.HumanoidRootPart.Position, item.Type)
            end
        end
        GameState.Inventory = {}
    end
    
    showNotification("å·²é‡ç”Ÿï¼")
end

-- ä¸»å‡½æ•°
local function main()
    -- ç­‰å¾…è§’è‰²åŠ è½½
    if not character then
        player.CharacterAdded:Wait()
        character = player.Character
    end
    
    -- è®¾ç½®æ­»äº¡ç›‘å¬
    character.Humanoid.Died:Connect(handleDeath)
    
    -- åˆå§‹åŒ–æ¸¸æˆ
    initializeGame()
    
    -- è‡ªåŠ¨ä¿å­˜å®šæ—¶å™¨
    task.spawn(function()
        while true do
            task.wait(300) -- æ¯5åˆ†é’Ÿä¿å­˜ä¸€æ¬¡
            saveGame()
        end
    end)
    
    print("æˆ‘çš„ä¸–ç•Œç”Ÿå­˜æ¨¡å¼å·²å¯åŠ¨ï¼")
    print("æŽ§åˆ¶è¯´æ˜Ž:")
    print("WASD - ç§»åŠ¨")
    print("é¼ æ ‡ - è§†è§’")
    print("ç©ºæ ¼ - è·³è·ƒ")
    print("E - æŒ–æŽ˜/æ”»å‡»")
    print("R - æ”¾ç½®æ–¹å—")
    print("Q - ä¸¢å¼ƒç‰©å“")
    print("1-9 - åˆ‡æ¢å¿«æ·æ ")
    print("I - ç‰©å“æ ")
    print("C - åˆæˆè¡¨")
    print("M - åœ°å›¾")
    print("F5 - ä¿å­˜æ¸¸æˆ")
    print("F9 - åŠ è½½æ¸¸æˆ")
end

-- å¯åŠ¨æ¸¸æˆ
main()
